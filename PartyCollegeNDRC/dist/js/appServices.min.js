window.apiCallback=new Object,angular.module("app.public.commonServices",[]).service("getDataSource",["$http","$q","$rootScope",function(e,t,r){return{getCacheStaticJson:function(e,t,n){var o=r.appConfig.fileServer.rootPath,i=o+r.appConfig.fileServer.staticJson+"/";location.href;if(e.folder&&""!=e.folder){var a=r.appConfig.fileServer[e.folder];i=o+a+"/"+e.key+".json"}else i=i+e.key+".json";$.ajax({type:"get",async:!0,cache:!0,url:i,dataType:"jsonp",jsonp:e.callback,success:function(e){console.log("data",e)},error:function(e){console.log("error",e)}})},getDataSource:function(t,n,o,i,a){var s=[];"string"==typeof t?s.push(t):s=t;var u={key:s,postData:n};null!=a&&"object"==typeof a?this.getCacheStaticJson(a,o,i):r.appConfig.localSQL===!0?this.getLocalJSON(t,n,o,i):e.post("../api/CommonSQL",JSON.stringify(u)).success(function(e){e.error?i(e.error):o(e)}).error(function(e){i&&i(e)})},getList:function(t,r,n,o,i,a,s){var u=[];"string"==typeof t?u.push(t):u=t;var c={key:u,postData:r,pageInfo:n,search:o,orderBy:i};e.post("../api/CommonSQL",JSON.stringify(c)).success(function(e){e.error?s(e.error):a(e)}).error(function(e){s&&s(e)})},getConnKeyList:function(t,r,n,o,i,a,s,u){var c=[];"string"==typeof t?c.push(t):c=t;var f={key:c,postData:r,pageInfo:n,search:o,orderBy:i,connectionKey:a};e.post("../api/CommonSQL",JSON.stringify(f)).success(function(e){e.error?u(e.error):s(e)}).error(function(e){u&&u(e)})},getUrlList:function(t,r,n,o,i,a,s){var u={postData:r,pageInfo:n,search:o,orderBy:i};e.post(t,JSON.stringify(u)).success(function(e){e.error?s(e.error):a(e)}).error(function(e){s&&s(e)})},doArray:function(t,n,o,i){var a=[];"string"==typeof t?a.push(t):a=t;var s={key:a,postData:n};r.appConfig.localSQL===!0?this.getLocalJSON(t,n,o,i):e.post("../api/CommonSQL/Array",JSON.stringify(s)).success(function(e){e.error?i(e.error):o(e)}).error(function(e){i(e)})},getLocalJSON:function(t,r,n,o){var i=e.get("../testJSON/"+t+".json");i.success(n),i.error(o)},getUrlData:function(t,r,n,o){e.post(t,JSON.stringify(r)).success(function(e){e.error?o(e.error):n(e)}).error(function(e){o(e)})},queryLunbo:function(r){var n=t.defer();return e({method:"GET",url:"../config/img.json"}).success(function(e,t,r,o){n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise},getData:function(t,r,n){e.get(t).success(function(e){e.error?n(e.error):r(e)}).error(function(e){n(e)})},getGUID:function(){for(var e=[],t="0123456789abcdef",r=0;36>r;r++)e[r]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n},changeUserPhoto:function(e,t){this.getUrlData("../api/changeuserphoto",{photopath:e,photothumbpath:t},function(e){},function(e){})},writeLog:function(e,t){this.getUrlData("../api/writeoptlog",{tag:e,group:t},function(e){},function(e){})},validateCode:function(e,t,r,n){this.getUrlData("../api/VerifySMSCode",{smscode:e,keyname:t},function(e){"success"==e.code?r():n()},function(e){})},getDepartment:function(e,t){r.user&&r.user.isLogin&&2==r.user.usertype?this.getDataSource("getDepartment",{pid:r.user.departmentId},function(e){},function(e){t(e)},{key:"getAllDepartment",folder:"",callback:"apiCallback.getAllDepartment"}):this.getDataSource("getDepartment",{pid:r.user.mdepartmentId},function(t){e(t)},function(e){t(e)})},getDepartmentAdmin:function(e,t){var n=r.user.mdepartmentId;2==r.user.usertype&&(n=r.user.departmentId),this.getDataSource("getDepartmentHasAdmin",{pid:n},function(t){e(t)},function(e){console.log(e)})}}}]).service("drawTable",["$http","$rootScope","getDataSource",function(e,t,r){var n={paginationPageSizes:[25,50,75],paginationPageSize:25,data:[],columnDefs:[{name:"课程名称",field:"name",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.name}}</a></div>'},{name:"授课人",field:"teachersname"}]};return{drawTable:function(e){return r.getDataSource("getCourseMicroVideo",{courseid:e},function(e){n.data=e}),n}}}]).service("smsService",["$rootScope","$http",function(e,t){return{isSimulation:!1,send:function(e,r,n){t.post("../api/SMS",e).success(function(){r()}).error(function(){})}}}]).service("AccountService",["$http","$rootScope","getDataSource","CommonService",function(e,t,r,n){return{saveAccount:function(e,t,n){r.getUrlData("../api/Register",e,function(e){"success"==e.code?t(e):n(e)},function(e){n(e)})}}}]).service("SessionService",["$http","$rootScope","getDataSource","$state","CommonService",function(e,t,r,n,o){return{CheckSession:function(r,n){return t.user&&t.user.isLogin?void 0:e.post("../api/session",{platformcode:r}).success(function(e){t.user=new Object,t.user.isLogin=!1,"success"==e.code?(t.user=e.loginUser,t.user.isLogin=!0,n(t.user)):(t.user.isLogin=!1,location.href="../html/login.html")}).error(function(e){})},RenovatSession:function(r,n){return e.post("../api/session",{platformcode:r}).success(function(e){t.user=new Object,t.user.isLogin=!1,"success"==e.code?(t.user=e.loginUser,t.user.isLogin=!0,n(t.user)):(t.user.isLogin=!1,location.href="../html/login.html")}).error(function(e){})},HeartBeat:function(e,t){r.getUrlData("../api/HeartBeat",{},function(r){"success"==r.code?e():t()},function(e){t()})},GetConfig:function(){return e.get("../config/appConfig.json").then(function(e){t.appConfig=e.data})},GetAlumnusDurationTime:function(){return e.post("../api/getAlumnusDuration").success(function(e){t.user.isduration=e.isduration}).error(function(e){})},Logout:function(){confirm("确定要退出系统吗?")&&r.getUrlData("../api/Logout",{},function(e){if("success"==e.code){var t="../html/index.html";location.href=t}},function(e){})},GetCenterUrl:function(e){var r=new Array;if(t.user&&t.user.isLogin)for(var n=new Object,o=t.user.btnList,r=new Array,i=o.length,n=new Object,a=0;i>a;a++){var s=o[a];"学习中心"==s?(n=_.find(t.appConfig.loginHref,{usertype:0}),r.push({btnname:s,href:n.href,usertype:0,isSelected:!1})):"班级中心"==s?(n=_.find(t.appConfig.loginHref,{usertype:1}),r.push({btnname:s,href:n.href,usertype:1,isSelected:!1})):"校友中心"==s||(n=_.find(t.appConfig.loginHref,{usertype:2}),r.push({btnname:s,href:n.href,usertype:2,isSelected:!1}))}return r},HrefCenterUrl:function(e,n,i){var a="";"学习中心"==e?(a="../api/multiclass/GetMultiClass",r.getUrlData(a,{accountid:t.user.accountId},function(e){if("multiclass"==e.code){e.multiclass;i(e)}else"failed"==e.code?i(e):location.href="../"+n},function(e){})):"班级中心"==e?(a="../api/teacherInClass",r.getUrlData(a,{accountid:t.user.accountId,platformid:t.user.platformid},function(e){"success"==e.code?location.href="../"+n:o.alert(e.message)},function(e){})):"管理中心"==e?r.getUrlData("../api/setplatformid",{},function(e){location.href="../"+n.replace("[domain]",t.user.domain)},function(e){}):"校友中心"==e?r.getUrlData("../api/inMateCenter",{accountid:t.user.accountId},function(e){"success"==e.code?location.href="../"+n:o.alert(e.message)},function(e){}):location.href=n},GetPermissionList:function(e,r){var n=[];if(0==t.user.permissionDic.length)return n;for(var o in e){var i=_.find(t.user.permissionDic,{Name:e[o].title});void 0!=i&&n.push(e[o])}return n},HrefToIndex:function(){return"../html/index.html"},HrefToSubIndex:function(e){return"../"+e+"/index.html"},GetStudent:function(r,n){return e.post("../api/getStudentInfo",{studentid:r}).success(function(e){return e[0].classid!=n?(location.href="../html/index.html",void alert("该学员不属于该班级")):(t.user.accountId=e[0].accountid,t.user.classId=e[0].classid,void(t.user.studentId=e[0].id))}).error(function(e){})}}}]).service("FilesService",["$http","$rootScope","Upload","Base64",function(e,t,r,n){return{upLoadFiles:function(e,t,n){var o=r.upload({url:"../api/uploadfile",file:e,data:{upcategory:t}});o.then(n)},upLoadPicture:function(e,t,n,o){var i=r.upload({url:"../api/uploadfile",file:e,data:t});i.then(n,o)},getDefaultImage:function(e,r,n){if(null==n||""==n){var o="";switch(e){case"userPhoto":case"teacherPhoto":o="../img/default_img.png";break;case"coursewarePhoto":case"livePhoto":o="../img/course_img.jpg"}return o}var i=t.appConfig.fileServer.rootPath,a=i+t.appConfig.fileServer[e]+"/"+r;return r.indexOf("/")>0&&(a=i+r),(r.indexOf("http://")>-1||r.indexOf("https://")>-1)&&(a=r),a},showFile:function(e,t,r){return this.getDefaultImage(e,t,r)},downFiles:function(e,r,n){var o=t.appConfig.fileServer.rootPath,i=o+t.appConfig.fileServer[e]+"/"+r;r.indexOf("/")>0&&(i=o+r),window.open(i)},downApiFiles:function(e,t,r){var o=n.encode(t).replace(/\+/g,"_"),i=n.encode(escape(r)).replace(/\+/g,"_"),a="../api/uploadfile/"+e+"/"+o+"/"+i;window.open(a)},getUserPhoto:function(){return void 0!=t.user?t.user.photopath?this.showFile("userPhoto",t.user.photopath,t.user.photopath):"../img/default_img.png":void 0},getUserThumbPhoto:function(){return void 0!=t.user?t.user.photopath?this.showFile("userPhoto",t.user.photothumbpath,t.user.photothumbpath):"../img/default_img.png":void 0}}}]).service("UserPhotoService",["$http","$rootScope","Upload","Base64","FilesService","CommonService","getDataSource",function(e,t,r,n,o,i,a){return{showFile:function(e,t,r){return o.getDefaultImage(e,t,r)},getUserPhoto:function(){return void 0!=t.user?t.user.photopath?this.showFile("userPhoto",t.user.photopath,t.user.photopath):"../img/default_img.png":void 0},getUserThumbPhoto:function(){return void 0!=t.user?t.user.photopath?this.showFile("userPhoto",t.user.photothumbpath,t.user.photothumbpath):"../img/default_img.png":void 0},updateAccountHeadImage:function(e,r){o.upLoadPicture(e,{upcategory:"userPhoto",width:80,height:80},function(e){if("200"==e.status&&e.data.length>=1){var n=e.data[0].servername,o=n.split("."),s=o[0]+"_small."+o[1],u={accountid:t.user.accountId,idphoto:e.data[0].servername,thumbname:s};a.getDataSource("updateUserInfoHeadImage",u,function(e){i.alert("修改图像成功！"),r&&r(!0),a.getUrlData("../api/changeuserphoto",{photopath:n,photothumbpath:s},function(e){},function(e){})},function(e){i.alert("修改图像失败！"),r&&r(!1)})}})}}}]).service("GetFileService",["$http","$rootScope","Base64","CommonService","getDataSource",function(e,t,r,n,o){return{getDefaultImage:function(e,r,n){if(null==n||""==n){var o="";switch(e){case"userPhoto":case"teacherPhoto":o="../img/default_img.png";break;case"coursewarePhoto":case"livePhoto":o="../img/course_img.jpg"}return o}var i=t.appConfig.fileServer.rootPath,a=i+t.appConfig.fileServer[e]+"/"+r;return r.indexOf("/")>0&&(a=i+r),(r.indexOf("http://")>-1||r.indexOf("https://")>-1)&&(a=r),a},showFile:function(e,t,n){return"pptCourseFile"==e?"../api/uploadfile/"+e+"/"+r.encode(t).replace(/\+/g,"_")+"/"+r.encode(n).replace(/\+/g,"_"):this.getDefaultImage(e,t,n)},getUserPhoto:function(){return void 0!=t.user?t.user.photopath?this.showFile("userPhoto",t.user.photopath,t.user.photopath):"../img/default_img.png":void 0},getUserThumbPhoto:function(){return void 0!=t.user?t.user.photopath?this.showFile("userPhoto",t.user.photothumbpath,t.user.photothumbpath):"../img/default_img.png":void 0}}}]).service("Base64",function(){var e={table:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],UTF16ToUTF8:function(e){for(var t=[],r=e.length,n=0;r>n;n++){var o=e.charCodeAt(n);if(o>0&&127>=o)t.push(e.charAt(n));else if(o>=128&&2047>=o){var i=192|o>>6&31,a=128|63&o;t.push(String.fromCharCode(i),String.fromCharCode(a))}else if(o>=2048&&65535>=o){var i=224|o>>12&15,a=128|o>>6&63,s=128|63&o;t.push(String.fromCharCode(i),String.fromCharCode(a),String.fromCharCode(s))}}return t.join("")},UTF8ToUTF16:function(e){for(var t=[],r=e.length,n=0,n=0;r>n;n++){var o=e.charCodeAt(n);if(0==(o>>7&255))t.push(e.charAt(n));else if(6==(o>>5&255)){var i=e.charCodeAt(++n),a=(31&o)<<6,s=63&i,u=a|s;t.push(Sting.fromCharCode(u))}else if(14==(o>>4&255)){var i=e.charCodeAt(++n),c=e.charCodeAt(++n),a=o<<4|i>>2&15,s=(3&i)<<6|63&c;u=(255&a)<<8|s,t.push(String.fromCharCode(u))}}return t.join("")},encode:function(e){if(!e)return"";for(var t=this.UTF16ToUTF8(e),r=0,n=t.length,o=[];n>r;){var i=255&t.charCodeAt(r++);if(o.push(this.table[i>>2]),r==n){o.push(this.table[(3&i)<<4]),o.push("==");break}var a=t.charCodeAt(r++);if(r==n){o.push(this.table[(3&i)<<4|a>>4&15]),o.push(this.table[(15&a)<<2]),o.push("=");break}var s=t.charCodeAt(r++);o.push(this.table[(3&i)<<4|a>>4&15]),o.push(this.table[(15&a)<<2|(192&s)>>6]),o.push(this.table[63&s])}return o.join("")},decode:function(e){if(!e)return"";for(var t=e.length,r=0,n=[];t>r;)code1=this.table.indexOf(e.charAt(r++)),code2=this.table.indexOf(e.charAt(r++)),code3=this.table.indexOf(e.charAt(r++)),code4=this.table.indexOf(e.charAt(r++)),c1=code1<<2|code2>>4,c2=(15&code2)<<4|code3>>2,c3=(3&code3)<<6|code4,n.push(String.fromCharCode(c1)),64!=code3&&n.push(String.fromCharCode(c2)),64!=code4&&n.push(String.fromCharCode(c3));return this.UTF8ToUTF16(n.join(""))}};return e}).service("chatService",["$http","$rootScope",function(e,t){return{getsignalR:function(){return e.get("../bower_components/signal/jquery.signalR-2.2.0.min.js")},getChatHub:function(){e.get(t.appConfig.signalRHub)}}}]).service("DateService",["getDataSource",function(e){return{getDateTimeStamp:function(e){return this.parserDate(e)},getDateDiff:function(e){var t=6e4,r=60*t,n=24*r,o=30*n,i=12*o,a=(new Date).getTime(),s=a-e;if(0>s)return"刚刚";var u=s/i;if(u>=1)return parseInt(u)+"年前";var c=s/o;if(c>=1)return parseInt(c)+"个月前";var f=s/(7*n);if(f>=1)return parseInt(f)+"周前";var p=s/n;if(p>=1)return parseInt(p)+"天前";var l=s/r;if(l>=1)return parseInt(l)+"个小时前";var d=s/t;return d>=1?parseInt(d)+"分钟前":"刚刚"},format:function(e,t){var r=this.parserDate(e),n={"M+":r.getMonth()+1,"d+":r.getDate(),"h+":r.getHours(),"m+":r.getMinutes(),"s+":r.getSeconds(),"q+":Math.floor((r.getMonth()+3)/3),S:r.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(r.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in n)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[o]:("00"+n[o]).substr((""+n[o]).length)));return t},getDayDiff:function(e,t){var r=this.getDateTimeStamp(this.format(e,"yyyy-MM-dd")),n=this.getDateTimeStamp(this.format(t,"yyyy-MM-dd")),o=6e4,i=60*o,a=24*i,s=n-r,u=s/a;return parseInt(u)},parserDate:function(e){var t;return"string"==typeof e?(t=new Date(e.replace(/-/g,"/").replace(/T|Z/g," ").trim()),isNaN(t)&&(t=new Date(Date.parse(e)))):t=new Date(Date.parse(e)),t},getWeek:function(e){var t=this.parserDate(e).getDay(),r=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];return r[t]},getTimeToWeek:function(e){var t;t=e?new Date(e):new Date;var r,n;return 0==t.getDay()&&(r="星期日"),1==t.getDay()&&(r="星期一"),2==t.getDay()&&(r="星期二"),3==t.getDay()&&(r="星期三"),4==t.getDay()&&(r="星期四"),5==t.getDay()&&(r="星期五"),6==t.getDay()&&(r="星期六"),yr=t.getYear(),yr<1e3&&(yr+=1900),n=yr+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日 "+r},getTodayDateSpan:function(t,r){var n=this;e.getDataSource("getServerTime",{},function(e){t(n.getTimeToWeek(e[0].servertime))},function(e){t(n.getTimeToWeek(null))})},secondsToTime:function(e){var t=0,r=0,n=parseInt(e);n>60&&(r=parseInt(n/60),n=parseInt(n%60),r>60&&(t=parseInt(r/60),r=parseInt(r%60)),n>0&&(r+=1));var o=function(e){return 10>e>>0?"0"+e:e};return o(t)+"小时"+o(r)+"分钟"},secondsToHHmmss:function(e){var t=0,r=0,n=parseInt(e);n>60&&(r=parseInt(n/60),n=parseInt(n%60),r>60&&(t=parseInt(r/60),r=parseInt(r%60)));var o=function(e){return 10>e>>0?"0"+e:e};return o(t)+":"+o(r)+":"+o(n)},getDateTimeDifference:function(e,t){var r=this.parserDate(e),n=this.parserDate(t),o=n-r,i=o/24/60/60/1e3;return parseInt(i)}}}]).service("CommonService",["$rootScope","notify",function(e,t){return{getQuery:function(e){var t=location.href,r=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=t.substr(t.indexOf("?")+1).match(r);return null!=n?unescape(n[2]):null},alert:function(e){var r={duration:"2000",position:"center"};"string"==typeof e?(r.message=e,t(r)):"object"==typeof e&&(r=_.merge(r,e),t(r))},layAlert:function(e){"string"==typeof e?layer.alert(e,{icon:1}):"object"==typeof e&&layer.alert(e,{icon:1})},layOpen:function(e){"string"==typeof e?layer.open({type:1,content:e}):"object"==typeof e&&layer.open(e)},layErrorAlert:function(e){"string"==typeof e?layer.alert(e,{icon:2}):"object"==typeof e&&layer.alert(e,{icon:2})},confirm:function(e,t,r){layer.confirm(e,{btn:["确定","取消"]},function(e,r){t()},function(e){r()})},autoHeight:function(e,t){function r(){var e=document.documentElement;return self.innerHeight||e&&e.clientHeight||document.body.clientHeight}var n=200;angular.forEach(e,function(e){n+=$(e).height()}),alert(r()-n),$(t).height(r()-n)},error:function(e){this.alert(JSON.stringify(e))},getJoinString:function(e,t){var r="";return angular.forEach(e,function(e){r+=e[t]+","}),r.length>0&&(r=r.substring(0,r.length-1)),r},addMiniuts:function(e,t){var r=60*parseInt(t.split(":")[0])+parseInt(t.split(":")[1]);return new Date(e.setMinutes(e.getMinutes()+r,e.getSeconds(),0))},checkNum:function(r,n,o,i){return isNaN(parseFloat(o))?void t({message:"输入的不是数字",classes:"alert-danger",templateUrl:e.appConfig.defaultNoticeUrl}):r&&!n&&parseFloat(r)>o?(defaultStatus&&(o=i),void t({message:"输入的值太小",classes:"alert-danger",templateUrl:e.appConfig.defaultNoticeUrl})):void 0},formatUint:function(e){var t=parseInt(e);return 1e3>t?t+="个":t=t>=1e3&&1e4>t?parseFloat(parseFloat(t)/1e3).toFixed(1).toString()+"千":parseFloat(parseFloat(t)/1e4).toFixed(1).toString()+"万",t},formatUintArray:function(e){var t=new Array,r=parseInt(e);return 1e3>r?t.push({value:r.toString(),uint:"个"}):r>=1e3&&1e4>r?t.push({value:parseFloat(parseFloat(r)/1e3).toFixed(1).toString(),uint:"千"}):t.push({value:parseFloat(parseFloat(r)/1e4).toFixed(1).toString(),uint:"万"}),t},formatUintArrayInfo:function(e){var t=new Array,r=parseInt(e);return 1e3>r?t.push({value:r.toString(),uint:""}):r>=1e3&&1e4>r?t.push({value:parseFloat(parseFloat(r)/1e3).toFixed(1).toString(),uint:"K"}):t.push({value:parseFloat(parseFloat(r)/1e4).toFixed(1).toString(),uint:"W"}),t},uaMatch:function(){var e,t,r=navigator.userAgent,n=/(msie\s|trident\/7)([\w.]+)/,o=/(trident)\/([\w.]+)/,i=/(firefox)\/([\w.]+)/,a=/(opera).+version\/([\w.]+)/,s=/(opr)\/(.+)/,u=/(chrome)\/([\w.]+)/,c=/version\/([\w.]+).*(safari)/,f=r.toLowerCase(),p=f.indexOf("nt 10.0")>-1,l=f.indexOf("nt 6.1")>-1,d=f.indexOf("nt 6.0")>-1,g=f.indexOf("nt 5.2")>-1,h=f.indexOf("nt 5.1")>-1,m=f.indexOf("nt 5.0")>-1,v=-1!=f.indexOf("windows")||-1!=f.indexOf("win32"),S=-1!=f.indexOf("macintosh")||-1!=f.indexOf("mac os x"),y=-1!=f.indexOf("adobeair"),w=-1!=f.indexOf("linux"),I="";if(I=l?"Windows 7":d?"Vista":h?"Windows xp":p?"Windows 10":g?"Windows 2003":m?"Windows 2000":v?"Windows":S?"Macintosh":y?"Adobeair":w?"Linux":"Unknow",e=n.exec(f),null!=e){if(t=o.exec(f),null==t)return{sys:I,browser:"IE",version:e[2]||"0",useragent:f};switch(t[2]){case"4.0":return{sys:I,browser:"IE",version:"8",useragent:f};case"5.0":return{sys:I,browser:"IE",version:"9",useragent:f};case"6.0":return{sys:I,browser:"IE",version:"10",useragent:f};case"7.0":return{sys:I,browser:"IE",version:"11",useragent:f};default:return{sys:I,browser:"IE",version:"undefined",useragent:f}}}return e=i.exec(f),null==e||window.attachEvent||window.chrome||window.opera?(e=a.exec(f),null==e||window.attachEvent?(e=u.exec(f),null!=e&&window.chrome&&!window.attachEvent?(t=s.exec(f),null==t?{sys:I,browser:e[1]||"",version:e[2]||"0",useragent:f}:{sys:I,browser:"Opera",version:t[2]||"0",useragent:f}):(e=c.exec(f),null==e||window.attachEvent||window.chrome||window.opera?null!=e?{sys:I,browser:"undefined",version:" browser",useragent:f}:void 0:{sys:I,browser:e[2]||"",version:e[1]||"0",useragent:f})):{sys:I,browser:e[1]||"",version:e[2]||"0",useragent:f}):{sys:I,browser:e[1]||"",version:e[2]||"0",useragent:f}},checkIDCard:function(e){var t,r,n,o,i=(new Array("验证通过!","身份证号码位数不对!","出生日期超出范围或含有非法字符!","身份证号码校验错误!","身份证地区非法!"),{11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"}),a=new Array;if(a=e.split(""),null==i[parseInt(e.substr(0,2))])return!1;switch(e.length){case 15:return(parseInt(e.substr(6,2))+1900)%4==0||(parseInt(e.substr(6,2))+1900)%100==0&&(parseInt(e.substr(6,2))+1900)%4==0?ereg=/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}$/:ereg=/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}$/,!!ereg.test(e);case 18:return parseInt(e.substr(6,4))%4==0||parseInt(e.substr(6,4))%100==0&&parseInt(e.substr(6,4))%4==0?ereg=/^[1-9][0-9]{5}[1-9]\d{3}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}[0-9Xx]$/:ereg=/^[1-9][0-9]{5}[1-9]\d{3}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}[0-9Xx]$/,ereg.test(e)?(n=7*(parseInt(a[0])+parseInt(a[10]))+9*(parseInt(a[1])+parseInt(a[11]))+10*(parseInt(a[2])+parseInt(a[12]))+5*(parseInt(a[3])+parseInt(a[13]))+8*(parseInt(a[4])+parseInt(a[14]))+4*(parseInt(a[5])+parseInt(a[15]))+2*(parseInt(a[6])+parseInt(a[16]))+1*parseInt(a[7])+6*parseInt(a[8])+3*parseInt(a[9]),t=n%11,o="F",r="10X98765432",o=r.substr(t,1),o==a[17]):!1;default:return!1}},initInputControlDisabled:function(){$("input").each(function(){$(this).attr("disabled",!0)}),$("select").each(function(){$(this).attr("disabled",!0)}),$(".platformdisabled").each(function(){$(this).attr("style","display:none;")})}}}]).factory("$debounce",["$rootScope","$browser","$q","$exceptionHandler",function(e,t,r,n){function o(o,u,c){var f,p,l,d=r.defer(),g=d.promise,h=angular.isDefined(c)&&!c,m=!1;angular.forEach(a,function(e,t){angular.equals(a[t].fn,o)&&(m=!0,l=t)}),m?(i[a[l].timeoutId].reject("bounced"),t.defer.cancel(a[l].timeoutId)):(l=s++,a[l]={fn:o});var v=function(){delete a[l];try{d.resolve(o())}catch(t){d.reject(t),n(t)}h||e.$apply()};return f=t.defer(v,u),a[l].timeoutId=f,p=function(e){delete i[g.$$timeoutId]},g.$$timeoutId=f,i[f]=d,g.then(p,p),g}var i={},a={},s=0;return o.cancel=function(e){return e&&e.$$timeoutId in i?(i[e.$$timeoutId].reject("canceled"),t.defer.cancel(e.$$timeoutId)):!1},o}]).service("StudyService",["$http","$rootScope","$stateParams","getDataSource","CommonService",function(e,t,r,n,o){return{getStudyData:function(t,r,n){return e.post("../api/studentstudy",JSON.stringify(t)).success(function(e){r(e)}).error(function(e){n(e)})},getStuSignStatus:function(){var r={classid:t.user.classId,accountid:t.user.accountId};return e.post("../api/GetStuSignStatus",JSON.stringify(r)).success(function(e){var r=e;t.user.signstatus=r.signstatus}).error(function(e){})},updateStudyStatus:function(n){var i=this,a={classcourseid:r.classcourseid,coursewareid:r.coursewareid,studentid:t.user.studentId,classid:t.user.classId,accountid:t.user.accountId};return n=_.merge(a,n),e.post("../api/updatestudystatus",JSON.stringify(n)).success(function(e){e.result&&i.updateStudentStudyStatus(n)}).error(function(e){o.error(e)})},updateStudentStudyStatus:function(t){return e.post("../api/updatestudentstudystatus",JSON.stringify(t)).success(function(e){}).error(function(e){o.error(e)})}}}]).service("CookieService",["$rootScope",function(e){return{get:function(e){return $.cookie(e)},remove:function(e){return $.cookie(e,null)},save:function(e,t,r){var n={expires:7,path:"/"};$.extend(n,r),$.cookie(e,t,n)}}}]);