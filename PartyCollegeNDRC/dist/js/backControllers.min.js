app.controller("accountController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource","Base64",function(e,t,a,n,i,o,r,l,s){var c={pageNumber:1,pageSize:25,sort:null};e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,useExternalPagination:!0,data:[],columnDefs:[{name:"登录名",field:"logname",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"姓名",field:"name",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"性别",field:"sex",width:"7%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"sexFilter"},{name:"联系方式",field:"cellphone",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建时间",field:"createtime",width:"13%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"date:'yyyy-MM-dd HH:mm:ss'"},{name:"职级",field:"rank",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"所属机构",field:"departmentname",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"激活状态",field:"signstatus",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"activeStatus"},{name:"登录状态",field:"status",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"lockStatus"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){c.pageNumber=t,c.pageSize=a,e.loadGrid()})}},e.goDetial=function(e){r.go("index.accountedit",{id:e.entity.id})},e.search={},e.search.signstatus="1",e.search.signstatus_dbcolumn="signstatus",e.search.signstatus_dbtype="int",e.search.signstatus_handle="equal",e.loadGrid=function(a){0==a&&(e.search_departmentid=t.user.pids);var n=(c.pageNumber-1)*c.pageSize,i=c.pageSize,o=["getAllStudent"];l.getList(o,{selectedpids:e.search_departmentid,selectedpids2:e.search_departmentid},{firstRow:n,pageSize:i},e.search,c.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data},function(e){console.log(e)})},e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.gridOptions.totalItems=0,e.gridOptions.data=[],e.loadGrid()},e.close=function(){e.modalInstance.dismiss("cancel")},e.ok=function(){e.isAccept=!0;for(var a=new Array,n=new Object,i=e.gridApi.selection.getSelectedRows(),r=i.length,s=0;r>s;s++)n=new Object,n.id=i[s].id,n.status=1,a.push(n);l.doArray("lockAccount",a,function(){o({message:"操作成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadGrid()},function(e){o({message:"操作失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})}),e.close()},e.lockUser=function(){e.modalInstance=a.open({templateUrl:"confirm.html",size:"sm",scope:e})},e.unLockUser=function(){for(var a=new Array,n=new Object,i=e.gridApi.selection.getSelectedRows(),r=i.length,s=0;r>s;s++)n=new Object,n.id=i[s].id,n.status=0,a.push(n);l.doArray("lockAccount",a,function(){o({message:"启用成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadGrid()},function(e){o({message:"启用失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})},e.resetUserPwd=function(){e.modalInstance=a.open({templateUrl:"resetpwd.html",size:"lg",scope:e})},e.accobj={submit:function(){e.resetPwd()}},e.resetbtn=!1,e.resetPwd=function(){e.resetbtn=!0;for(var a=new Array,n=new Object,i=e.gridApi.selection.getSelectedRows(),r=i.length,c=s.encode(e.accobj.hashpwd),d=0;r>d;d++)n=new Object,n.id=i[d].id,n.newpwd=c,a.push(n);l.getUrlData("../api/account/resetuserpwd",a,function(){o({message:"密码重置成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.close(),e.resetbtn=!1},function(a){o({message:"密码重置失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.resetbtn=!1})},e.close=function(){e.modalInstance.dismiss("cancel")},e.nodeselect=function(t){e.search_departmentid=t.pids}}]),angular.module("myApp").controller("accountEditController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){e.accForm=new Object,e.accForm.rolelist=new Array,e.accForm.name="",e.accForm.logname="",e.accForm.pwd="",e.accForm.cellphone="",e.accForm.idcard="",e.accForm.accountid="",e.formInput=new Object,e.formInput.lognameDisabled=!0,e.formInput.pwdDisabled=!0,e.formInput.idcardDisabled=!0,e.formInput.nameDisabled=!0,e.formInput.cellphoneDisabled=!0,e.formBtn=new Object,e.formBtn.saveButtonDisabled=!1;var s=i.id;""!=s&&(e.accForm.accountid=s,l.getDataSource(["getAccountById","getAccountRole"],{accid:s},function(t){e.accForm=_.find(t,{name:"getAccountById"}).data[0],e.accForm.accountid=s,e.accForm.pwd="******";for(var a=_.find(t,{name:"getAccountRole"}).data,n=_.filter(a,{accountid:s}),i=new Object,o=new Array,r=n.length,l=0;r>l;l++)i=new Object,i.id=n[l].id,i.name=n[l].name,i.platformname=n[l].platformname,o.push(i);e.accForm.rolelist=o},function(e){})),l.getDataSource("getRoleList",{platformid:t.user.platformid},function(t){for(var a=new Object,n=new Array,i=t.length,o=0;i>o;o++)a=new Object,a.id=t[o].id,a.name=t[o].name,a.platformname=t[o].platformname,n.push(a);e.roles=n},function(e){}),e.goToList=function(){r.go("index.account")},e.saveAccount=function(){e.saveButtonDisabled=!0,l.getUrlData("../api/account/SaveAccount",e.accForm,function(a){e.saveButtonDisabled=!1,o("success"==a.code?{message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}:{message:a.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})},function(t){e.saveButtonDisabled=!1})}}]),app.controller("importaccController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource","CommonService",function(e,t,a,n,i,o,r,l,s){e.acclist=new Array,e.textareastr="",e.disableBtn=!1,e.errorlist=new Array,e.importAccount=function(){e.disableBtn=!0,e.beginLoading=!e.beginLoading;for(var t=e.textareastr.replace(new RegExp(/(	)/g),","),a=t.split("\n"),n=a.length,i=new Array,o=new Array,r=0;n>r;r++)i=a[r].split(","),i[2]=md5(i[2]),o.push(i);l.getUrlData("../api/account/importAccount",{submitdata:o},function(t){e.disableBtn=!1,e.beginLoading=!1,"success"==t.code?(s.alert(t.message),e.errorlist=t.errorlist):s.alert(t.message)},function(t){e.disableBtn=!1,s.alert("注册失败")})}}]),angular.module("myApp").controller("alumnusCoursewareController",["$scope","$rootScope","getDataSource","$state","notify",function(e,t,a,n,i){var o={pageNumber:1,pageSize:25,sort:null};e.search={},e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"课程名称",field:"name",width:"49%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.name}}</a></div>'},{name:"授课人",field:"teachersname",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"授课时间",field:"teachtime",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建时间",field:"createtime",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){o.pageNumber=t,o.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)o.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),o.sort=n}e.loadGrid()})}},e.goDetial=function(e){n.go("index.coursewareEdit",{id:e.entity.coursewareid,type:"1"})},e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()},e.loadGrid=function(){var t=(o.pageNumber-1)*o.pageSize,n=o.pageSize;a.getList("alumnuscourseware-listall",{},{firstRow:t,pageSize:n},e.search,o.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadGrid(),e["delete"]=function(){var n=e.gridApi.selection.getSelectedRows();null!=n&&void 0!=n&&n.length>0&&a.doArray("delete_sy_alumnus_coursewarebycoursewareid",n,function(a){i({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadGrid()})}}]),angular.module("myApp").controller("alumnusUserAddController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){e.accForm=new Object,e.accForm.name="",e.accForm.companyaddress="",e.accForm.company="",e.accForm.cellphone="",e.accForm.idcard="",e.accForm.sex=0,e.accForm.id="",e.formInput=new Object,e.formBtn=new Object;i.id;e.goToList=function(){r.go("index.alumnusUserlist")},i.id&&l.getDataSource("select_sy_alumnus_studentbyid",{id:i.id},function(t){e.accForm.id=t[0].id,e.accForm.name=t[0].name,e.accForm.companyaddress=t[0].companyaddress,e.accForm.company=t[0].company,e.accForm.cellphone=t[0].cellphone,e.accForm.idcard=t[0].idcard,e.accForm.sex=t[0].sex}),e.saveDisabled=!1,e.saveAccount=function(){return e.saveDisabled=!0,""==e.accForm.name?(o({message:"请输入姓名！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.saveDisabled=!1)):""==e.accForm.idcard?(o({message:"请输入身份证！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.saveDisabled=!1)):""==e.accForm.cellphone?(o({message:"请输入联系方式！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.saveDisabled=!1)):void l.getUrlData("../api/poststudent",e.accForm,function(a){"success"==a.status?(e.saveDisabled=!1,o({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.goToList()):(e.saveDisabled=!1,o({message:a.errorMessage,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl}))},function(t){e.saveDisabled=!1})}}]),angular.module("myApp").controller("alumnusUserEditController",["$scope","$rootScope","getDataSource","$stateParams","notify","$modal","FilesService","$state","$filter",function(e,t,a,n,i,o,r,l,s){e.renewCardShow=!1,e.user={},e.gridOptions={data:[],columnDefs:[{name:"序列号",field:"title",width:"28%"},{name:"有效时长",field:"enableddays",width:"19%"},{name:"开始时间",field:"begindate",width:"16%"},{name:"结束时间",field:"enddate",width:"16%"},{name:"操作人",field:"createuser",width:"20%"}],onRegisterApi:function(t){e.gridApi=t}};(function(){n.id&&(a.getDataSource("select_sy_alumnus_accountbyid",{id:n.id},function(t){e.user=t[0],null!=e.user.photo_serverthumbname&&void 0!=e.user.photo_serverthumbname&&""!=e.user.photo_serverthumbname?e.user.filename=r.showFile("userPhoto",e.user.photo_serverthumbname,e.user.photo_serverthumbname):e.user.filename="../img/default_img.png",void 0!=e.user.enddate&&(e.renewCardShow=!0)}),a.getDataSource("select_sy_alumnus_renew_logbystudentid",{studentid:n.id},function(t){e.gridOptions.data=t}))})();e.modalInstance=null,e.renew={},e.getRenewCard=function(){a.getUrlData("../api/getRenewCard",{id:n.id},function(t){e.renew=t,e.modalInstance=o.open({templateUrl:"renewcard.html",size:"lg",scope:e})},function(e){})},e.saveDisabled=!1,e.saveRenewCard=function(){e.saveDisabled=!0,e.renew.studentid=n.id,e.renew.studentname=e.user.name,e.renew.createuser=t.user.name,e.renew.createuserid="",a.getUrlData("../api/RenewCard",e.renew,function(o){"success"==o.status?(e.saveDisabled=!1,i({message:"续费成功！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.close(),a.getDataSource("select_sy_alumnus_renew_logbystudentid",{studentid:n.id},function(t){e.gridOptions.data=t})):(e.saveDisabled=!1,i({message:"续费失败！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}))},function(t){e.saveDisabled=!1})},e.$watch("renew.begindate",function(t,a){void 0!=a&&e.changeDate()}),e.$watch("renew.reffectivetime",function(t,a){void 0!=a&&e.changeDate()}),e.$watch("renew.reffectiveunit",function(t,a){void 0!=a&&e.changeDate()}),e.format=function(e,t){var a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in a)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[n]:("00"+a[n]).substr((""+a[n]).length)));return t},e.changeDate=function(){var t=new Date(s("date")(e.renew.begindate,"yyyy-MM-dd"));0==e.renew.reffectiveunit?t.setFullYear(t.getFullYear()+parseInt(e.renew.reffectivetime)):t.setMonth(t.getMonth()+parseInt(e.renew.reffectivetime)),t.setDate(t.getDate()-1),e.renew.enddate=e.format(t,"yyyy-MM-dd")},e.close=function(){e.modalInstance.dismiss("cancel")},e.goToList=function(){l.go("index.alumnusUserlist")}}]),angular.module("myApp").controller("alumnusUserlistController",["$scope","$rootScope","getDataSource","$state","notify",function(e,t,a,n,i){var o={pageNumber:1,pageSize:25,sort:null};e.search={},e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,useExternalPagination:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"姓名",field:"name",width:"24%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goAddUser(row)">{{row.entity.name}}</a></div>'},{name:"登录名",field:"logname",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"手机号码",field:"cellphone",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"身份证号码",field:"idcard",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"续费",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">续费</a></div>'}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){o.pageNumber=t,o.pageSize=a,e.loadSource()})}},e.loadSource=function(){var t=(o.pageNumber-1)*o.pageSize,n=o.pageSize;a.getList("select_sy_alumnus_account",{},{firstRow:t,pageSize:n},e.search,o.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadSource(),e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadSource()},e.goAddUser=function(e){n.go("index.alumnusUserAdd",{id:e.entity.id})},e.goDetial=function(e){n.go("index.alumnusUserEdit",{id:e.entity.id})},e["delete"]=function(){var n=e.gridApi.selection.getSelectedRows();a.doArray("delete_sy_alumnus_student",n,function(a){i({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadSource()})}}]),angular.module("myApp").controller("cardEditController",["$scope","$rootScope","getDataSource","$stateParams","notify","FilesService","$state",function(e,t,a,n,i,o,r){e.card={},e.serialShow=!1,e.cardid=n.id,e.opationConfig={saveCardShow:!0,serialCardShow:!1,useCardShow:!1,exportCardShow:!1,useCardExitShow:!1},e.gridOptions={data:[],columnDefs:[{name:"序列号",field:"serialno",width:"25%"},{name:"有效时长",width:"19%",cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope.card.effectivetime}}{{grid.appScope.card.effectiveunitcn}}</div>'},{name:"状态",field:"statuscn",width:"15%"},{name:"开始时间",field:"begindate",width:"16%"},{name:"结束时间",field:"enddate",width:"12%"},{name:"使用用户",field:"studentname",width:"10%"}],onRegisterApi:function(t){e.gridApi=t}},e.dataload=function(){n.id&&a.getDataSource("select_sy_alumnus_card_byid",{id:n.id},function(t){e.card=t[0],1==e.card.state?(e.opationConfig.saveCardShow=!1,e.opationConfig.exportCardShow=!0,e.opationConfig.useCardExitShow=!0):(e.opationConfig.useCardShow=!0,e.opationConfig.serialCardShow=!0),a.getDataSource("select_sy_alumnus_serial",{pid:n.id},function(t){t.length>0&&(e.opationConfig.serialCardShow=!1,e.serialShow=!0,e.gridOptions.data=t)})})},e.dataload(),e.saveDisabled=!1,e.serialCard=function(){e.saveDisabled=!0,n.id&&a.getUrlData("../api/serialcard",{id:n.id,enableddays:e.card.effectivetime,dayuint:e.card.effectiveunit,createuser:t.user.name,sequenceCount:e.card.sequencecount},function(t){e.saveDisabled=!1,e.opationConfig.serialCardShow=!1,a.getDataSource("select_sy_alumnus_serial",{pid:n.id},function(t){t.length>0&&(e.opationConfig.serialCardShow=!1,e.serialShow=!0,e.gridOptions.data=t)})},function(t){e.saveDisabled=!1})},e.exportCard=function(){n.id&&(window.location="../api/exportcard/"+n.id+"/"+e.card.name)},e.saveDisabled=!1,e.saveCard=function(){if(e.saveDisabled=!0,""==e.card.name||void 0==e.card.name||null==e.card.name)return i({message:"批次名称不能为空！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.saveDisabled=!1);if(void 0==e.card.effectivetime||void 0==e.card.effectiveunit)return i({message:"请选择有效时长！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.saveDisabled=!1);if(""==e.card.courselength||void 0==e.card.courselength||null==e.card.courselength)return i({message:"课程数为空！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.saveDisabled=!1);if(""==e.card.price||void 0==e.card.price||null==e.card.price)return i({message:"价格不能为空！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.saveDisabled=!1);if(""==e.card.sequencecount||void 0==e.card.sequencecount||null==e.card.sequencecount)return i({message:"序列号数不能为空！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.saveDisabled=!1);if(n.id){var o="保存成功";a.getDataSource("save_sy_alumnus_card",e.card,function(a){e.saveDisabled=!1,i({message:o,classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(t){e.saveDisabled=!1})}else{var l=a.getGUID();e.card.id=l,a.getDataSource("insert_sy_alumnus_card",e.card,function(a){e.saveDisabled=!1,i({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),r.go("index.cardEdit",{id:l})},function(t){e.saveDisabled=!1})}},e.useCard=function(){a.getDataSource("use_sy_alumnus_card",{useuserid:t.user.accountId,state:1,userusername:t.user.name,id:e.card.id,pid:e.card.id},function(a){i({message:"制卡成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.dataload()})},e.useCardExit=function(){a.getDataSource("use_sy_alumnus_card_zh",{useuserid:t.user.accountId,state:-1,userusername:t.user.name,id:e.card.id,pid:e.card.id},function(a){i({message:"作废成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.dataload()})},e.goToList=function(){r.go("index.cardList")},e.inputKeyDown=function(e){var t=window.event||e;t.keyCode>47&&t.keyCode<58||8==t.keyCode||t.preventDefault()}}]),angular.module("myApp").controller("cardListController",["$scope","$rootScope","getDataSource","$state","notify",function(e,t,a,n,i){var o={pageNumber:1,pageSize:25,sort:null};e.search={},e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"批次名称",field:"name",width:"39%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.name}}</a></div>'},{name:"有效时长",field:"effectivetime",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.effectivetime}}{{row.entity.effectiveunicn}}</div>'},{name:"课程数",field:"courselength",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"价格",field:"price",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"序列号数",field:"sequencecount",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"状态",field:"statecn",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(t){e.gridApi=t}},e.loadSource=function(){var t=(o.pageNumber-1)*o.pageSize,n=o.pageSize;a.getList("select_sy_alumnus_card",{},{firstRow:t,pageSize:n},e.search,o.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadSource(),e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadSource()},e.goDetial=function(e){n.go("index.cardEdit",{id:e.entity.id})},e["delete"]=function(){var n=e.gridApi.selection.getSelectedRows();a.doArray("delete_sy_alumnus_card",n,function(a){i({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadSource()})}}]),angular.module("myApp").controller("renewlogController",["$scope","$rootScope","getDataSource","$state","notify",function(e,t,a,n,i){var o={pageNumber:1,pageSize:25,sort:null};e.search={},e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"序列号",field:"title",width:"29%",headerCellClass:"mycenter"},{name:"有效时长",field:"enableddays",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"开始时间",field:"begindate",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"结束时间",field:"enddate",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"使用用户",field:"studentname",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建时间",field:"createdate",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"操作人",field:"createuser",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(t){e.gridApi=t}},e.loadSource=function(){var t=(o.pageNumber-1)*o.pageSize,n=o.pageSize;a.getList("select_sy_alumnus_renew_log",{},{firstRow:t,pageSize:n},e.search,o.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadSource(),e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadSource()},e.goDetial=function(e){n.go("index.cardEdit",{id:e.entity.id})},e["delete"]=function(){var n=e.gridApi.selection.getSelectedRows();a.doArray("delete_sy_alumnus_card",n,function(a){i({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadSource()})}}]),angular.module("myApp").controller("selectCoursewareController",["$scope","$rootScope","getDataSource","$state","notify",function(e,t,a,n,i){var o={pageNumber:1,pageSize:25,sort:null};e.search={},e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"课程名称",field:"name"},{name:"授课人",field:"teachersname"},{name:"授课时间",field:"teachtime"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){o.pageNumber=t,o.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)o.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),o.sort=n}e.loadGrid()})}},e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()},e.loadGrid=function(){var t=(o.pageNumber-1)*o.pageSize,n=o.pageSize;a.getList("selectcourseware-listall",{},{firstRow:t,pageSize:n},e.search,o.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadGrid(),e.saveAlumnusCourseware=function(){var o=e.gridApi.selection.getSelectedRows();if(null!=o&&void 0!=o&&o.length>0){var r="";for(var l in o)""==r?r=o[l].id:r+=","+o[l].id;a.getUrlData("../api/saveAlumnusCourseware",{createuser:t.user.name,createuserid:t.user.accountId,ids:r},function(e){"success"==e.status?(i({message:"保存成功，共新增"+o.length+"条记录！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),n.go("index.alumnusCourseware",{})):i({message:"保存失败！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})}}}]),angular.module("myApp").controller("addbookController",["$scope","$rootScope","getDataSource","$stateParams","$modal","$timeout","$state","notify","FilesService","DateService",function(e,t,a,n,i,o,r,l,s,c){e.book={defaultCover:"../img/defaultcover.jpg",coverObj:null,cover_servername:null,cover_serverthumbname:null,bookname:"",author:"",comment:"",foreword:"",authorcomment:"",catalog:"",publishtime:"",publishcompany:"",videopath:"",videoname:"",status:0,istop:!1,platformid:t.user.platformid,id:a.getGUID()},e.videofile={files:[],process:0},e.optstatus={issuccess:!1,issave:!1,iscoverchanged:!1};var d=n.id;d&&(e.optstatus.ismodify=!0,a.getDataSource("getBookInfo",{id:d},function(t){e.book=_.merge(e.book,t[0]),e.book.coverObj=s.showFile("bookPhoto",e.book.cover_servername,e.book.cover_servername),e.book.istop=0!=e.book.istop,e.optstatus.issave=!0,e.optstatus.issuccess=!0},function(e){CommonService.alert("数据加载失败！")}));var u=function(e){l({message:e,classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})};e.changedCover=function(t,a){t.length>0&&(e.book.coverObj&&(e.optstatus.iscoverchanged=!0),e.book.coverObj=t[0])},e.uploadvideoFiles=function(t,a){t.length>0&&(e.videofile.files=t)},e.uploadvideo=function(){if(e.videofile.files.length>0){var a=/(?:\.([^.]+))?$/,n=a.exec(e.videofile.files.name)[1],i={endpoint:"http://v.polyv.net:1080/files/",resetBefore:$("#reset_before").prop("checked"),resetAfter:!1,title:"title",desc:"desc",ext:n,writeToken:t.appConfig.vhallConfig.writeToken};$(".progress").addClass("active"),upload=polyv.upload(e.videofile.files[0],i).fail(function(e){alert("Failed because: "+e)}).always(function(){}).progress(function(t,a,n){var i=(a/n*100).toFixed(2);e.videofile.process=i,e.$apply()}).done(function(t,a){e.optstatus.issuccess=!0,e.book.videoname=a.name,e.book.videopath=t.substring(t.lastIndexOf("/")+1),e.$apply()})}},e.close=function(){e.modalInstance.dismiss("cancel")},e.openVideoPerview=function(){e.modalInstance=i.open({templateUrl:"videoPerview.html",size:"lg",scope:e,resolve:{items:function(){return e.items}}}),o(function(){player=polyvObject("#divVideo").videoPlayer({width:"850",height:"490",vid:e.book.videopath})},0)},e.golist=function(){r.go("index.booklist")},e.uploadCover=function(t){s.upLoadPicture(e.book.coverObj,{upcategory:"bookPhoto",width:130,height:184},function(a){if("200"==a.status&&a.data.length>=1){var n=a.data[0].servername.split(".");e.book.cover_serverthumbname=n[0]+"_small."+n[1],e.book.cover_servername=n[0]+"."+n[1],e.optstatus.iscoverchanged=!1,t&&t()}else CommonService.alert("教材封面照片上传失败")})},e.saveDisabled=!1,e.save=function(){e.saveDisabled=!0;var n=function(){e.book.createuser=t.user.name,e.book.createdate=c.format(new Date,"yyyy-MM-dd hh:mm:ss"),e.book.status=1;var n=e.optstatus.issave?"back_updatebook":"back_savebook";a.getDataSource(n,e.book,function(t){e.saveDisabled=!1,t&&t[0].crow>0&&(e.optstatus.issave=!0,u("保存成功！"))},function(t){e.saveDisabled=!1,u("保存失败！")})};e.optstatus.iscoverchanged?e.uploadCover(function(){n()}):n()},e.submit=function(){e.book.publishuser=t.user.name,e.book.publishdate=c.format(new Date,"yyyy-MM-dd hh:mm:ss"),e.book.status=1,a.getDataSource("back_submitbook",e.book,function(e){e&&e[0].crow>0&&u("发布成功！")},function(e){u("发布失败！")})},e.cancelsubmit=function(){e.book.publishuser=null,e.book.publishdate=null,e.book.status=0,a.getDataSource("back_cancelsubmitbook",{id:e.book.id},function(e){e&&e[0].crow>0&&u("取消发布成功！")},function(e){u("取消发布失败！")})}}]),app.controller("booklistController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource","DateService",function(e,t,a,n,i,o,r,l,s){var c={pageNumber:1,pageSize:25,sort:null};e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,useExternalPagination:!0,data:[],multiSelect:!0,columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"教材标题",field:"bookname",width:"34%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents" title="{{row.entity.bookname}}" ><a ng-click="grid.appScope.modifybook(row)">{{row.entity.bookname}}</a></div>'},{name:"作者",field:"author",width:"13%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"出版社",field:"publishcompany",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"出版日期",field:"publishtime",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"date:'yyyy-MM-dd'"},{name:"是否置顶",field:"istop",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.istop==0 ? "未置顶" : "置顶"}}</div>'},{name:"创建时间",field:"createdate",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"date:'yyyy-MM-dd'",width:"10%"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){c.pageNumber=t,c.pageSize=a,e.loadGrid()})}},e.addbook=function(){r.go("index.addbook")},e.modifybook=function(e){r.go("index.addbookparameter",{id:e.entity.id})},e.deletebook=function(){var a=e.gridApi.selection.getSelectedRows();l.doArray("back_deletebook",a,function(a){o({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadGrid()})},e.publishbook=function(){for(var a=e.gridApi.selection.getSelectedRows(),n=[],i=0;i<a.length;i++)n.push({id:a[i].id,status:1,istop:a[i].istop,publishuser:t.user.name});l.doArray("back_submitbook",n,function(a){o({message:"发布成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadGrid()})},e.search={},e.loadGrid=function(){var a=(c.pageNumber-1)*c.pageSize,n=c.pageSize,i=["back_getbooklist"];e.search.begincreatedate&&(e.search.begincreatedate=s.format(e.search.begincreatedate,"yyyy-MM-dd")+" 00:00:00"),e.search.endcreatedate&&(e.search.endcreatedate=s.format(e.search.endcreatedate,"yyyy-MM-dd")+" 23:59:59"),l.getList(i,{platformid:t.user.platformid},{firstRow:a,pageSize:n},e.search,c.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data},function(e){})},e.loadGrid(),e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()}}]),app.controller("contentController",["$scope","$http","getDataSource","$rootScope","$modal",function(e,t,a,n,i){a.getDataSource("gettbl",{},function(e){}),e.peoples=[{name:"Adam",email:"adam@email.com",age:12,country:"United States"},{name:"Amalie",email:"amalie@email.com",age:12,country:"Argentina"},{name:"Estefanía",email:"estefania@email.com",age:21,country:"Argentina"},{name:"Adrian",email:"adrian@email.com",age:21,country:"Ecuador"},{name:"Wladimir",email:"wladimir@email.com",age:30,country:"Ecuador"},{name:"Samantha",email:"samantha@email.com",age:30,country:"United States"},{name:"Nicole",email:"nicole@email.com",age:43,country:"Colombia"},{name:"Natasha",email:"natasha@email.com",age:54,country:"Ecuador"},{name:"Michael",email:"michael@email.com",age:15,country:"Colombia"},{name:"Nicolás",email:"nicolas@email.com",age:43,country:"Colombia"}],e.itemArray=[{id:1,name:"first"},{id:2,name:"second"},{id:3,name:"third"},{id:4,name:"fourth"},{id:5,name:"fifth"}],e.selected={value:e.itemArray[0]},e.open=function(e){window.open("http://www.baidu.com")},e.pagingOptions={pageSizes:[10,50,100],pageSize:10,currentPage:1},e.gridOptions={data:"data1",enableCellSelection:!0,enablePaging:!0,showFooter:!0,enablePinning:!0,columnDefs:[{field:"classroom",width:120,pinned:!0},{field:"id",width:120},{field:"name",width:300},{field:"createtime",width:300}],pagingOptions:e.pagingOptions},a.getDataSource("gettbl",{},function(t){e.data1=t})}]),angular.module("myApp").controller("attachController",["$rootScope","$scope","getDataSource","$state","$stateParams","notify","$modal","FilesService","DateService",function(e,t,a,n,i,o,r,l,s){var c=i.id;t.maxorderby=0;t.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,data:[],columnDefs:[{name:"序号",field:"orderby",width:"5%"},{name:"资料名称",field:"attach_clientname",width:"50%",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.downFiles(row.entity.attach_servername, row.entity.attach_clientname, \'classAttach\')">{{row.entity.attach_clientname}}</a></div>'},{name:"创建人",field:"username",width:"15%"},{name:"创建时间",field:"createtime",width:"15%"},{name:"状态",field:"status",width:"15%"}],onRegisterApi:function(e){t.gridApi=e}},t.loadSource=function(){a.getDataSource("selectAttachByCid",{coursewareid:c},function(e){t.gridOptions.data=e,t.maxorderby=e.length})},t.loadSource(),t.oepnAD=function(a){a||(t.classattachInfo={id:"",attach_clientname:"",attach_servername:"",createtime:s.format(new Date,"yyyy-MM-dd hh:mm:ss.S"),status:0,createuser:e.user.accountId,coursewareid:c,
orderby:t.maxorderby+1},t.selectFile=null),t.modalInstance=r.open({templateUrl:"AttachDetail.html",size:"lg",scope:t})},t.close=function(){t.modalInstance.dismiss("cancel")},t.downFiles=function(e,t,a){return l.downFiles(a,e,t)},t.selectFiles=function(a){if(a&&a.length>0){var n=a[0].name.split(".");_.indexOf(e.appConfig.attachTypes,n[n.length-1])<0?o({message:"请选择有效的文件进行上传",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}):t.selectFile=a[0]}},t.saveAttachDisabled=!1,t.Addattach=function(){t.saveAttachDisabled=!0,t.classattachInfo&&t.selectFile?l.upLoadFiles(t.selectFile,"classAttach",function(n){var i=a.getGUID();t.classattachInfo.id=i,t.classattachInfo.attach_clientname=t.selectFile.name,t.classattachInfo.attach_servername=n.data[0].servername,a.getDataSource("insertCoursewareAttach",t.classattachInfo,function(a){o({message:"保存成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadSource(),t.modalInstance.dismiss("cancel"),t.saveAttachDisabled=!1})},function(a){t.saveAttachDisabled=!1,o({message:"保存失败",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})}):(t.saveAttachDisabled=!1,o({message:"请先选择要上传的文件",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}))},t.publish=function(){var n=t.gridApi.selection.getSelectedRows();null!=n&&void 0!=n&&n.length>0&&a.doArray("publishCoursewareAttach",n,function(a){o({message:"发布成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadSource()})},t["delete"]=function(){var n=t.gridApi.selection.getSelectedRows();null!=n&&void 0!=n&&n.length>0&&a.doArray("deleteCoursewareAttach",n,function(a){o({message:"删除成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadSource()})}}]),angular.module("myApp").controller("blackboardController",["$rootScope","$scope","getDataSource","$state","$stateParams","notify","$modal","FilesService","DateService",function(e,t,a,n,i,o,r,l,s){var c=i.id;t.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,data:[],columnDefs:[{name:"照片名称",field:"boardimg_clientname",width:"50%",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.downFiles(row.entity.boardimg_servername, row.entity.boardimg_clientname, \'blackboard\')">{{row.entity.boardimg_clientname}}</a></div>'},{name:"创建人",field:"createuser",width:"25%"},{name:"创建时间",field:"createtime",width:"20%"}],onRegisterApi:function(e){t.gridApi=e}},t.loadSource=function(){a.getDataSource("getAllblackboard",{classid:c},function(e){t.gridOptions.data=e})},t.loadSource(),t.oepnAD=function(a){t.blackboardInfo={id:"",boardimg_clientname:"",boardimg_servername:"",createuser:e.user.name,classid:c},t.selectFile=null,t.modalInstance=r.open({templateUrl:"AttachDetail.html",size:"lg",scope:t})},t.close=function(){t.modalInstance.dismiss("cancel")},t.downFiles=function(e,t,a){return l.downFiles(a,e,t)},t.selectFiles=function(a,n){if(a&&a.length>0){if(n&&n.length>0)return void o({message:"您选择的"+n.length.toString()+"张图片可能超过了大小限制,无法上传,单张图片最大为2MB",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl});t.gridOptions.data.length>5||t.gridOptions.data.length+a.length>5?o({message:"最多只能上传5张图片",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}):t.selectFile=a[0]}},t.saveAttachDisabled=!1,t.Addattach=function(){t.saveAttachDisabled=!0,t.blackboardInfo&&t.selectFile?l.upLoadPicture(t.selectFile,{upcategory:"blackboard",width:640,height:400},function(n){var i=a.getGUID();t.blackboardInfo.id=i,t.blackboardInfo.boardimg_clientname=t.selectFile.name,t.blackboardInfo.boardimg_servername=n.data[0].servername,a.getDataSource("insert_sy_blackboard",t.blackboardInfo,function(a){o({message:"保存成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadSource(),t.modalInstance.dismiss("cancel"),t.saveAttachDisabled=!1})},function(a){t.saveAttachDisabled=!1,o({message:"保存失败",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})}):(t.saveAttachDisabled=!1,o({message:"请先选择要上传的文件",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}))},t["delete"]=function(){var n=t.gridApi.selection.getSelectedRows();null!=n&&void 0!=n&&n.length>0&&a.doArray("delete_sy_blackboard",n,function(a){o({message:"删除成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadSource()})}}]),angular.module("myApp").controller("classAttachController",["$rootScope","$scope","getDataSource","$state","$stateParams","notify","$modal","FilesService","DateService",function(e,t,a,n,i,o,r,l,s){var c=i.id;t.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,data:[],columnDefs:[{name:"资料名称",field:"attach_clientname",width:"50%",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.downFiles(row.entity.attach_servername, row.entity.attach_clientname, \'classAttach\')">{{row.entity.attach_clientname}}</a></div>'},{name:"创建人",field:"username",width:"20%"},{name:"发布时间",field:"publishtime",width:"15%"},{name:"状态",field:"status",width:"15%"}],onRegisterApi:function(e){t.gridApi=e}},t.loadSource=function(){a.getDataSource("selectClassAttachByCid",{classid:c},function(e){t.gridOptions.data=e})},t.loadSource(),t.oepnAD=function(a){a||(t.classattachInfo={id:"",attach_clientname:"",attach_servername:"",status:0,createuser:e.user.name,classid:c},t.selectFile=null),t.modalInstance=r.open({templateUrl:"AttachDetail.html",size:"lg",scope:t})},t.close=function(){t.modalInstance.dismiss("cancel")},t.downFiles=function(e,t,a){return l.downFiles(a,e,t)},t.selectFiles=function(a){if(a&&a.length>0){var n=a[0].name.split(".");_.indexOf(e.appConfig.attachTypes,n[n.length-1])<0?o({message:"请选择有效的文件进行上传",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}):t.selectFile=a[0]}},t.saveAttachDisabled=!1,t.Addattach=function(){t.saveAttachDisabled=!0,t.classattachInfo&&t.selectFile?l.upLoadFiles(t.selectFile,"classAttach",function(n){var i=a.getGUID();t.classattachInfo.id=i,t.classattachInfo.attach_clientname=t.selectFile.name,t.classattachInfo.attach_servername=n.data[0].servername,a.getDataSource("insertClassCoursewareAttach",t.classattachInfo,function(a){o({message:"保存成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadSource(),t.modalInstance.dismiss("cancel"),t.saveAttachDisabled=!1})},function(a){t.saveAttachDisabled=!1,o({message:"保存失败",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})}):(t.saveAttachDisabled=!1,o({message:"请先选择要上传的文件",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}))},t.publish=function(){var n=t.gridApi.selection.getSelectedRows();null!=n&&void 0!=n&&n.length>0&&a.doArray("publishClassCoursewareAttach",n,function(a){o({message:"发布成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadSource()})},t["delete"]=function(){var n=t.gridApi.selection.getSelectedRows();null!=n&&void 0!=n&&n.length>0&&a.doArray("deleteClassCoursewareAttach",n,function(a){o({message:"删除成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadSource()})}}]),angular.module("myApp").controller("classeditController",["$previousState","$rootScope","$scope","getDataSource","$state","$stateParams","notify","$filter","$window","$timeout",function(e,t,a,n,i,o,r,l,s,c){if(a["class"]={},a["class"].studentnum=0,a["class"].comment="",a["class"].signupstatus=0,a.isedit=!1,o.id)a.isedit=!0;else{var d=t.user.mdepartmentId;2==t.user.usertype&&(d=t.user.departmentId),a["class"].departmentid=d}e.get();e.memo("caller"),a.goback=function(){i.go("index.classlist",{},{reload:!1})},a.goCourse=function(){o.id?i.go("index.classedit",{id:o.id}):i.go("index.classedit")};a.goCourseList=function(e){var t="";switch(e){case 0:t="index.classedit.bxk";break;case 4:t="index.classedit.student";break;case 5:t="index.classedit.classattach";break;case 6:t="index.classedit.blackboard"}i.go(t,{type:e})},a.saveButtonDisabled=!1,a.load=function(){o.id&&(n.getDataSource("selectClassById",{id:o.id},function(e){c(function(){a["class"]=e[0],$("#txtdepartment").val(a["class"].departmentname)},200)}),a.nowid=o.id)}(),a.save=function(){var e=n.getGUID();o.id&&(e=o.id),a.saveButtonDisabled=!0,o.id?n.getDataSource("updateClassById",a["class"],function(e){a.saveButtonDisabled=!1,r({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(){a.saveButtonDisabled=!1,r({message:"保存失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})}):(a["class"].id=e,a["class"].status=0,n.getDataSource("insertClass",a["class"],function(n){r({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),a.saveButtonDisabled=!1,i.go("index.classedit",{id:e})}))}}]),angular.module("myApp").controller("classlistController",["$rootScope","$scope","getDataSource","$state","notify",function(e,t,a,n,i){var o={pageNumber:1,pageSize:25,sort:null};t.node={},t.node.selectNode={},t.search={},t.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"班级名称",field:"name",width:"35%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.name}}</a></div>'},{name:"年份",field:"starttime",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.starttime|date:"yyyy"}}</div>'},{name:"起始时间",field:"starttime",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"date:'yyyy-MM-dd'"},{name:"结束时间",field:"endtime",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"date:'yyyy-MM-dd'"},{name:"班级人数",field:"studentnum",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"所属机构",field:"departmentname",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(e){t.gridApi=e,e.pagination.on.paginationChanged(t,function(e,a){o.pageNumber=e,o.pageSize=a,t.loadGrid()}),e.core.on.sortChanged(t,function(e,a){if(0==a.length)o.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),o.sort=n}t.loadGrid()})}},t["delete"]=function(){var n=t.gridApi.selection.getSelectedRows();null!=n&&void 0!=n&&n.length>0&&a.doArray(["delete_classById"],n,function(a){t.loadGrid(),i({message:"删除成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})})},t.goDetial=function(e){n.go("index.classedit",{id:e.entity.id})},t.goSearch=function(){t.gridOptions.paginationCurrentPage=1,t.loadGrid(1)},t.loadGrid=function(n){var i=(o.pageNumber-1)*o.pageSize,r=o.pageSize;if(t.search.departmentid_dbcolumn="departmentid",t.search.departmentid_dbtype="string",t.search.departmentid_handle="like",0==n){var l=e.user.mdepartmentId;2==e.user.usertype&&(l=e.user.departmentId),t.search.departmentid=l}else t.search.departmentid=t.search.departmentid;a.getList("selectClassList",{platformid:e.user.platformid},{firstRow:i,pageSize:r},t.search,o.sort,function(e){t.gridOptions.totalItems=e[0].allRowCount,t.gridOptions.data=e[0].data},function(e){})},t.loadGrid(0)}]),angular.module("myApp").controller("classCourseController",["$rootScope","$http","$scope","getDataSource","$state","$stateParams","$modal","notify","smsService",function(e,t,a,n,i,o,r,l,s){a["class"]={forAddCourse:[]},a.zhname="必修课",a.copyCategory={xxk:!1,bxk:!1,aljx:!1},a.initTable=function(){n.getDataSource("selectClassCourseware",{classid:o.id,category:o.type},function(e){a.gridOptions.data=e})},a.load=function(){switch(o.type){case 0:a.zhname="必修课";break;case 1:a.zhname="选修课";break;case 2:a.zhname="案例教学"}n.getDataSource("selectCoursewareForClass",{platformid:e.user.platformid,platformid1:e.user.platformid,classid:o.id,classid1:o.id},function(e){a["class"].courseList=e}),a.initTable()}(),a.goManage=function(e){a.allManage=!1,n.getDataSource("selectClassCourseById",{id:e.entity.id},function(e){a.nowCourse=e[0],a.modalInstance=r.open({templateUrl:"courseManage.html",size:"lg",scope:a})})},a.copyCourse=function(){n.getDataSource("selectCopyClassCourse",{classid:o.id,platformid:e.user.platformid},function(e){a.gridOptions1.data=e,a.modalInstance=r.open({templateUrl:"copyCourse.html",size:"lg",scope:a})})},a.sendSMS=function(){},a.close=function(){a.modalInstance.dismiss("cancel")},a.saveCourse=function(){if(a.allManage){var t=a.gridApi.selection.getSelectedRows(),i=[];angular.forEach(t,function(e){var t=e.id;e=_.cloneDeep(a.nowCourse),e.id=t,i.push(e)}),n.doArray("updateClassCourseById",i,function(t){l({message:"保存成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),a.initTable()},function(e){})}else n.getDataSource("updateClassCourseById",a.nowCourse,function(t){l({message:"保存成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})},function(t){l({message:"保存失败",classes:"alert-danger",templateUrl:e.appConfig.defaultNoticeUrl})})},a.manageCourse=function(){a.selectedCourse=a.gridApi.selection.getSelectedRows(),a.allManage=!0,a.nowCourse={},a.modalInstance=r.open({templateUrl:"courseManage.html",size:"lg",scope:a})},a.setExamNumZero=function(){0==a.nowCourse.exam&&(a.nowCourse.examnum=0)},a.gridOptions={useExternalPagination:!0,data:[],columnDefs:[{name:"课程名称",width:"57%",field:"name",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.name}}</div>'},{name:"主讲人",width:"10%",field:"teachersname"},{name:"课程类型",width:"10%",field:"starttime",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.appScope.zhname"></div>'},{name:"学时",width:"10%",field:"score"},{name:"状态",width:"10%",field:"mainstatus",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.mainstatus==-2 ? "已下架" : "正常" }}</div>'}],onRegisterApi:function(e){a.gridApi=e}},a.gridOptions1={useExternalPagination:!0,data:[],multiSelect:!1,columnDefs:[{name:"班次名称",field:"name"},{name:"开班时间",field:"starttime",maxWidth:100,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.starttime|date:"yyyy-MM-dd"}}</div>'},{name:"必修课程",field:"xxk",maxWidth:100,cellTemplate:'<div class="ui-grid-cell-contents">&nbsp;{{row.entity.bxk}}</div>'},{name:"选修课程",field:"bxk",maxWidth:100,cellTemplate:'<div class="ui-grid-cell-contents">&nbsp;{{row.entity.xxk}}</div>'},{name:"案例教学",field:"aljx",maxWidth:100,cellTemplate:'<div class="ui-grid-cell-contents">&nbsp;{{row.entity.aljx}}</div>'}],onRegisterApi:function(e){a.gridApi1=e}},a.copyNewCourse=function(){var e=a.gridApi1.selection.getSelectedRows(),n=t.post("../api/copyClassCourse",{classid:o.id,forCopyClass:e[0].id,copyCategory:a.copyCategory});n.then(function(e){a.modalInstance.dismiss("cancel"),a.initTable()})},a.delCourseware=function(){var e=a.gridApi.selection.getSelectedRows();n.doArray("deleteClassCourseware",e,function(e){n.getDataSource("update_sy_class_studytime",{classid:o.id},function(e){},function(e){}),a.updatescore(),a.initTable()})},a.addCourseDisabled=!0,a.addCourse=function(){a["class"].forAddCourse&&a["class"].forAddCourse.length>0&&(a.addCourseDisabled=!0,angular.forEach(a["class"].forAddCourse,function(e){e.classid=o.id,e.coursewareid=e.id,e.category=o.type}),n.doArray("insertClassCourseware",a["class"].forAddCourse,function(e){angular.forEach(a["class"].forAddCourse,function(e){_.remove(a["class"].courseList,{id:e.id})}),n.getDataSource("update_sy_class_studytime",{classid:o.id},function(e){},function(e){}),a["class"].forAddCourse=[],a.initTable()}))},a.updatescore=function(e){n.getDataSource("updateClassStudytime",{classid:o.id},function(e){console.log(e)})},a.$watch("class.forAddCourse",function(e){e.length>0?a.addCourseDisabled=!1:a.addCourseDisabled=!0})}]),angular.module("myApp").controller("importstudentController",["$rootScope","$scope","getDataSource","$state","$stateParams","notify","$modal","Upload","$http","CommonService",function(e,t,a,n,i,o,r,l,s,c){var d={pageNumber:1,pageSize:25,sort:null};t.search={name:"",departmentid:"",pids:"",classid:i.id,rank:""};var u=e.user.mdepartmentId,m=e.user.pids;2==e.user.usertype&&(u=e.user.departmentId,u=e.user.pids),t.search.departmentid=u,t.search.pids=m,t.loadGrid=function(){(d.pageNumber-1)*d.pageSize,d.pageSize;a.getUrlData("../api/getstudent",t.search,function(e){e.result&&(t.gridOptions.totalItems=e.list.length,t.gridOptions.data=e.list)},function(e){})},t.gridOptions={data:[],columnDefs:[{name:"登录帐号",field:"logname",headerCellClass:"text-center"},{name:"姓名",field:"name",headerCellClass:"text-center"},{name:"手机号码",headerCellClass:"text-center",field:"cellphone"},{name:"职级",headerCellClass:"text-center",field:"rank"},{name:"部门名称",headerCellClass:"text-center",field:"departmentname"},{name:"状态",headerCellClass:"text-center",field:"status"},{name:"注册状态",headerCellClass:"text-center",field:"signstatus"}],onRegisterApi:function(e){t.gridApi=e,e.core.on.sortChanged(t,function(e,a){if(0==a.length)d.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),d.sort=n}t.loadGrid()})}},t.getLevelArr=function(){t.levelArr||a.getUrlData("../api/getsycodes",{categorys:"职级"},function(e){t.levelArr=_.find(e,{type:"职级"}).list,t.levelArr.unshift({id:"1",datavalue:"",showvalue:"全部"})},function(e){})},t.getLevelArr(),t.goSearch=function(){t.gridOptions.paginationCurrentPage=1,t.loadGrid()},t.goReturn=function(){n.go("index.classedit.student",{id:i.id})},t.selectnode=function(e){t.search.departmentid=e.id,t.search.pids=e.pids,t.loadGrid()},t.ok=function(){for(var n=t.gridApi.selection.getSelectedRows(),r={classid:i.id,userid:[]},l=0;l<n.length;l++)r.userid.push(n[l].userid);a.getUrlData("../api/insertstudent",r,function(a){a.result?(o({message:"保存成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.close(),t.loadGrid()):o({message:a.message,classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})},function(e){})},t.ngcheckArray=[],t.ok_org=function(){var n={classid:i.id,departmentid:t.ngcheckArray};a.getUrlData("../api/batchinsertstudent",n,function(a){a.result?(o({message:"保存成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.close(),t.loadGrid()):o({message:a.message,classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})},function(e){})},t.close=function(){t.modalInstance.dismiss("cancel")},t.addStudent_view=function(e){t.modalInstance=r.open({templateUrl:"confirm.html",size:"md",scope:t})},t.addStudent_org=function(a){t.ngcheckArray&&t.ngcheckArray.length>0?t.modalInstance=r.open({templateUrl:"confirm_org.html",size:"md",scope:t}):o({message:"请选择要保存的机构",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})}}]),angular.module("myApp").controller("classAssessmentController",["$rootScope","$scope","getDataSource","$state","$stateParams","notify",function(e,t,a,n,i,o){t.dimensions=[{name:"必修课"},{name:"选修课"},{name:"案例教学"},{name:"小结"}],t["class"]={dimensions:[]},t.saveButtonDisabled=!1,t.save=function(){t.saveButtonDisabled=!0,t["class"].classid=i.id;var n="";angular.forEach(t["class"].dimensions,function(e){n+=e.name+","}),n.length>0&&(n=n.substring(0,n.length-1)),t["class"].dimension=n,t["class"].id?a.getDataSource("updateClassAssessment",t["class"],function(){o({message:"保存成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.saveButtonDisabled=!1},function(e){t.saveButtonDisabled=!1}):(t["class"].id=a.getGUID(),a.getDataSource("insertClassAssessment",t["class"],function(a){o({message:"保存成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.saveButtonDisabled=!1},function(e){t.saveButtonDisabled=!1}))},t.checkMax=function(e,a){var n=e.split(".");t[n[0]][n[1]]>=a&&(t[n[0]][n[1]]=a)},t.load=function(){a.getDataSource("selectClassScoreSum",{classid:i.id},function(e){_.groupBy(e,function(e){return e.category});t.requiredpassmark=_.sumBy(_.filter(e,function(e){return 0==e.category}),function(e){return e.score}),t.electivepassmark=_.sumBy(_.filter(e,function(e){return 1==e.category}),function(e){return e.score}),t.casepassmark=_.sumBy(_.filter(e,function(e){return 2==e.category}),function(e){return e.score})}),a.getDataSource("selectClassAssessment",{classid:i.id},function(e){e.length>0&&(t["class"]=e[0],t["class"].dimensions=[],angular.forEach(t["class"].dimension.split(","),function(e){t["class"].dimensions.push({name:e})}))})}()}]),angular.module("myApp").controller("classStudentController",["$rootScope","$scope","getDataSource","$state","$stateParams","notify","$modal","Upload","$http","CommonService",function(e,t,a,n,i,o,r,l,s,c){var d={pageNumber:1,pageSize:25,sort:null};t.nowfile={},t.isAccept=!1,t.isDelAccept=!1,t.student={},t.search={},t.loadGrid=function(){var e=(d.pageNumber-1)*d.pageSize,n=d.pageSize;a.getList("selectClassStudent",{classid:i.id},{firstRow:e,pageSize:n},t.search,d.sort,function(e){t.gridOptions.totalItems=e[0].allRowCount,t.gridOptions.data=e[0].data})},t.loadGrid(),t.getLevelArr=function(){t.levelArr||a.getUrlData("../api/getsycodes",{categorys:"职级"},function(e){t.levelArr=_.find(e,{type:"职级"}).list},function(e){})},t.getLevelArr(),t.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,data:[],columnDefs:[{name:"登录帐号",field:"logname",headerCellClass:"text-center"},{name:"姓名",field:"name",headerCellClass:"text-center"},{name:"手机号码",headerCellClass:"text-center",field:"cellphone"},{name:"职级",headerCellClass:"text-center",field:"rank"},{name:"部门名称",headerCellClass:"text-center",field:"departmentname"},{name:"状态",headerCellClass:"text-center",field:"status"},{name:"注册状态",headerCellClass:"text-center",field:"signstatus"}],onRegisterApi:function(e){t.gridApi=e,e.pagination.on.paginationChanged(t,function(e,a){d.pageNumber=e,d.pageSize=a,t.loadGrid()}),e.core.on.sortChanged(t,function(e,a){if(0==a.length)d.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),d.sort=n}t.loadGrid()})}},t.goSearch=function(){t.gridOptions.paginationCurrentPage=1,t.loadGrid()},t.deleteStudent=function(){t.modalInstance=r.open({templateUrl:"delconfirm.html",size:"md",scope:t})},t.okDel=function(){for(var n=t.gridApi.selection.getSelectedRows(),r={classid:i.id,userid:[]},l=0;l<n.length;l++)r.userid.push(n[l].userid);a.getUrlData("../api/deletestudent",r,function(a){o({message:"删除成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.closeDel(),t.loadGrid()},function(e){})},t.closeDel=function(){t.modalInstance.dismiss("cancel")},t.ok=function(){t.isAccept=!0,t.close(),t.upload()},t.uploadFiles=function(e,a){t.files=e},t.$watch("files",function(e){e&&e.length>0&&(t.isAccept=!0,t.upload())}),t.upload=function(){var e=l.upload({url:"../api/importStudent",file:t.files,data:{classid:i.id}});e.then(function(e){t.studentSuccess=_.filter(e.data.studentList,function(e){return 1==e.success}).length,t.studentFail=_.filter(e.data.studentList,function(e){return 0==e.success}).length,t.importStudent=e.data.studentList,t.modalInstance=r.open({templateUrl:"studentImport.html",size:"lg",scope:t}),t.loadGrid()})},t.nations=[];var u=s.get("../config/dataSource.json");u.then(function(e){t.nations=e.data.nations}),t.close=function(){t.modalInstance.dismiss("cancel")},t.addStudent=function(e){n.go("index.import",{id:i.id})},t.goDetial=function(e){t.addStudent(e.entity.id)},t.saveStudentDisabled=!1,t.saveStudent=function(){if(t.saveStudentDisabled=!0,0==c.checkIDCard(t.student.idcard))o({message:"身份证号填写不正确",classes:"alert-danger",templateUrl:e.appConfig.defaultNoticeUrl}),t.saveStudentDisabled=!1;else{var a=t.student.idcard,n=a.substr(a.length-2,1);if(n%2==t.student.sex){t.student.classid=i.id;var r=s.post("../api/student",{student:t.student});r.then(function(a){"success"==a.data.status?(t.saveStudentDisabled=!1,o({message:"新增成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.close(),t.loadGrid()):(t.saveStudentDisabled=!1,o({message:a.data.errorMessage,classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}))})}else t.saveStudentDisabled=!1,o({message:"身份证号识别的性别和选择的性别不一致",classes:"alert-danger",templateUrl:e.appConfig.defaultNoticeUrl})}}}]),angular.module("myApp").controller("unitController",["$rootScope","$scope","getDataSource","$state","$stateParams","notify","$modal","Upload",function(e,t,a,n,i,o,r,l){var s={pageNumber:1,pageSize:25,sort:null};t.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"班级单元名称",field:"packagename",width:"64%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.viewLive(row)">{{row.entity.packagename}}</a></div>'},{name:"专题数量",field:"classnum",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建人",field:"createuser",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建时间",field:"createtime",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"date:'yyyy-MM-dd'"}],onRegisterApi:function(e){t.gridApi=e,e.pagination.on.paginationChanged(t,function(e,a){s.pageNumber=e,s.pageSize=a,t.load()})}},t.load=function(){var n=(s.pageNumber-1)*s.pageSize,i=s.pageSize,o=["selectSymulticlass"];a.getList(o,{platformid:e.user.platformid},{firstRow:n,pageSize:i},t.search,s.sort,function(e){t.gridOptions.totalItems=e[0].allRowCount,t.gridOptions.data=e[0].data},function(e){})},t.viewLive=function(e){n.go("index.unitEdit",{id:e.entity.id})},t.delUnit=function(){t.modalInstance=r.open({templateUrl:"confirm.html",size:"sm",scope:t})},t.load(),t.goSearch=function(){t.load()},t.ok=function(){t.isAccept=!0;var n=t.gridApi.selection.getSelectedRows();a.getUrlData("../api/deleteMultUnit",n,function(a){"failed"==a.code?o({message:"删除失败,"+a.message,classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}):(o({message:"删除成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.load())},function(t){o({message:"删除失败",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})}),t.close()},t.close=function(){t.modalInstance.dismiss("cancel")}}]),angular.module("myApp").controller("unitEditController",["$rootScope","$scope","getDataSource","$state","$stateParams","notify","$modal","Upload","CommonService",function(e,t,a,n,i,o,r,l,s){t["class"]={selectedClass:[]},i.id&&(t.formid=i.id),t.goStudentList=function(){n.go("index.unitEdit.studentlist",{id:i.id})},t.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,columnDefs:[{name:"专题名称",field:"name",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.viewLive(row)">{{row.entity.name}}</a></div>'},{name:"年份",field:"starttime",cellFilter:"date:'yyyy'"},{name:"必修课数",field:"bxk"},{name:"选修课数",field:"xxk"},{name:"操作",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.deleteClass(row)">删除</a></div>'}]},t.load=function(){a.getDataSource("selectAllMultClass",{mulid:i.id,platformid:e.user.platformid},function(e){t.allClass=e,i.id&&a.getDataSource(["selectMultClass","selectMultClassForClass"],{id:i.id},function(e){t["class"]=_.filter(e,function(e){return"selectMultClass"==e.name})[0].data[0],t.gridOptions.data=_.filter(e,function(e){return"selectMultClassForClass"==e.name})[0].data,t["class"].selectedClass=[]})})},t.load(),t.addDisabled=!1,t.addClass=function(){t.addDisabled=!0;var e=[],n=i.id;angular.forEach(t["class"].selectedClass,function(t){e.push({id:a.getGUID(),classid:t.id,multiclassid:n})}),a.doArray("insertintoMultClassRelation",e,function(n){t.addDisabled=!1,t["class"].classnum=e.length,t["class"].selectedClass=[],a.getDataSource("updateMultClass",t["class"],function(e){t.load()})},function(e){t.addDisabled=!1})},t.checkNum=function(){return isNaN(t["class"].minclassnum)?void o({message:"必须输入数字",classes:"alert-danger",templateUrl:e.appConfig.defaultNoticeUrl}):void(t["class"].minclassnum>t.gridOptions.data.length&&(o({message:"最少选择班次数不能超过班次总数",classes:"alert-danger",templateUrl:e.appConfig.defaultNoticeUrl}),t["class"].minclassnum=t.gridOptions.data.length))},t.close=function(){t.modalInstance.dismiss("cancel")},t.ok=function(n){t.isAccept=!0,a.getDataSource("checkStuChooseMultClass",{classid:n.entity.id},function(i){i.length>0?o({message:"该多专班已被使用，不能删除",classes:"alert-danger",templateUrl:e.appConfig.defaultNoticeUrl}):a.getDataSource("deleteMultClassSelectedClassById",{id:n.entity.id},function(){a.getDataSource("updateMultClassCount",{sy_multiclassid:t.formid},function(e){t.load()},function(e){})})},function(){}),t.close()},t.deleteClass=function(e){t.row=e,t.modalInstance=r.open({templateUrl:"confirm.html",size:"sm",scope:t})},t.changeCharge=function(){t["class"].expenses=0},t.goback=function(){n.go("index.unit")},t.saveButtonDisabled=!1,t.save=function(){t.saveButtonDisabled=!0,i.id?a.getDataSource("updateMultClass",t["class"],function(){t.load(),t.saveButtonDisabled=!1,o({message:"保存成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})},function(e){t.saveButtonDisabled=!1}):(t["class"].id=a.getGUID(),t["class"].platformid=e.user.platformid,t["class"].createuser=e.user.name,t["class"].createtime=new Date,a.getDataSource("insertMultClass",t["class"],function(){n.go("index.unitEdit",{id:t["class"].id}),t.saveButtonDisabled=!1,o({message:"保存成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})},function(e){t.saveButtonDisabled=!1}))}}]),angular.module("myApp").controller("courseAuthorizationController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService","FilesService",function(e,t,a,n,i,o,r,l,s,c,d){e.authorizationinfo={id:"",authorizedate:null,authorizefile_servername:"",coursewareid:o.id,teachername:"",authorizefilename:"",examination:"",examdate:null,examfile_servername:"",examfilename:"",files:{}},e.loadAuth=function(){i.getDataSource("select_sy_courseware_authbycoursewareid",{coursewareid:e.authorizationinfo.coursewareid},function(t){null!=t&&void 0!=t&&t.length>0&&(e.authorizationinfo=t[0])})},e.loadAuth(),e.uploadAuthFiles=function(t){d.upLoadFiles(t[0],"authAttach",function(t){e.authorizationinfo.authorizefilename=t.data[0].filename,e.authorizationinfo.authorizefile_servername=t.data[0].servername})},e.uploadExamFiles=function(t){d.upLoadFiles(t[0],"authAttach",function(t){e.authorizationinfo.examfilename=t.data[0].filename,e.authorizationinfo.examfile_servername=t.data[0].servername})},e.saveAuth=function(){e.authorizationinfo.id?i.getDataSource("update_sy_courseware_auth",{id:e.authorizationinfo.id,authorizedate:e.authorizationinfo.authorizedate,authorizefile_servername:e.authorizationinfo.authorizefile_servername,coursewareid:e.authorizationinfo.coursewareid,teachername:e.authorizationinfo.teachername,authorizefilename:e.authorizationinfo.authorizefilename,examination:e.authorizationinfo.examination,examdate:e.authorizationinfo.examdate,examfile_servername:e.authorizationinfo.examfile_servername,examfilename:e.authorizationinfo.examfilename},function(t){e.savefase||r({message:"保存成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})}):(e.authorizationinfo.id=i.getGUID(),i.getDataSource("insert_sy_courseware_auth",{id:e.authorizationinfo.id,authorizedate:e.authorizationinfo.authorizedate,authorizefile_servername:e.authorizationinfo.authorizefile_servername,coursewareid:e.authorizationinfo.coursewareid,teachername:e.authorizationinfo.teachername,authorizefilename:e.authorizationinfo.authorizefilename,examination:e.authorizationinfo.examination,examdate:e.authorizationinfo.examdate,examfile_servername:e.authorizationinfo.examfile_servername,examfilename:e.authorizationinfo.examfilename},function(t){e.savefase||r({message:"保存成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})}))},e.authMessage="",e.authmessageshow=!1,e.savefase=!1,e.saveAuthSuccess=function(){e.savefase=!0,e.saveAuth(),i.getUrlData("../api/courseMainStatus",{coursewareids:o.id,mainstatus:4,operationuser:a.user.name,userid:a.user.accountId,currentstep:"课件授权",nextstep:"课件编辑",operationcontent:(a.user.name+"授权成功，等待编辑课件").toString()},function(t){
t?(r({message:"授权成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.goback()):r({message:"授权失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(e){r({message:"授权失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})})},e.saveAuthError=function(){e.savefase=!0,e.saveAuth(),i.getUrlData("../api/courseMainStatus",{coursewareids:o.id,mainstatus:-2,operationuser:a.user.name,userid:a.user.accountId,currentstep:"课件授权",nextstep:"课件删除",operationcontent:(a.user.name+"已删除，删除原因："+e.course.deleteContent).toString(),deleteContent:e.course.deleteContent,laststatus:3},function(t){t?(r({message:"授权失败成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.goback()):r({message:"授权失败失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(e){r({message:"授权失败失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})})},e.saveAuthMessage=function(){e.authmessageshow=!0,e.authMessage="失败理由",e.modalInstance=t.open({templateUrl:"authmessagepeview.html",size:"lg",scope:e})},e.close=function(){e.modalInstance.dismiss("cancel")},e.openSFile=function(){d.downFiles("authAttach",e.authorizationinfo.authorizefile_servername,e.authorizationinfo.authorizefile_servername)},e.openPFile=function(){d.downFiles("authAttach",e.authorizationinfo.examfile_servername,e.authorizationinfo.examfile_servername)}}]),angular.module("myApp").controller("courseEditController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService","FilesService",function(e,t,a,n,i,o,r,l,s,c,d){e.course={teachers:[]},e.courseware={tipMessage:"",courseInfoShow:!1,courseExamineShow:!1,courseDistributionShow:!1,courseEditShow:!1,courseEditViewShow:!1,courseAuthorizationEditShow:!1,courseAuthorizationViewShow:!1,courseEdShow:!1,courseEdViewShow:!1,coursePerfectEditShow:!1,coursePerfectViewShow:!1,courseStorageEditShow:!1,courseStorageViewShow:!1,courseDeleteMessageShow:!1},e.setCourseWareType=function(){switch(o.type){case"upload":e.courseware.mainstatus=0,e.courseware.courseInfoShow=!0;break;case"distribution":e.courseware.mainstatus=1,e.courseware.courseExamineShow=!0;break;case"examine":e.courseware.mainstatus=2,e.courseware.courseEditShow=!0,e.courseware.courseEditViewShow=!0;break;case"authorization":e.courseware.mainstatus=3,e.courseware.courseEditShow=!0,e.courseware.courseEditViewShow=!1,e.courseware.courseAuthorizationEditShow=!0;break;case"wareedit":e.courseware.mainstatus=4,e.courseware.courseEditShow=!0,e.courseware.courseEditViewShow=!1,e.courseware.courseAuthorizationViewShow=!0,e.courseware.courseEdShow=!0;break;case"perfect":e.courseware.mainstatus=5,e.courseware.courseEditShow=!0,e.courseware.courseEditViewShow=!1,e.courseware.courseAuthorizationViewShow=!0,e.courseware.courseEdViewShow=!0,e.courseware.coursePerfectEditShow=!0;break;case"storage":e.courseware.mainstatus=6,e.courseware.courseEditShow=!0,e.courseware.courseEditViewShow=!1,e.courseware.courseAuthorizationViewShow=!0,e.courseware.courseEdViewShow=!0,e.courseware.coursePerfectViewShow=!0,e.courseware.courseStorageEditShow=!0;break;case"formal":e.courseware.courseEditShow=!0,e.courseware.courseEditViewShow=!1,e.courseware.courseAuthorizationViewShow=!0,e.courseware.courseEdViewShow=!0,e.courseware.coursePerfectViewShow=!0,e.courseware.courseStorageViewShow=!0,e.courseware.mainstatus=7;break;case"waredelete":e.courseware.mainstatus=-2,e.courseware.courseEditShow=!0,e.courseware.courseEditViewShow=!1,e.courseware.courseDeleteMessageShow=!0}},e.setCourseWareType(),o.id?i.getDataSource(["selectCoursewareById","selectCourseware_teacherRelation"],{id:o.id},function(t){var a=_.find(t,function(e){return"selectCourseware_teacherRelation"==e.name});switch(e.course=_.find(t,function(e){return"selectCoursewareById"==e.name}).data[0],e.course.teachers=a.data,e.nowfile=d.showFile("coursewarePhoto",e.course.imagephoto,e.course.imagephoto),1==e.course.source?e.course.sourcecn="录制":2==e.course.source&&(e.course.sourcecn="定制"),0==e.course.videotype?e.course.videotypecn="单视频":1==e.course.videotype?e.course.videotypecn="双视频":2==e.course.videotype&&(e.course.videotypecn="单视频+PPT"),e.course.deletestatuscn="",e.course.deletestatus){case 1:e.course.deletestatuscn="待分配";break;case 2:e.course.deletestatuscn="待审核";break;case 3:e.course.deletestatuscn="待授权";break;case 4:e.course.deletestatuscn="待编辑";break;case 5:e.course.deletestatuscn="待完善";break;case 6:e.course.deletestatuscn="待分类"}e.course.teacherscn="",e.course.teachercontent="";for(var n in e.course.teachers)void 0!=e.course.teachers[n].name&&(e.course.teacherscn+=e.course.teachers[n].name+" "),void 0!=e.course.teachers[n].comment&&(e.course.teachercontent+=e.course.teachers[n].comment+"<br/>")}):e.course.videotype=0,e.recommendCourse=function(){""!=e.comment?i.getUrlData("../api/courseMainStatus",{coursewareids:o.id,mainstatus:3,operationuser:a.user.name,userid:a.user.accountId,currentstep:"课件审核",nextstep:"课件授权",operationcontent:(a.user.name+"已审核成功，等待授权").toString()},function(t){t?(r({message:"推荐成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.close(),e.goback()):r({message:"推荐失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(e){r({message:"推荐失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})}):r({message:"请填写课件简介！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},e.notRecommendCourse=function(){i.getUrlData("../api/courseMainStatus",{coursewareids:o.id,mainstatus:-2,operationuser:a.user.name,userid:a.user.accountId,currentstep:"课件审核",nextstep:"课件删除",operationcontent:(a.user.name+"已删除，删除原因："+e.course.deleteContent).toString(),deleteContent:e.course.deleteContent,laststatus:2},function(t){t?(r({message:"不推荐成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.close(),e.goback()):r({message:"不推荐失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(e){r({message:"不推荐失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})})},e.openMessage=function(a){e.courseware.tipMessage=a,e.modalInstance=t.open({templateUrl:"messagepeview.html",size:"lg",scope:e})},e.textareashow=!1,e.recommendType="",e.openRecommendCourse=function(){e.textareashow=!1,e.recommendType="recommend",e.openMessage("是否确认推荐该课件？")},e.openNotRecommendCourse=function(){e.textareashow=!0,e.recommendType="notrecommend",e.openMessage("不推荐理由")},e.saveRecommendCourse=function(){"recommend"==e.recommendType?e.recommendCourse():"notrecommend"==e.recommendType&&e.notRecommendCourse()},e.close=function(){e.modalInstance.dismiss("cancel")},e.goback=function(){l.go("index.coursewarelist",{type:o.type})}}]).controller("videoPerviewCtrl",["$scope",function(e){}]),angular.module("myApp").controller("courseExamController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService","FilesService",function(e,t,a,n,i,o,r,l,s,c,d){e.st={},e.checkedAnswer={},e.gridApiST={},e.gridSTOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,columnDefs:[{name:"试题名称",field:"examtitle",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.oepnST(row)">{{row.entity.examtitle}}</a></div>'},{name:"题型",field:"examcategory",cellFilter:"examCategoryFilter"}],onRegisterApi:function(t){e.gridApiST=t}},e.doinitST=function(){i.getDataSource("selectExamByCourse",{id:o.id},function(t){e.gridSTOptions.data=t})},e.doinitST(),e.deleteST=function(){var t=e.gridApiST.selection.getSelectedRows();i.doArray("deleteExam",t,function(t){e.doinitST()})},e.deleteAnswer=function(t){_.pull(e.answers,t)},e.addST=function(){0==e.st.examcategory&&angular.forEach(e.answers,function(t){t.id==e.checkedAnswer.checkedID?t.isright=1:t.isright=0}),e.newst?(e.st.id=i.getGUID(),e.st.coursewareid=o.id,angular.forEach(e.answers,function(t){t.examid=e.st.id}),i.getDataSource("addCourseExam",e.st,function(t){i.doArray("insertExamAnswer",e.answers,function(t){e.doinitST(),e.close()})})):i.getDataSource("updateCourseExam",e.st,function(t){i.getDataSource("deleteExamAnswer",{examid:e.st.id},function(t){i.doArray("insertExamAnswer",e.answers,function(t){e.doinitST(),e.close()})})})},e.addExamAnswer=function(){e.answers.push({id:i.getGUID(),isright:!1,answer:"",examid:e.st.id})},e.changeST=function(){e.answers=[]},e.oepnST=function(a){a?(e.newst=!1,e.st=a.entity,i.getDataSource("selectExamAnswerByExam",{examid:a.entity.id},function(t){var a="";angular.forEach(t,function(e){1==e.isright&&(a=e.id,e.isright=!0)}),e.answers=t,e.checkedAnswer.checkedID=a})):(e.newst=!0,e.st={},e.answers=[]),e.modalInstance=t.open({templateUrl:"ST.html",size:"lg",scope:e})},e.close=function(){e.modalInstance.dismiss("cancel")}}]),angular.module("myApp").controller("courseExamineController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService","FilesService",function(e,t,a,n,i,o,r,l,s,c,d){e.coursewareeidt={evaluateData:{},keyData:{}},e.loadCodeData=function(){i.getDataSource("select_sy_courseware_ratebycoursewareid",{coursewareid:o.id},function(t){if(null!=t&&void 0!=t){var a=new Array,n=new Array;for(var o in t)0==t[o].codetype?a.push(t[o]):n.push(t[o])}i.getDataSource("selectSyCodeByClass",{nowclass:"课件评价等级"},function(t){if(null!=a&&a.length>0&&null!=t&&t.length>0)for(var n in t)for(var i in a)t[n].showvalue==a[i].category&&(t[n].datavalue=a[i].rate);e.coursewareeidt.evaluateData=t}),i.getDataSource("selectSyCodeByClass",{nowclass:"关键词"},function(t){i.getDataSource("select_sy_code_getall",{},function(a){if(null!=t&&void 0!=t&&t.length>0&&null!=a&&void 0!=a&&a.length>0)for(var i in t){var o=new Array;for(var r in a)a[r].category==t[i].showvalue&&o.push(a[r]);if(null!=n&&void 0!=n&&n.length>0)for(var l in n)n[l].category==t[i].showvalue&&(t[i].datavalue=n[l].rate);t[i].itemData=o}e.coursewareeidt.keyData=t})})})},e.loadRateData=function(){i.getDataSource("select_sy_courseware_ratebycoursewareid",{coursewareid:o.id},function(t){var a=new Array,n=new Array;for(var o in t)0==t[o].codetype?a.push(t[o]):n.push(t[o]);e.coursewareeidt.keyData=n,e.coursewareeidt.evaluateData=a,0==n.length&&i.getDataSource("selectSyCodeByClass",{nowclass:"课件评价等级"},function(t){for(var a in t)t[a].category=t[a].showvalue,t[a].rate="未评";e.coursewareeidt.evaluateData=t}),0==a.length&&i.getDataSource("selectSyCodeByClass",{nowclass:"关键词"},function(t){for(var a in t)t[a].category=t[a].showvalue,t[a].rate="无";e.coursewareeidt.keyData=t})})},e.courseware.courseEditViewShow?e.loadCodeData():e.loadRateData(),e.saveExamine=function(){i.getUrlData("../api/saveCourseExamine",{coursewareeidt:e.coursewareeidt,rate:e.course.rate,coursewareid:o.id},function(e){r(e?{message:"保存成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}:{message:"保存失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(e){r({message:"保存失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})})}}]),angular.module("myApp").controller("courseInforController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService","FilesService",function(e,t,a,n,i,o,r,l,s,c,d){var u={};e.nowid=o.id,e.type=o.type,e.typeShow=!0,"1"==e.type&&(e.typeShow=!1),e.saveButtonDisabled=!1,e.uploadvideoFiles=function(t,a){e.course.videofile=t,e.process_videofile=0},i.getDataSource("selectAllTeacher",{platformid:a.user.platformid},function(t){e.allTeachers=t}),e.gridOptions={},e.gridXXOptions={},e.uploadpptFiles=function(t,a){e.course.temppptfile=t,e.process_pptfile=0},e.close=function(){e.modalInstance.dismiss("cancel")},e.goback=function(){l.go("index.coursewarelist",{type:o.type})},e.uploadFiles=function(t){e.files=t},e.saveCourseInfo=function(){e.files?d.upLoadPicture(e.files[0],{upcategory:"coursewarePhoto",width:200,height:120},function(t){e.course.imagephoto=t.data[0].servername,m()}):m()};var m=function(){if(e.saveButtonDisabled=!0,void 0==e.course.name||""==e.course.name)return void r({message:"请输入课件名称！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl});if(void 0==e.course.tempteachervideofilename||""==e.course.tempteachervideofilename)return void r({message:"请选择课件信息！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl});if(e.course.teachersid=c.getJoinString(e.course.teachers,"id"),e.course.teachersname=c.getJoinString(e.course.teachers,"name"),o.id)f(o.id),i.getDataSource("update_sy_coursewareById",e.course,function(t){e.saveButtonDisabled=!1,r({message:"保存成功",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(t){r({message:"保存失败",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.saveButtonDisabled=!1});else{var t=i.getGUID();e.course.id=t,f(t),e.course.createplatformid=a.user.platformid,e.course.createuser=a.user.name,e.course.createtime=new Date,i.getDataSource("insert_sy_courseware_info",e.course,function(a){e.saveButtonDisabled=!1,l.go("index.courseEdit",{id:t})})}};e.commitCourseInfo=function(){e.course.id&&i.getUrlData("../api/courseMainStatus",{coursewareids:o.id,mainstatus:1,operationuser:a.user.name,currentstep:"课件上传",nextstep:"课件分配",operationcontent:(a.user.name+"已提交课件，等待分配审核").toString()},function(t){t?(r({message:"提交成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.goback()):r({message:"提交失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(e){r({message:"提交失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})})};var f=function(t){var a=[];angular.forEach(e.course.teachers,function(e){a.push({id:i.getGUID(),coursewareid:t,sourceid:e.id,type:0})}),i.getDataSource("delete_sy_course_relation",{id:t,type:0},function(e){e&&i.doArray("insert_sy_course_relation",a,function(e){})})};e.gridExamineOptions={},e.loadExamineUser=function(){e.gridExamineOptions={useExternalPagination:!1,useExternalSorting:!1,multiSelect:!1,enableHorizontalScrollbar:0,data:[],columnDefs:[{name:"姓名",field:"name",width:"99%"}],onRegisterApi:function(t){e.gridExaminesApi=t}}},e.loadExamineUser(),e.loadExamineData=function(){i.getDataSource("select_sy_user_examine",{coursewareid:o.id},function(t){e.gridExamineOptions.data=t})},e.courseware.courseExamineShow&&e.loadExamineData(),e.OpenUserInfo=function(){i.getDataSource("select_sy_user_examine",{platformid:a.user.platformid},function(a){e.gridExamineOptions.data=a,e.modalInstance=t.open({templateUrl:"examinePerview.html",size:"lg",scope:e})})},e.distributionCourseware=function(){var t=o.id,n=e.gridExaminesApi.selection.getSelectedRows();i.getDataSource("insert_sy_courseware_operation",{ids:t,userid:n[0].id,username:n[0].name,idss:t},function(t){i.getUrlData("../api/courseMainStatus",{coursewareids:o.id,mainstatus:2,operationuser:a.user.name,userid:a.user.accountId,currentstep:"课件分配",nextstep:"课件审核",operationcontent:(a.user.name+"已分配课件给"+n[0].name+"，等待审核").toString()},function(t){t?(r({message:"分配成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.close(),e.goback()):r({message:"分配失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(e){r({message:"分配失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})})})},e.openVideoPerview=function(t,a){0==e.course.videotype?p(a):g(e.course)};var p=function(a){e.modalInstance=t.open({templateUrl:"videoPerview.html",size:"lg",scope:e,resolve:{items:function(){return e.items}}}),n(function(){player=polyvObject("#divVideo").videoPlayer({width:"850",height:"490",vid:a})},0)},g=function(a){e.modalInstance=t.open({templateUrl:"doubluevideoPerview.html",size:"lg",scope:e,resolve:{items:function(){return e.items}}}),n(function(){player1=null,player2=null,player1=polyvObject("#doubleTeacher").videoPlayer({width:"100%",height:"560",vid:a.tempteachervideo,flashvars:{autoplay:"true",teaser_time:"0",start:"0",setScreen:"fill",ban_ui:"off",ban_control:"off",is_auto_replay:"on",ban_seek_by_limit_time:"off",ban_skin_progress_dottween:"on"}}),player2=polyvObject("#doublePPT").videoPlayer({width:"100%",height:"560",vid:a.temppptvideo,flashvars:{autoplay:"true",teaser_time:"0",start:"0",setScreen:"fill",setVolumeM:"0",ban_ui:"off",ban_control:"off",is_auto_replay:"on",ban_seek_by_limit_time:"off",ban_skin_progress_dottween:"on"}})},0)},h=function(){var t=player1.j2s_getCurrentTime();if(e.course.videotype>0){var a=player2.j2s_getCurrentTime();t!=a&&player2.j2s_seekVideo(t)}};s2j_onVideoPlay=function(){player1.j2s_resumeVideo(),e.course.videotype>0&&player2.j2s_resumeVideo(),clearInterval(u),u=setInterval(h,5e3)},s2j_onVideoPause=function(){player1.j2s_pauseVideo(),e.course.videotype>0&&player2.j2s_pauseVideo(),clearInterval(u)},e.uploadvideo=function(t){"videofile"==t?e.nowfile=e.course.videofile[0]:e.nowfile=e.course.pptfile[0];var n=/(?:\.([^.]+))?$/,i=n.exec(e.nowfile.name)[1],o={endpoint:"http://v.polyv.net:1080/files/",resetBefore:$("#reset_before").prop("checked"),resetAfter:!1,title:"title",desc:"desc",ext:i,writeToken:a.appConfig.vhallConfig.writeToken};$(".progress").addClass("active"),upload=polyv.upload(e.nowfile,o).fail(function(e){alert("Failed because: "+e)}).always(function(){}).progress(function(a,n,i){var o=(n/i*100).toFixed(2);e["process_"+t]=o,e.$apply()}).done(function(a,n){"videofile"==t?(e.course.tempteachervideo=a.substring(a.lastIndexOf("/")+1),e.course.tempteachervideofilename=n.name):(e.course.temppptvideo=a.substring(a.lastIndexOf("/")+1),e.course.temppptvideofilename=n.name),e[t+"vid"]=a.substring(a.lastIndexOf("/")+1),e.$apply()})}}]).controller("videoPerviewCtrl",["$scope",function(e){}]),angular.module("myApp").controller("courseMicroVideoController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService","FilesService",function(e,t,a,n,i,o,r,l,s,c,d){e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,columnDefs:[{name:"微视频名称",field:"name",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.viewMicroVideo(row)">{{row.entity.name}}</a></div>'},{name:"提供者",field:"provider"}]},e.doinitMicroVideo=function(){i.getDataSource("getAllMicroVideo",{id:o.id},function(t){e.allMicroVideo=t}),i.getDataSource("getCourseMicroVideo",{courseid:o.id},function(t){e.gridOptions.data=t})},e.doinitMicroVideo(),e.addMicroVideo=function(){i.getDataSource("delete_sy_course_relation",{id:e.course.id,type:2},function(){var t=[];angular.forEach(e.course.microVideo,function(a){t.push({id:i.getGUID(),coursewareid:e.course.id,sourceid:a.id,type:2})}),i.doArray("insert_sy_course_relation",t,function(t){e.course.microVideo=[],e.doinitMicroVideo()})})},e.viewMicroVideo=function(e){u(e.entity.videopath)};var u=function(a){e.modalInstance=t.open({templateUrl:"videoPerview.html",size:"lg",scope:e,resolve:{items:function(){return e.items}}}),n(function(){player=polyvObject("#divVideo").videoPlayer({width:"850",height:"490",vid:a})},0)};e.close=function(){e.modalInstance.dismiss("cancel")}}]),angular.module("myApp").controller("coursePerfectsController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService","FilesService",function(e,t,a,n,i,o,r,l,s,c,d){e.fale=!1,e.saveTeacherContent=function(){i.getDataSource("update_sy_courseware_teachercontent",{id:o.id,teachercontent:e.course.teachercontent},function(t){e.fale||r({message:"保存成功",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.fale=!1})},e.commitPerfectCourse=function(){e.fale=!0,e.saveTeacherContent(),i.getUrlData("../api/courseMainStatus",{coursewareids:o.id,mainstatus:6,operationuser:a.user.name,userid:a.user.accountId,currentstep:"课件完善",nextstep:"课件分类入库",operationcontent:(a.user.name+"已完善课件信息，等待分类入库").toString()},function(t){t?(r({message:"提交成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.goback()):r({message:"提交失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(e){r({message:"提交失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})})},e.goback=function(){l.go("index.coursewarelist",{type:o.type})}}]),angular.module("myApp").controller("courseStorageController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService","FilesService",function(e,t,a,n,i,o,r,l,s,c,d){e.categoryData={},e.loadCategory=function(){i.getDataSource("select_sy_courseware_category_relatiionbycourseid",{coursewareid:o.id},function(t){i.getDataSource("select_sy_courseware_category_root",{},function(a){i.getDataSource("select_sy_courseware_category_all",{},function(n){if(null!=a&&void 0!=a&&a.length>0&&null!=n&&void 0!=n&&n.length>0)for(var i in a){var o=new Array;for(var r in n)if(a[i].id==n[r].fid){if(null!=t&&void 0!=t&&t.length>0){for(var l in t)if(t[l].categoryid==n[r].id){n[r].checked=!0;break}}else n[r].checked=!1;o.push(n[r])}a[i].categoryData=o}e.categoryData=a},function(e){})},function(e){r({message:"获取分类数据失败",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})})})},e.loadCategory(),e.saveCategory=function(){if(null!=e.categoryData&&void 0!=e.categoryData&&e.categoryData.length>0){var t="";for(var n in e.categoryData){var l=e.categoryData[n].categoryData;if(null!=l&&void 0!=l&&l.length>0)for(var s in l)l[s].checked&&(""!=t?t+=","+l[s].id:t=l[s].id)}""!=t?i.getUrlData("../api/courseMoveRelatiion",{categoryids:t,coursewareid:o.id},function(t){t?i.getUrlData("../api/courseMainStatus",{coursewareids:o.id,mainstatus:7,operationuser:a.user.name,userid:a.user.accountId,currentstep:"课件分类入库",nextstep:"结束",operationcontent:(a.user.name+"已完成分类入库，流程结束").toString()},function(t){t?(r({message:"保存成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.goback()):r({message:"保存失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(e){r({message:"保存失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})}):r({message:"保存失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(e){r({message:"保存失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})}):r({message:"请先选择课件分类！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})}}}]),angular.module("myApp").controller("courseUeidtController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService","$http","FilesService","$filter",function(e,t,a,n,i,o,r,l,s,c,d,u,m){$(function(){$(".inputmask").inputmask({mask:"99:99:99"})}),e.gridEditOptions={},e.loadEditInfo=function(){e.gridEditOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,data:[],columnDefs:[{name:"起始时间",field:"starttime",width:"15%"},{name:"截止时间",field:"endtime",width:"15%"},{name:"起始文字",field:"startword",width:"20%"},{name:"截止文字",field:"endword",width:"20%"},{name:"意见",field:"opinion",width:"25%"}],onRegisterApi:function(t){e.gridApi=t}}},e.loadEditInfo(),e.loadEditData=function(){i.getDataSource("select_sy_courseware_edit",{coursewareid:o.id},function(t){e.gridEditOptions.data=t})},e.loadEditData(),e.coursewareedit={coursewareid:o.id},e.openUeidt=function(){e.modalInstance=t.open({templateUrl:"eidtInfo.html",size:"lg",scope:e})},e.saveUeidt=function(){void 0!=e.coursewareedit.starttime&&""!=e.coursewareedit.starttime?i.getDataSource("insert_sy_courseware_edit",{coursewareid:o.id,starttime:e.coursewareedit.starttime,endtime:e.coursewareedit.endtime,startword:e.coursewareedit.startword,endword:e.coursewareedit.endword,opinion:e.coursewareedit.opinion},function(t){r({message:"添加成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.loadEditData(),e.close(),e.coursewareedit={}}):r({message:"请输入起始时间！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},e.deleteUeidt=function(){var t=e.gridApi.selection.getSelectedRows(),n="";for(var o in t)""==n?n=t[o].id:n+="','"+t[o].id;i.getDataSource("delete_sy_courseware_editbyid",{ids:n},function(t){r({message:"删除成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.loadEditData()})},e.saveComment=function(){i.getDataSource("update_sy_courseware_comment",{id:o.id,comment:e.course.comment},function(e){r({message:"保存成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})})},e.close=function(){e.modalInstance.dismiss("cancel")}}]),angular.module("myApp").controller("courseUploadController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService","FilesService",function(e,t,a,n,i,o,r,l,s,c,d){e.uploadvideoFiles=function(t,a){e.course.videofile=t,e.process_videofile=0},e.saveviewfale=!1,e.saveVideoInfo=function(){return""==e.course.teachervideo?void r({message:"请上传编辑后的课件！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}):void i.getDataSource("update_sy_courseware_video_info",{coursewareid:o.id,teachervideo:e.course.teachervideo,pptvideo:e.course.pptvideo,teachervideoname:e.course.teachervideoname,pptvideoname:e.course.pptvideoname},function(t){e.saveviewfale&&r({message:"保存成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.saveviewfale=!0})},e.commitEditCourse=function(){e.saveviewfale=!1,e.saveVideoInfo(),i.getUrlData("../api/courseMainStatus",{coursewareids:o.id,mainstatus:5,operationuser:a.user.name,userid:a.user.accountId,currentstep:"课件编辑",nextstep:"课件完善",operationcontent:(a.user.name+"已提交编辑后的课件，等待完善课件").toString()},function(t){t?(r({message:"提交成功！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.goback()):r({message:"提交失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(e){r({message:"提交失败！",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})})},e.close=function(){e.modalInstance.dismiss("cancel")},e.goback=function(){l.go("index.coursewarelist",{type:o.type})},e.openVideoPerview=function(t,a){0==e.course.videotype?u(a):m(e.course)};var u=function(a){e.modalInstance=t.open({templateUrl:"videoPerview.html",size:"lg",scope:e,resolve:{items:function(){return e.items}}}),n(function(){player=polyvObject("#divVideo").videoPlayer({width:"850",height:"490",vid:a})},0)},m=function(a){e.modalInstance=t.open({templateUrl:"doubluevideoPerview.html",size:"lg",scope:e,resolve:{items:function(){return e.items}}}),n(function(){player1=null,player2=null,player1=polyvObject("#doubleTeacher").videoPlayer({width:"100%",height:"560",vid:a.teachervideo,flashvars:{autoplay:"true",teaser_time:"0",start:"0",setScreen:"fill",ban_ui:"off",ban_control:"off",is_auto_replay:"on",ban_seek_by_limit_time:"off",ban_skin_progress_dottween:"on"}}),player2=polyvObject("#doublePPT").videoPlayer({width:"100%",height:"560",vid:a.pptvideo,flashvars:{autoplay:"true",teaser_time:"0",start:"0",setScreen:"fill",setVolumeM:"0",ban_ui:"off",ban_control:"off",is_auto_replay:"on",ban_seek_by_limit_time:"off",ban_skin_progress_dottween:"on"}})},0)},f=function(){var t=player1.j2s_getCurrentTime();if(e.course.videotype>0){var a=player2.j2s_getCurrentTime();t!=a&&player2.j2s_seekVideo(t)}};s2j_onVideoPlay=function(){player1.j2s_resumeVideo(),e.course.videotype>0&&player2.j2s_resumeVideo(),clearInterval(obj),obj=setInterval(f,5e3)},s2j_onVideoPause=function(){player1.j2s_pauseVideo(),e.course.videotype>0&&player2.j2s_pauseVideo(),clearInterval(obj)},e.uploadvideo=function(t){"videofile"==t?e.nowfile=e.course.videofile[0]:e.nowfile=e.course.pptfile[0];var n=/(?:\.([^.]+))?$/,i=n.exec(e.nowfile.name)[1],o={endpoint:"http://v.polyv.net:1080/files/",resetBefore:$("#reset_before").prop("checked"),resetAfter:!1,title:"title",desc:"desc",ext:i,writeToken:a.appConfig.vhallConfig.writeToken};$(".progress").addClass("active"),upload=polyv.upload(e.nowfile,o).fail(function(e){alert("Failed because: "+e)}).always(function(){}).progress(function(a,n,i){var o=(n/i*100).toFixed(2);e["process_"+t]=o,e.$apply()}).done(function(a,n){"videofile"==t?(e.course.teachervideo=a.substring(a.lastIndexOf("/")+1),e.course.teachervideoname=n.name):(e.course.pptvideo=a.substring(a.lastIndexOf("/")+1),e.course.pptvideoname=n.name),e[t+"vid"]=a.substring(a.lastIndexOf("/")+1),e.$apply()})}}]).controller("videoPerviewCtrl",["$scope",function(e){}]),angular.module("myApp").controller("coursewareController",["$scope","$rootScope","getDataSource","$state","notify","$modal","CommonService",function(e,t,a,n,i,o,r){var l={pageNumber:1,pageSize:25,sort:null};$(function(){}),e.search={},e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"序号",width:"6%",field:"rownum",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"课程名称",width:"45%",field:"name",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.name}}</a></div>',headerCellClass:"mycenter"},{name:"授课人",width:"10%",field:"teachersname",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建人",width:"10%",field:"createuser",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建时间",width:"10%",field:"createtime",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"date:'yyyy-MM-dd'"},{name:"选用次数",width:"10%",field:"cwcount",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"状态",width:"10%",field:"mainstatus",cellFilter:"coursewareStatusFilter",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(a){e.gridApi=a,a.pagination.on.paginationChanged(e,function(t,a){l.pageNumber=t,l.pageSize=a,e.loadGrid()}),a.core.on.sortChanged(e,function(t,a){if(0==a.length)l.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),l.sort=n}e.loadGrid()}),a.selection.on.rowSelectionChanged(e,function(e){"row selected "+e.isSelected;e.entity.isshare&&(e.isSelected=!1,i({message:"该课程为共享课程，不能被操作。",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}))})}},e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()},e.goDetial=function(e){n.go("index.coursewareEdit",{id:e.entity.id})},e.loadGrid=function(){var n=(l.pageNumber-1)*l.pageSize,i=l.pageSize,o="selectAllCourseware";0==t.user.platformcategory&&(o="selectPlatformAllCourseware"),a.getList(o,{platformid:t.user.platformid},{firstRow:n,pageSize:i},e.search,l.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadGrid(),e.coursewareCategoryRoot={},e.coursewareCategoryData={},e.Category={},e.coursewareMove=function(){var n=e.gridApi.selection.getSelectedRows();null!=n&&void 0!=n&&n.length>0&&a.getDataSource("select_sy_courseware_category_root",{platformid:t.user.platformid},function(t){e.coursewareCategoryRoot=t,null!=t&&void 0!=t&&t.length>0&&(e.Category.selectedCategoryRoot="",e.categoryRootChange()),e.modalInstance=o.open({templateUrl:"coursewaremoveinfo.html",size:"lg",scope:e})},function(e){i({message:"获取分类数据失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})},e.categoryRootChange=function(){a.getDataSource("select_sy_courseware_categorybyfid",{fid:e.Category.selectedCategoryRoot,platformid:t.user.platformid},function(t){e.coursewareCategoryData=t,e.Category.selectedCategoryInfo="",null!=t&&void 0!=t&&t.length>0&&(e.Category.selectedCategoryInfo="")},function(e){i({message:"获取分类数据失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})},e.close=function(){e.modalInstance.dismiss("cancel")},e.coursewareMoveSave=function(){var n=e.gridApi.selection.getSelectedRows();if(null!=n&&void 0!=n&&n.length>0){var o="";for(var r in n)""!=o?o+=","+n[r].id:o=n[r].id;if(""==e.Category.selectedCategoryRoot)return void i({message:"请选择分类！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl});""==e.Category.selectedCategoryInfo&&(e.Category.selectedCategoryInfo=e.Category.selectedCategoryRoot),a.getUrlData("../api/courseMove",{categoryids:o,categoryid:e.Category.selectedCategoryInfo,rootCategoryid:e.Category.selectedCategoryRoot},function(a){
i(a?{message:"保存成功！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}:{message:"保存失败！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.close()},function(a){i({message:"保存失败！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.close()})}},e.ok=function(){e.isAccept=!0;var n=e.gridApi.selection.getSelectedRows(),o="";for(var r in n)""==o?o=n[r].id:o+=","+n[r].id;a.getUrlData("../api/courseMainStatus",{coursewareids:o,mainstatus:-2,operationuser:t.user.name,currentstep:"课件删除",userid:t.user.accountId,nextstep:"结束",operationcontent:(t.user.name+"课件删除").toString(),laststatus:0,deleteContent:""},function(a){a?(i({message:"删除成功！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadGrid()):i({message:"删除失败！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(e){i({message:"删除失败！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})}),e.close()},e.close=function(){e.modalInstance.dismiss("cancel")},e["delete"]=function(){e.modalInstance=o.open({templateUrl:"confirm.html",size:"sm",scope:e})},e.ExportToc=function(){window.location.href="../api/outdoc"}}]),app.controller("coursewarecategoryController",["$scope","$rootScope","$state","$http","$timeout","$document","$modal","notify","getDataSource","DateService","CommonService",function(e,t,a,n,i,o,r,l,s,c,d){function u(t,a,n){var i={id:a.id,fid:a.fid,name:a.name},o=_.filter(t,{fid:a.id}),r=o.length;if(i.name=n+"┕━"+a.name,e.parentCategory.push(i),r>0){n+="　";for(var l=0;r>l;l++)u(t,o[l],n)}}function m(e,t,a){var n={label:a.name,rowid:a.id,children:[],isedit:a.category},i=_.filter(t,{fid:a.id}),o=i.length;if(o>0)for(var r=0;o>r;r++)m(n,t,i[r]);e.children.push(n)}var f,p=0;e.parentDisabled=!1,e.nameDisabled=!1,e.saveCurrentButtonDisabled=!1,e.deleteDisabled=!1,e.sortsDisabled=!1,e.categoryForm={sortnum:0},e.my_tree_handler=function(t){e.output="","0"==t.rowid?(e.parentDisabled=!0,e.nameDisabled=!0,e.categoryForm={sortnum:0},e.saveCurrentButtonDisabled=!0,e.deleteDisabled=!0):(e.parentDisabled=!1,e.nameDisabled=!1,e.saveCurrentButtonDisabled=!1,e.deleteDisabled=!1,e.sortsDisabled=!1),1==t.isedit?(e.parentDisabled=!0,e.nameDisabled=!0,e.parentDisabled=!0,e.sortsDisabled=!0,e.saveCurrentButtonDisabled=!0,e.deleteDisabled=!0):2==t.isedit&&("0"==t.rowid?(e.parentDisabled=!0,e.nameDisabled=!0,e.sortsDisabled=!1):(e.parentDisabled=!1,e.nameDisabled=!1,e.sortsDisabled=!1)),e.loadCourseCategoryParent(t)},e.loadCourseCategoryParent=function(a){p=a.rowid,s.getDataSource("select_courseCategoryParent",{platformid:t.user.platformid},function(t){e.parentCategory=new Array,e.parentCategory.push({id:"0",fid:"0",name:"根目录"});for(var a=_.filter(t,{fid:"0"}),n=_.filter(a,{fid:"0"}).length,i="　",o=0;n>o;o++)u(t,a[o],i);""!=p&&void 0!=p&&null!=p&&s.getDataSource("getcourseCategoryById",{id:p},function(t){t.length>0&&(e.categoryForm=t[0])},function(e){})},function(e){})},e.ok=function(){e.isAccept=!0,e.deleteDisabled=!0,s.getDataSource("select_courseCategoryChildren",{fid:p},function(a){var n=a.length;0>=n?s.getDataSource("deletecourseCategoryById",{id:p},function(a){a.length>0?(l({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.my_data=[],e.categoryForm={sortnum:0},e.deleteDisabled=!0,e.loadCategoryTree()):(e.deleteDisabled=!1,l({message:a.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl}))},function(e){}):(l({message:"删除失败，请先删除分类下子分类。",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.deleteDisabled=!1)},function(e){}),e.close()},e.OpenNewForm=function(){e.modalInstance=r.open({templateUrl:"newcategory.html",size:"bg",scope:e})},e.close=function(){e.modalInstance.dismiss("cancel")},e.deleteCourseCategory=function(){e.modalInstance=r.open({templateUrl:"confirm.html",size:"sm",scope:e})},e.saveCurrentCourseCategory=function(){e.saveCurrentButtonDisabled=!0;var a=s.getGUID();if(void 0!=p&&"0"!=p&&void 0!=p&&null!=p){var a=s.getGUID();if(g=e.categoryForm.id,e.getFids(e.categoryForm.fid),g){var n=g.split(".");_.reverse(n);n.length;g=_.join(n,".")}void 0==g&&(g=a);var i="";""!=e.categoryForm.fid&&void 0!=e.categoryForm.fid||(i="0"),s.getDataSource("updateCourseCategoryById",{id:p,fid:e.categoryForm.fid,name:e.categoryForm.name,sortnum:e.categoryForm.sortnum,fids:g},function(a){e.saveCurrentButtonDisabled=!1,a.length>0?(l({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.my_data=[],e.categoryForm={sortnum:0},e.loadCategoryTree()):l({message:a.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})},function(t){e.saveCurrentButtonDisabled=!1})}};var g="";e.getFids=function(t){var a=_.find(e.parentCategory,{id:t});null!=a&&"0"!=a.id&&(g=g+"."+a.id,e.getFids(a.fid))},e.saveCourseCategory=function(){var a=s.getGUID();if(g=e.categoryForm.id,e.getFids(e.categoryForm.fid),g){var n=g.split(".");_.reverse(n);n.length;g=_.join(n,".")}void 0==g&&(g=a);var i=p;void 0!=i&&"0"!=i||(i="0");var o={};o.id=a,o.fid=i,o.name=e.categoryForm.childname,o.sortnum=e.categoryForm.sortnum,o.platformid=t.user.platformid,o.fids=g,o.categoryid=a,s.getDataSource(["insert_courseCategory"],o,function(a){a.length>0?(l({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.my_data=[],e.categoryForm={sortnum:0},p=0,e.loadCategoryTree(),e.close()):l({message:a.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})},function(e){})},e.my_data=new Array,e.my_tree=f={},e.loadCategoryTree=function(){s.getDataSource("select_courseCategoryParent",{platformid:t.user.platformid},function(t){var a=t,n=new Object;n.label="总平台课程分类",n.rowid="0",n.children=new Array,n.isedit=1;for(var i=0;i<a.length;i++)"0"==a[i].fid&&m(n,a,a[i]);e.my_data.push(n),e.doing_async=!1,f.expand_all()},function(e){})},e.try_async_load=function(){e.my_data=new Array,e.doing_async=!0,e.loadCategoryTree()},e.try_async_load()}]),angular.module("myApp").controller("coursewarecategoryeditController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource","$validation",function(e,t,a,n,i,o,r,l,s){e.parentCategory=[],e.categoryForm=new Object,e.saveButtonDisabled=!1;var c=i.id;e.loadCourseCategoryParent=function(){l.getDataSource("select_courseCategoryParent",{},function(t){e.parentCategory=t,""!=c&&void 0!=c&&null!=c&&l.getDataSource("getcourseCategoryById",{id:c},function(t){e.categoryForm=t[0]},function(e){})},function(e){})},e.loadCourseCategoryParent(),e.saveCourseCategory=function(){e.saveButtonDisabled=!0;var a=l.getGUID();if(""!=c&&void 0!=c&&null!=c){var n=_.find(e.parentCategory,{id:e.categoryForm.fid}).id+"."+c;l.getDataSource("updateCourseCategoryById",{id:c,fid:e.categoryForm.fid,name:e.categoryForm.name,fids:n},function(a){e.saveButtonDisabled=!1,a.length>0?(o({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),r.go("index.coursewarecategoryedit",{id:c})):o({message:a.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})},function(t){e.saveButtonDisabled=!1})}else{var n=_.find(e.parentCategory,{id:e.categoryForm.fid}).id+"."+a;l.getDataSource("insert_courseCategory",{id:a,fid:e.categoryForm.fid,name:e.categoryForm.name,platformid:t.user.platformid,fids:n},function(n){e.saveButtonDisabled=!1,n.length>0?(o({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),r.go("index.coursewarecategoryedit",{id:a})):o({message:n.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})},function(t){e.saveButtonDisabled=!1})}}}]),angular.module("myApp").controller("coursewarelistController",["$rootScope","$scope","getDataSource","$state","$stateParams","$modal","notify",function(e,t,a,n,i,o,r){var l={pageNumber:1,pageSize:25,sort:null};t.search={},t.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"课程名称",field:"name",width:"49%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.name}}</a></div>'},{name:"授课人",field:"teachersname",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"授课时间",field:"teachtime",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"date:'yyyy-MM-dd'"},{name:"状态",field:"mainstatus",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"mainStatusFilters"}],onRegisterApi:function(e){t.gridApi=e,e.pagination.on.paginationChanged(t,function(e,a){l.pageNumber=e,l.pageSize=a,t.loadGrid()}),e.core.on.sortChanged(t,function(e,a){if(0==a.length)l.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),l.sort=n}t.loadGrid()})}},t.goSearch=function(){t.gridOptions.paginationCurrentPage=1,t.loadGrid()},t.goDetial=function(e){if("all"==i.type)switch(e.entity.mainstatus){case 0:n.go("index.courseEdit",{id:e.entity.id,type:"upload"});break;case 1:n.go("index.courseEdit",{id:e.entity.id,type:"distribution"});break;case 2:n.go("index.courseEdit",{id:e.entity.id,type:"examine"});break;case 3:n.go("index.courseEdit",{id:e.entity.id,type:"authorization"});break;case 4:n.go("index.courseEdit",{id:e.entity.id,type:"wareedit"});break;case 5:n.go("index.courseEdit",{id:e.entity.id,type:"perfect"});break;case 6:n.go("index.courseEdit",{id:e.entity.id,type:"storage"});break;case 7:n.go("index.courseEdit",{id:e.entity.id,type:"formal"});break;case-2:n.go("index.courseEdit",{id:e.entity.id,type:"waredelete"})}else n.go("index.courseEdit",{id:e.entity.id,type:i.type})},t.courseware={functionname:"selectAllCoursewareBymainstatus",userid:"",mainstatus:0,mainStatusShow:!1,uploadShow:!1,distributionShow:!1},t.mainstatus=0,t.type=i.type,t.setCourseWareType=function(){switch(i.type){case"upload":t.courseware.mainstatus=0,t.courseware.uploadShow=!0;break;case"distribution":t.courseware.mainstatus=1,t.courseware.distributionShow=!0;break;case"examine":t.courseware.mainstatus=2,t.courseware.userid=e.user.accountId,t.courseware.functionname="selectAllCoursewareByuserid";break;case"authorization":t.courseware.mainstatus=3;break;case"wareedit":t.courseware.mainstatus=4;break;case"perfect":t.courseware.mainstatus=5;break;case"storage":t.courseware.mainstatus=6;break;case"formal":t.courseware.mainstatus=7;break;case"waredelete":t.courseware.mainstatus=-2;break;case"all":t.courseware.functionname="selectCoursewareAll",t.courseware.mainStatusShow=!0}},t.loadGrid=function(){t.setCourseWareType();var e=(l.pageNumber-1)*l.pageSize,n=l.pageSize;a.getList(t.courseware.functionname,{mainstatus:t.courseware.mainstatus,userid:t.courseware.userid},{firstRow:e,pageSize:n},t.search,l.sort,function(e){t.gridOptions.totalItems=e[0].allRowCount,t.gridOptions.data=e[0].data})},t.loadGrid(),t.gridExamineOptions={},t.loadExamineUser=function(){t.gridExamineOptions={useExternalPagination:!1,useExternalSorting:!1,multiSelect:!1,enableHorizontalScrollbar:0,data:[],columnDefs:[{name:"姓名",field:"name",width:"99%"}],onRegisterApi:function(e){t.gridExamineApi=e}}},t.loadExamineUser(),t.commitCourseInfo=function(){var n=t.gridApi.selection.getSelectedRows(),i="";for(var o in n)""==i?i=n[o].id:i+="','"+n[o].id;a.getUrlData("../api/courseMainStatus",{coursewareids:i,mainstatus:1,operationuser:e.user.name,currentstep:"课件上传",nextstep:"课件分配",operationcontent:(e.user.name+"已提交课件，等待分配审核").toString()},function(a){a?(r({message:"提交成功！",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadGrid()):r({message:"提交失败！",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})},function(t){r({message:"提交失败！",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})})},t["delete"]=function(){var n=t.gridApi.selection.getSelectedRows(),i="";for(var o in n)""==i?i=n[o].id:i+=","+n[o].id;a.getUrlData("../api/courseMainStatus",{coursewareids:i,mainstatus:-2,operationuser:e.user.name,currentstep:"课件删除",nextstep:"结束",userid:e.user.accountId,operationcontent:(e.user.name+"课件删除").toString(),laststatus:0,deleteContent:""},function(a){a?(r({message:"删除成功！",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadGrid()):r({message:"删除失败！",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})},function(t){r({message:"删除失败！",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})})},t.OpenUserInfo=function(){a.getDataSource("select_sy_user_examine",{platformid:e.user.platformid},function(e){t.gridExamineOptions.data=e,t.modalInstance=o.open({templateUrl:"examinePerview.html",size:"lg",scope:t})})},t.distributionCourseware=function(){var n=t.gridApi.selection.getSelectedRows(),i="";for(var o in n)""==i?i=n[o].id:i+="','"+n[o].id;var l=t.gridExamineApi.selection.getSelectedRows();a.getDataSource("insert_sy_courseware_operation",{ids:i,userid:l[0].id,username:l[0].name,idss:i},function(n){a.getUrlData("../api/courseMainStatus",{coursewareids:i,mainstatus:2,operationuser:e.user.name,userid:e.user.accountId,currentstep:"课件分配",nextstep:"课件审核",operationcontent:(e.user.name+"已分配课件给"+l[0].name+"，等待审核").toString()},function(a){a?(r({message:"分配成功！",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadGrid(),t.close()):r({message:"分配失败！",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})},function(t){r({message:"分配失败！",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})})})},t.close=function(){t.modalInstance.dismiss("cancel")}}]).filter("mainStatusFilters",function(){var e={"-2":"已删除",0:"未提交",1:"待分配",2:"待审核",3:"待授权",4:"待编辑",5:"待完善",6:"待分类",7:"已入库"};return function(t){return null!=t&&void 0!=t?e[t]:""}}),angular.module("myApp").controller("coursewareEditController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService","FilesService","DateService","$timeout",function(e,t,a,n,i,o,r,l,s,c,d,u,n){e.course={teachers:[],videotype:0,createtime:u.format(new Date,"yyyy-MM-dd")},e.courseware={coursePerfectEditShow:!0};var m={};e.st={},e.checkedAnswer={},e.nowid=o.id,e.type=o.type,e.typeShow=!0,"1"==e.type&&(e.typeShow=!1),e.saveButtonDisabled=!1,e.uploadvideoFiles=function(t,a){e.course.videofile=t,e.process_videofile=0},i.getDataSource("selectAllTeacher",{platformid:a.user.platformid},function(t){e.allTeachers=t}),e.GetRealDuration=function(){i.getUrlData("../api/getRealDuration",{vid:e.course.teachervideo},function(t){e.course.realduration=t[0].duration},function(e){})},e.gridOptions={},e.gridSTOptions={},e.gridApiST={},e.gridXXOptions={},e.answers=[],e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,columnDefs:[{name:"微视频名称",field:"name",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.viewMicroVideo(row)">{{row.entity.name}}</a></div>'},{name:"提供者",field:"provider"}],onRegisterApi:function(t){e.gridMicrApiST=t}},e.deleteST=function(){var t=e.gridApiST.selection.getSelectedRows();i.doArray("deleteExam",t,function(t){e.doinitST()})},e.doinitST=function(){i.getDataSource("selectExamByCourse",{id:o.id},function(t){e.gridSTOptions.data=t})},e.doinitST(),e.gridSTOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,columnDefs:[{name:"试题名称",field:"examtitle",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.oepnST(row)">{{row.entity.examtitle}}</a></div>'},{name:"题型",field:"examcategory",cellFilter:"examCategoryFilter"}],onRegisterApi:function(t){e.gridApiST=t}},e.viewMicroVideo=function(e){y(e.entity.videopath)},e.addMicroDisabled=!1,e.addMicroVideo=function(){e.addMicroDisabled=!0;var t=[];angular.forEach(e.course.microVideo,function(a){t.push({id:i.getGUID(),coursewareid:e.course.id,sourceid:a.id,type:2})}),i.doArray("insert_sy_course_relation",t,function(t){angular.forEach(e.course.microVideo,function(t){_.remove(e.allMicroVideo,{id:t.id})}),e.course.microVideo=[],e.doinitMicroVideo(),e.addMicroDisabled=!1},function(t){e.addMicroDisabled=!1})},e.delMicroVideo=function(){var t=e.gridMicrApiST.selection.getSelectedRows();null!=t&&void 0!=t&&t.length>0&&i.doArray("deleteCourseMicroVideo",t,function(t){e.doinitMicroVideo(),r({message:"删除成功",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})})},e.coursewareCategoryRoot={},e.coursewareCategoryData={},e.Category={selectedCategoryRoot:"",selectedCategoryInfo:""},i.getDataSource("select_sy_courseware_category_root",{},function(t){e.coursewareCategoryRoot=t,o.id?i.getDataSource(["selectCoursewareById","selectCourseware_teacherRelation","getCategoryByCourse"],{id:o.id,coursewareid:o.id,courseid:o.id},function(t){var a=_.find(t,function(e){return"selectCourseware_teacherRelation"==e.name});e.course=_.find(t,function(e){return"selectCoursewareById"==e.name}).data[0],e.course.teachers=a.data,e.nowfile=d.showFile("coursewarePhoto",e.course.imagephoto,e.course.imagephoto);var n=_.find(t,function(e){return"getCategoryByCourse"==e.name}).data[0];"0"==n.fid||""==n.fid?(e.Category.selectedCategoryRoot=n.id,e.Category.selectedCategoryInfo=""):(e.Category.selectedCategoryRoot=n.fid,e.categoryRootChange(n.id))}):null!=t&&void 0!=t&&t.length>0&&(e.Category.selectedCategoryRoot=t[0].id,e.categoryRootChange())},function(e){r({message:"获取分类数据失败",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})}),e.categoryRootChange=function(t){i.getDataSource("select_sy_courseware_categorybyfid",{fid:e.Category.selectedCategoryRoot,platformid:a.user.platformid},function(a){e.coursewareCategoryData=a,t&&""!=t?n(function(){e.Category.selectedCategoryInfo=t},500):null!=a&&void 0!=a&&a.length>0&&(e.Category.selectedCategoryInfo=a[0].id)},function(e){r({message:"获取分类数据失败",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})})},e.deleteAnswer=function(t){_.pull(e.answers,t)},e.saveExamDisabled=!1,e.addST=function(){e.saveExamDisabled=!0,0==e.st.examcategory&&angular.forEach(e.answers,function(t){t.id==e.checkedAnswer.checkedID?t.isright=1:t.isright=0});var t=0;return angular.forEach(e.answers,function(e){1==e.isright&&t++}),0==t?void r({message:"必须选择一个正确答案",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}):void(e.newst?(e.st.id=i.getGUID(),e.st.coursewareid=o.id,angular.forEach(e.answers,function(t){t.examid=e.st.id}),i.getDataSource("addCourseExam",e.st,function(t){e.saveExamDisabled=!1,i.doArray("insertExamAnswer",e.answers,function(t){e.doinitST(),e.close()})},function(t){e.saveExamDisabled=!1})):i.getDataSource("updateCourseExam",e.st,function(t){e.saveExamDisabled=!1,i.getDataSource("deleteExamAnswer",{examid:e.st.id},function(t){i.doArray("insertExamAnswer",e.answers,function(t){e.doinitST(),e.close()})})},function(t){e.saveExamDisabled=!1}))},e.addExamAnswer=function(){e.answers.push({id:i.getGUID(),isright:!1,answer:"",examid:e.st.id})},e.uploadpptFiles=function(t,a){e.course.pptfile=t,e.process_pptfile=0},e.close=function(){e.modalInstance.dismiss("cancel")},e.goback=function(){"1"==e.type?l.go("index.alumnusCourseware"):l.go("index.courseware")},e.uploadFiles=function(t){e.files=t},e.save=function(){e.files?d.upLoadPicture(e.files[0],{upcategory:"coursewarePhoto",width:200,height:120},function(t){e.course.imagephoto=t.data[0].servername,p()}):p()};var f=function(t){""==e.Category.selectedCategoryInfo&&(e.Category.selectedCategoryInfo=e.Category.selectedCategoryRoot),i.getUrlData("../api/courseMove",{categoryids:t,categoryid:e.Category.selectedCategoryInfo,rootCategoryid:e.Category.selectedCategoryRoot},function(e){},function(e){})},p=function(){if(e.saveButtonDisabled=!0,e.course.teachersid=c.getJoinString(e.course.teachers,"id"),e.course.teachersname=c.getJoinString(e.course.teachers,"name"),o.id)h(o.id),3==e.course.videotype?e.course.coursetype=1:e.course.coursetype=0,i.getDataSource("updateCoursewareById",e.course,function(t){e.saveButtonDisabled=!1,g(e.course.id),f(e.course.id),r({message:"保存成功",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(t){r({message:"保存失败",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.saveButtonDisabled=!1});else{var t=i.getGUID();e.course.id=t,h(t),e.course.createplatformid=a.user.platformid,e.course.createuser=a.user.name,e.course.mainstatus=7,3!=e.course.videotype?(e.course.mainstatus=0,e.course.coursetype=0):e.course.coursetype=1,i.getDataSource("insertCourseware",e.course,function(a){e.saveButtonDisabled=!1,g(e.course.id),f(e.course.id),l.go("index.coursewareEdit",{id:t})})}},g=function(t){i.getDataSource("delete_sy_pptcourseware_queue",{coursewareid:t},function(){e.course.foldername="pptCourseFile",i.getDataSource("insert_sy_pptcourseware_queue",e.course,function(e){})})},h=function(t){var a=[];angular.forEach(e.course.teachers,function(e){a.push({id:i.getGUID(),coursewareid:t,sourceid:e.id,type:0})}),i.getDataSource("delete_sy_course_relation",{id:t,type:0},function(){i.doArray("insert_sy_course_relation",a,function(e){})})};e.openVideoPerview=function(t,a){0==e.course.videotype?y(a):C(e.course)};var y=function(a){e.modalInstance=t.open({templateUrl:"videoPerview.html",size:"lg",scope:e,resolve:{items:function(){return e.items}}}),n(function(){player=polyvObject("#divVideo").videoPlayer({width:"850",height:"490",vid:a})},0)};e.changeST=function(){e.answers=[]},e.oepnST=function(a){a?(e.newst=!1,e.st=a.entity,i.getDataSource("selectExamAnswerByExam",{examid:a.entity.id},function(t){var a="";angular.forEach(t,function(e){1==e.isright&&(a=e.id,e.isright=!0)}),e.answers=t,e.checkedAnswer.checkedID=a})):(e.newst=!0,e.st={},e.answers=[]),e.modalInstance=t.open({templateUrl:"ST.html",size:"lg",scope:e}),e.stPlatformDisabled=!1,1==e.course.isshare&&(e.stPlatformDisabled=!0)};var C=function(a){e.modalInstance=t.open({templateUrl:"doubluevideoPerview.html",size:"lg",scope:e,resolve:{items:function(){return e.items}}}),n(function(){player1=null,player2=null,player1=polyvObject("#doubleTeacher").videoPlayer({width:"100%",height:"560",vid:a.teachervideo,flashvars:{autoplay:"true",teaser_time:"0",start:"0",setScreen:"fill",ban_ui:"off",ban_control:"off",is_auto_replay:"on",ban_seek_by_limit_time:"off",ban_skin_progress_dottween:"on"}}),player2=polyvObject("#doublePPT").videoPlayer({width:"100%",height:"560",vid:a.pptvideo,flashvars:{autoplay:"true",teaser_time:"0",start:"0",setScreen:"fill",setVolumeM:"0",ban_ui:"off",ban_control:"off",is_auto_replay:"on",ban_seek_by_limit_time:"off",ban_skin_progress_dottween:"on"}})},0)},w=function(){var t=player1.j2s_getCurrentTime();if(e.course.videotype>0){var a=player2.j2s_getCurrentTime();t!=a&&player2.j2s_seekVideo(t)}};s2j_onVideoPlay=function(){player1.j2s_resumeVideo(),e.course.videotype>0&&player2.j2s_resumeVideo(),clearInterval(m),m=setInterval(w,5e3)},s2j_onVideoPause=function(){player1.j2s_pauseVideo(),e.course.videotype>0&&player2.j2s_pauseVideo(),clearInterval(m)},e.uploadvideo=function(t){"videofile"==t?e.nowfile=e.course.videofile[0]:e.nowfile=e.course.pptfile[0];var n=/(?:\.([^.]+))?$/,i=n.exec(e.nowfile.name)[1],o=(new Date).getTime(),r=md5(o+a.appConfig.vhallConfig.writeToken),l={endpoint:a.appConfig.vhallConfig.uploadPath,resetBefore:$("#reset_before").prop("checked"),resetAfter:!1,title:"title",desc:"desc",ts:o,hash:r,userid:a.appConfig.vhallConfig.userid,ext:i,writeToken:a.appConfig.vhallConfig.writeToken};$(".progress").addClass("active"),upload=polyv.upload(e.nowfile,l).fail(function(e){alert("Failed because: "+e)}).always(function(){}).progress(function(a,n,i){var o=(n/i*100).toFixed(2);e["process_"+t]=o,e.$apply()}).done(function(a,n){"videofile"==t?(e.course.teachervideo=a.substring(a.lastIndexOf("/")+1),e.course.teachervideoname=n.name):(e.course.pptvideo=a.substring(a.lastIndexOf("/")+1),e.course.pptvideoname=n.name),e[t+"vid"]=a.substring(a.lastIndexOf("/")+1),e.$apply()})},e.selectFiles=function(t){if(t&&t.length>0){var n=t[0].name.split("."),i=["pdf"];_.indexOf(i,n[n.length-1])<0?r({message:"请选择有效的文件进行上传",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}):(e.selectFile=t[0],e.selectFile&&d.upLoadFiles(e.selectFile,"pptCourseFile",function(t){e.course.pptcoursefile_servername=t.data[0].servername,e.course.pptcoursefile_clientname=e.selectFile.name}))}}}]).controller("videoPerviewCtrl",["$scope",function(e){}]),angular.module("myApp").controller("coursewareQuestController",["$scope","$rootScope","$stateParams","getDataSource","$state","notify","$modal","CommonService",function(e,t,a,n,i,o,r,l){e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"问卷名称",field:"title",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.title}}</a></div>'},{name:"问卷类型",field:"category",cellFilter:"questCategoryFilter"},{name:"创建人",field:"createuser"},{name:"创建时间",field:"createtime",cellFilter:"date:'yyyy-MM-dd'"}],onRegisterApi:function(t){e.gridApi=t}},e["delete"]=function(){var t=e.gridApi.selection.getSelectedRows(),i=[];angular.forEach(t,function(e){i.push({id:e.id,coursewareid:a.id})}),n.doArray("delete_sy_course_relationBysourceId",i,function(t){e.loadGrid()})},e.goNew=function(){i.go("index.questionnaire_edit",{id:"",coursewareid:a.id})},e.goDetial=function(e){i.go("index.questionnaire_edit",{id:e.entity.id,coursewareid:a.id})},e.loadGrid=function(){n.getDataSource(["select_sy_questionnaire_byCoursewareid","selectCoursewareById"],{platformid:t.user.platformid,coursewareid:a.id,id:a.id},function(t){e.course=_.find(t,function(e){return"selectCoursewareById"==e.name}).data[0],1==e.course.isshare&&l.initInputControlDisabled(),e.gridOptions.data=_.find(t,function(e){return"select_sy_questionnaire_byCoursewareid"==e.name}).data})},e.loadGrid()}]),angular.module("myApp").controller("downloadController",["$rootScope","$scope","getDataSource","$state","$stateParams","notify","$modal","FilesService","DateService",function(e,t,a,n,i,o,r,l,s){t.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,data:[],columnDefs:[{name:"资料名称",field:"attach",width:"30%",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.downFiles(row.entity.attach_servername, row.entity.attach_clientname, \'download\')">{{row.entity.attach}}</a></div>'},{name:"资料说明",field:"remark",width:"10%"},{name:"资料类型",field:"category",width:"10%",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.category == 1 ?"常用资源":"常用软件"}}</div>'},{name:"首页显示",field:"bottomshow",width:"10%",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.bottomshow == 0 ?"不显示":"显示"}}</div>'},{name:"首页排序",field:"bottomsort",width:"10%",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.bottomsort}}</div>'},{name:"创建人",field:"username",width:"10%"},{name:"发布时间",field:"publishtime",width:"15%"},{name:"状态",field:"status",width:"15%"}],onRegisterApi:function(e){t.gridApi=e}},t.loadSource=function(){a.getDataSource("getMaterial",{},function(e){t.gridOptions.data=e})},t.loadSource(),t.files=[],t.saveAttachDisabled=!1,t.addmaterial=function(a){t.saveAttachDisabled=!1,t.files=[],t.uploadFiles=function(e){t.files=e},t.downloadInfo={id:"",attach:"",attach_clientname:"",attach_servername:"",status:0,createuser:e.user.name,category:1,attach_logo:"",bottomshow:0,bottomsort:"0"},t.selectFile=null,t.modalInstance=r.open({templateUrl:"AttachDetail.html",size:"lg",scope:t})},t.close=function(){t.modalInstance.dismiss("cancel")},t.downFiles=function(e,t,a){return l.downFiles(a,e,t)},t.selectFiles=function(e){e&&e.length>0&&(t.selectFile=e[0])},t.doSave=function(){var n=a.getGUID();t.downloadInfo.id=n,""==t.downloadInfo.attach&&(t.downloadInfo.attach=t.downloadInfo.attach_clientname),a.getDataSource("insert_sy_material",t.downloadInfo,function(a){o({message:"保存成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadSource(),t.modalInstance.dismiss("cancel"),t.saveAttachDisabled=!1})},t.Addattach=function(){return 2==t.downloadInfo.category&&t.files.length<=0?void o({message:"请选择软件图标",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}):(t.saveAttachDisabled=!0,void(t.downloadInfo&&t.selectFile?l.upLoadFiles(t.selectFile,"download",function(a){t.downloadInfo.attach_clientname=t.selectFile.name,t.downloadInfo.attach_servername=a.data[0].servername,2==t.downloadInfo.category?t.files?l.upLoadPicture(t.files[0],{upcategory:"download",width:500,height:300},function(e){t.downloadInfo.attach_logo=e.data[0].servername,t.doSave()},function(e){t.saveDisabled=!1}):o({message:"请选择软件图标",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}):t.doSave()},function(a){t.saveAttachDisabled=!1,o({message:"保存失败",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})}):t.doSave()))},t.publish=function(){var n=t.gridApi.selection.getSelectedRows();null!=n&&void 0!=n&&n.length>0&&a.doArray("publishmaterial",n,function(a){o({message:"发布成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadSource()})},t["delete"]=function(){var n=t.gridApi.selection.getSelectedRows();null!=n&&void 0!=n&&n.length>0&&a.doArray("deletematerial",n,function(a){o({message:"删除成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadSource()})},t.unpageshow=function(){var n=t.gridApi.selection.getSelectedRows();null!=n&&void 0!=n&&n.length>0&&a.doArray("deletematerial",n,function(a){o({message:"删除成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadSource()})}}]),app.controller("getSQLController",["$scope","$state","getDataSource","$http","$timeout","$filter",function(e,t,a,n,i,o){e.alerts=[{type:"danger",msg:"Oh snap! Change a few things up and try submitting again."},{type:"success",msg:"Well done! You successfully read this important alert message."}],e.alert1=function(){o("date")(e.mydate,"yyyy-MM-dd")},e.addAlert=function(){e.alerts.push({msg:"Another alert!"})},e.closeAlert=function(t){e.alerts.splice(t,1)},e.mytbl={},e.mytbl.get=function(t,n,o){a.getDataSource("gettbl",{},function(t){e.datasouce=t}),i(function(){for(var a=[],i=t;t+n-1>=i;i++)e.datasouce[i]&&a.push(e.datasouce[i]);o(a)},100)},e.ng_grid=function(){t.go("main.content")},e.refalshSQL=function(){n.post("../api/SQLHandler",{}).success(function(){})},e.vm={},e.vm.countries=[{name:"Afghanistan",code:"AF"},{name:"Åland Islands",code:"AX"},{name:"Albania",code:"AL"},{name:"Algeria",code:"DZ"},{name:"American Samoa",code:"AS"},{name:"Andorra",code:"AD"},{name:"Angola",code:"AO"},{name:"Anguilla",code:"AI"},{name:"Antarctica",code:"AQ"},{name:"Antigua and Barbuda",code:"AG"},{name:"Argentina",code:"AR"},{name:"Armenia",code:"AM"},{name:"Aruba",code:"AW"},{name:"Australia",code:"AU"},{name:"Austria",code:"AT"},{name:"Azerbaijan",code:"AZ"},{name:"Bahamas",code:"BS"},{name:"Bahrain",code:"BH"},{name:"Bangladesh",code:"BD"},{name:"Barbados",code:"BB"},{name:"Belarus",code:"BY"},{name:"Belgium",code:"BE"},{name:"Belize",code:"BZ"},{name:"Benin",code:"BJ"},{name:"Bermuda",code:"BM"},{name:"Bhutan",code:"BT"},{name:"Bolivia",code:"BO"},{name:"Bosnia and Herzegovina",code:"BA"},{name:"Botswana",code:"BW"},{name:"Bouvet Island",code:"BV"},{name:"Brazil",code:"BR"},{name:"British Indian Ocean Territory",code:"IO"},{name:"Brunei Darussalam",code:"BN"},{name:"Bulgaria",code:"BG"},{name:"Burkina Faso",code:"BF"},{name:"Burundi",code:"BI"},{name:"Cambodia",code:"KH"},{name:"Cameroon",code:"CM"},{name:"Canada",code:"CA"},{name:"Cape Verde",code:"CV"},{name:"Cayman Islands",code:"KY"},{name:"Central African Republic",code:"CF"},{name:"Chad",code:"TD"},{name:"Chile",code:"CL"},{name:"China",code:"CN"},{name:"Christmas Island",code:"CX"},{name:"Cocos (Keeling) Islands",code:"CC"},{name:"Colombia",code:"CO"},{name:"Comoros",code:"KM"},{name:"Congo",code:"CG"},{name:"Congo, The Democratic Republic of the",code:"CD"},{name:"Cook Islands",code:"CK"},{name:"Costa Rica",code:"CR"},{name:"Cote D'Ivoire",code:"CI"},{name:"Croatia",code:"HR"},{name:"Cuba",code:"CU"},{name:"Cyprus",code:"CY"
},{name:"Czech Republic",code:"CZ"},{name:"Denmark",code:"DK"},{name:"Djibouti",code:"DJ"},{name:"Dominica",code:"DM"},{name:"Dominican Republic",code:"DO"},{name:"Ecuador",code:"EC"},{name:"Egypt",code:"EG"},{name:"El Salvador",code:"SV"},{name:"Equatorial Guinea",code:"GQ"},{name:"Eritrea",code:"ER"},{name:"Estonia",code:"EE"},{name:"Ethiopia",code:"ET"},{name:"Falkland Islands (Malvinas)",code:"FK"},{name:"Faroe Islands",code:"FO"},{name:"Fiji",code:"FJ"},{name:"Finland",code:"FI"},{name:"France",code:"FR"},{name:"French Guiana",code:"GF"},{name:"French Polynesia",code:"PF"},{name:"French Southern Territories",code:"TF"},{name:"Gabon",code:"GA"},{name:"Gambia",code:"GM"},{name:"Georgia",code:"GE"},{name:"Germany",code:"DE"},{name:"Ghana",code:"GH"},{name:"Gibraltar",code:"GI"},{name:"Greece",code:"GR"},{name:"Greenland",code:"GL"},{name:"Grenada",code:"GD"},{name:"Guadeloupe",code:"GP"},{name:"Guam",code:"GU"},{name:"Guatemala",code:"GT"},{name:"Guernsey",code:"GG"},{name:"Guinea",code:"GN"},{name:"Guinea-Bissau",code:"GW"},{name:"Guyana",code:"GY"},{name:"Haiti",code:"HT"},{name:"Heard Island and Mcdonald Islands",code:"HM"},{name:"Holy See (Vatican City State)",code:"VA"},{name:"Honduras",code:"HN"},{name:"Hong Kong",code:"HK"},{name:"Hungary",code:"HU"},{name:"Iceland",code:"IS"},{name:"India",code:"IN"},{name:"Indonesia",code:"ID"},{name:"Iran, Islamic Republic Of",code:"IR"},{name:"Iraq",code:"IQ"},{name:"Ireland",code:"IE"},{name:"Isle of Man",code:"IM"},{name:"Israel",code:"IL"},{name:"Italy",code:"IT"},{name:"Jamaica",code:"JM"},{name:"Japan",code:"JP"},{name:"Jersey",code:"JE"},{name:"Jordan",code:"JO"},{name:"Kazakhstan",code:"KZ"},{name:"Kenya",code:"KE"},{name:"Kiribati",code:"KI"},{name:"Korea, Democratic People's Republic of",code:"KP"},{name:"Korea, Republic of",code:"KR"},{name:"Kuwait",code:"KW"},{name:"Kyrgyzstan",code:"KG"},{name:"Lao People's Democratic Republic",code:"LA"},{name:"Latvia",code:"LV"},{name:"Lebanon",code:"LB"},{name:"Lesotho",code:"LS"},{name:"Liberia",code:"LR"},{name:"Libyan Arab Jamahiriya",code:"LY"},{name:"Liechtenstein",code:"LI"},{name:"Lithuania",code:"LT"},{name:"Luxembourg",code:"LU"},{name:"Macao",code:"MO"},{name:"Macedonia, The Former Yugoslav Republic of",code:"MK"},{name:"Madagascar",code:"MG"},{name:"Malawi",code:"MW"},{name:"Malaysia",code:"MY"},{name:"Maldives",code:"MV"},{name:"Mali",code:"ML"},{name:"Malta",code:"MT"},{name:"Marshall Islands",code:"MH"},{name:"Martinique",code:"MQ"},{name:"Mauritania",code:"MR"},{name:"Mauritius",code:"MU"},{name:"Mayotte",code:"YT"},{name:"Mexico",code:"MX"},{name:"Micronesia, Federated States of",code:"FM"},{name:"Moldova, Republic of",code:"MD"},{name:"Monaco",code:"MC"},{name:"Mongolia",code:"MN"},{name:"Montserrat",code:"MS"},{name:"Morocco",code:"MA"},{name:"Mozambique",code:"MZ"},{name:"Myanmar",code:"MM"},{name:"Namibia",code:"NA"},{name:"Nauru",code:"NR"},{name:"Nepal",code:"NP"},{name:"Netherlands",code:"NL"},{name:"Netherlands Antilles",code:"AN"},{name:"New Caledonia",code:"NC"},{name:"New Zealand",code:"NZ"},{name:"Nicaragua",code:"NI"},{name:"Niger",code:"NE"},{name:"Nigeria",code:"NG"},{name:"Niue",code:"NU"},{name:"Norfolk Island",code:"NF"},{name:"Northern Mariana Islands",code:"MP"},{name:"Norway",code:"NO"},{name:"Oman",code:"OM"},{name:"Pakistan",code:"PK"},{name:"Palau",code:"PW"},{name:"Palestinian Territory, Occupied",code:"PS"},{name:"Panama",code:"PA"},{name:"Papua New Guinea",code:"PG"},{name:"Paraguay",code:"PY"},{name:"Peru",code:"PE"},{name:"Philippines",code:"PH"},{name:"Pitcairn",code:"PN"},{name:"Poland",code:"PL"},{name:"Portugal",code:"PT"},{name:"Puerto Rico",code:"PR"},{name:"Qatar",code:"QA"},{name:"Reunion",code:"RE"},{name:"Romania",code:"RO"},{name:"Russian Federation",code:"RU"},{name:"Rwanda",code:"RW"},{name:"Saint Helena",code:"SH"},{name:"Saint Kitts and Nevis",code:"KN"},{name:"Saint Lucia",code:"LC"},{name:"Saint Pierre and Miquelon",code:"PM"},{name:"Saint Vincent and the Grenadines",code:"VC"},{name:"Samoa",code:"WS"},{name:"San Marino",code:"SM"},{name:"Sao Tome and Principe",code:"ST"},{name:"Saudi Arabia",code:"SA"},{name:"Senegal",code:"SN"},{name:"Serbia and Montenegro",code:"CS"},{name:"Seychelles",code:"SC"},{name:"Sierra Leone",code:"SL"},{name:"Singapore",code:"SG"},{name:"Slovakia",code:"SK"},{name:"Slovenia",code:"SI"},{name:"Solomon Islands",code:"SB"},{name:"Somalia",code:"SO"},{name:"South Africa",code:"ZA"},{name:"South Georgia and the South Sandwich Islands",code:"GS"},{name:"Spain",code:"ES"},{name:"Sri Lanka",code:"LK"},{name:"Sudan",code:"SD"},{name:"Suriname",code:"SR"},{name:"Svalbard and Jan Mayen",code:"SJ"},{name:"Swaziland",code:"SZ"},{name:"Sweden",code:"SE"},{name:"Switzerland",code:"CH"},{name:"Syrian Arab Republic",code:"SY"},{name:"Taiwan, Province of China",code:"TW"},{name:"Tajikistan",code:"TJ"},{name:"Tanzania, United Republic of",code:"TZ"},{name:"Thailand",code:"TH"},{name:"Timor-Leste",code:"TL"},{name:"Togo",code:"TG"},{name:"Tokelau",code:"TK"},{name:"Tonga",code:"TO"},{name:"Trinidad and Tobago",code:"TT"},{name:"Tunisia",code:"TN"},{name:"Turkey",code:"TR"},{name:"Turkmenistan",code:"TM"},{name:"Turks and Caicos Islands",code:"TC"},{name:"Tuvalu",code:"TV"},{name:"Uganda",code:"UG"},{name:"Ukraine",code:"UA"},{name:"United Arab Emirates",code:"AE"},{name:"United Kingdom",code:"GB"},{name:"United States",code:"US"},{name:"United States Minor Outlying Islands",code:"UM"},{name:"Uruguay",code:"UY"},{name:"Uzbekistan",code:"UZ"},{name:"Vanuatu",code:"VU"},{name:"Venezuela",code:"VE"},{name:"Vietnam",code:"VN"},{name:"Virgin Islands, British",code:"VG"},{name:"Virgin Islands, U.S.",code:"VI"},{name:"Wallis and Futuna",code:"WF"},{name:"Western Sahara",code:"EH"},{name:"Yemen",code:"YE"},{name:"Zambia",code:"ZM"},{name:"Zimbabwe",code:"ZW"}]}]),angular.module("myApp").controller("indexController",["$http","$scope","$state","SessionService","getDataSource","$rootScope",function(e,t,a,n,i,o){e.get("../config/menus.json").success(function(e){t.backIndexUrl="../html/index.html";var a=_.sortBy(e,function(e){return e.order});angular.forEach(a,function(e){e.submenus=_.sortBy(e.submenus,function(e){return e.order});var t=0;angular.forEach(e.submenus,function(e){var a=!1;angular.forEach(o.user.permissionDic,function(t){e.permission?t.Name==e.permission&&(a=!0):a=!0}),0==a?e.display=!1:(t++,e.display=!0)}),0==t?e.display=!1:e.display=!0}),t.menus=a}),t.changePlatform=function(e){e.id!=o.user.platformid&&i.getUrlData("../api/RefreshSession",{accountid:o.user.accountId,platformid:e.id},function(e){o.user=e.loginUser;var t=o.appConfig.loginHref,a=_.find(t,{usertype:parseInt(o.user.userType)});location.href="../"+a.href.replace("[domain]",o.user.domain)})},t.logOut=function(){n.Logout()},t.goMenu=function(e,t){angular.forEach(t.submenus,function(e){e.active=!1}),e.active=!0,a.go(e.state,e.parameter)},t.getActiveClass=function(e){var n=!1,i=a.$current.name,o=_.find(t.allMenus,function(e){return e.state==i});o&&o.group==e&&(n=!0)}}]),angular.module("myApp").controller("liveEditController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService","$http","FilesService","$filter",function(e,t,a,n,i,o,r,l,s,c,d,u,m){e.live={},$(function(){$(".clockpicker").clockpicker({"default":"now"})}),e.uploadFiles=function(t){e.files=t},o.id&&(e.nowid=o.id,i.getDataSource("selectLiveById",{id:o.id},function(t){e.live=t[0],e.live.starttime_min=m("date")(e.live.starttime,"HH:mm"),e.live.endtime_min=m("date")(e.live.endtime,"HH:mm"),e.nowfile=u.showFile("livePhoto",e.live.pic_servername,e.live.pic_servername)})),e.saveButtonDisabled=!1,e.save=function(){e.saveButtonDisabled=!0,e.files?u.upLoadPicture(e.files[0],{upcategory:"livePhoto",width:200,height:150},function(t){e.live.pic_servername=t.data[0].servername,f()}):f()};var f=function(){if(o.id){var t=d.post("../api/Live",e.live);t.then(function(t){e.saveButtonDisabled=!1,i.getDataSource("updateLive",e.live,function(e){r({message:"保存成功",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})})})}else{e.live.starttime=c.addMiniuts(e.live.starttime,e.live.starttime_min),e.live.endtime=c.addMiniuts(e.live.endtime,e.live.endtime_min);var t=d.post("../api/Live",e.live);t.then(function(t){e.saveButtonDisabled=!1,e.live.sourceurl=t.data.sourceUrl,e.live.playurl="http://e.vhall.com/"+t.data.id,e.live.vhallid=t.data.id,e.live.id=i.getGUID(),i.getDataSource("insertLive",e.live,function(t){r({message:"保存成功",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),l.go("index.liveEdit",{id:e.live.id})})})}};e.goPlatformEdit=function(){o.id?l.go("index.liveEdit",{id:o.id}):l.go("index.liveEdit")},e.goTabList=function(){var e="index.liveEdit.liverange";l.go(e)}}]),angular.module("myApp").controller("liveListController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService",function(e,t,a,n,i,o,r,l,s,c){var d={pageNumber:1,pageSize:25,sort:null};e.search={},e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()},e["delete"]=function(){var t=e.gridApi.selection.getSelectedRows();i.doArray("delete_sy_LiveById",t,function(t){r({message:"删除成功",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.loadGrid()})},e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"直播名称",width:"64%",field:"name",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.viewLive(row)">{{row.entity.name}}</a></div>',headerCellClass:"mycenter"},{name:"直播开始时间",width:"10%",field:"starttime",cellFilter:"date:'yyyy-MM-dd HH:mm'",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"直播结束时间",width:"10%",field:"endtime",cellFilter:"date:'yyyy-MM-dd HH:mm'",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"主讲人",width:"10%",field:"teachername",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){d.pageNumber=t,d.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)d.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),d.sort=n}e.loadGrid()})}},e.loadGrid=function(){var t=(d.pageNumber-1)*d.pageSize,n=d.pageSize;i.getList("selectLive",{platformid:a.user.platformid},{firstRow:t,pageSize:n},e.search,d.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.viewLive=function(e){l.go("index.liveEdit",{id:e.entity.id})},e.loadGrid()}]),angular.module("myApp").controller("platformLiveRelationController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){e.live={ispublic:!1,forPlatform:[],forSyClass:[]},e.ChangePublic=function(){e.live.ispublic},e.initTable=function(){l.getDataSource("getPlatformLiveRelation",{liveid:i.id},function(t){e.gridOptions.data=t})},e.load=function(){l.getDataSource(["selectPlatformList","selectSyClassList"],{},function(t){e.live.platformList=_.find(t,{name:"selectPlatformList"}).data,e.live.classList=_.find(t,{name:"selectSyClassList"}).data}),e.initTable()},e.load(),e.gridOptions={useExternalPagination:!0,data:[],columnDefs:[{name:"直播范围",field:"name"},{name:"限制类型",field:"category"}],onRegisterApi:function(t){e.gridApi=t}},e.delPlatformLiveRelation=function(){var a=e.gridApi.selection.getSelectedRows();l.doArray("deletePlatformLiveRelation",a,function(a){e.load(),e.initTable(),o({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(e){o({message:"删除失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})},e.addPlatformLiveRelation=function(){e.live.ispublic?l.getDataSource("deletePlatformLiveRelationByLiveId",{liveid:i.id},function(t){l.getDataSource("insertPlatformLiveRelation",{liveid2:i.id,eventid2:"2",liveid:i.id,eventid:"2",category:2},function(t){e.initTable()})},function(e){}):(angular.forEach(e.live.forPlatform,function(e){e.liveid=i.id,e.liveid2=i.id,e.eventid=e.id,e.eventid2=e.id,e.category=1}),angular.forEach(e.live.forSyClass,function(e){e.liveid=i.id,e.liveid2=i.id,e.eventid=e.id,e.eventid2=e.id,e.category=0}),l.getDataSource("deletePlatformPublicLiveRelationByLiveId",{liveid:i.id},function(t){e.live.forPlatform.length>0&&l.doArray("insertPlatformLiveRelation",e.live.forPlatform,function(t){angular.forEach(e.live.forPlatform,function(t){_.remove(e.live.platformList,{id:t.id})}),e.live.forPlatform=[],e.initTable()}),e.live.forSyClass.length>0&&l.doArray("insertPlatformLiveRelation",e.live.forSyClass,function(t){angular.forEach(e.live.forSyClass,function(t){_.remove(e.live.classList,{id:t.id})}),e.live.forSyClass=[],e.initTable()})},function(e){}))}}]),app.controller("logconfigController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){var s={pageNumber:1,pageSize:25,sort:null};e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,useExternalPagination:!0,data:[],columnDefs:[{name:"编码",field:"code"},{name:"名称",field:"name"},{name:"状态",field:"status"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){s.pageNumber=t,s.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)s.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),s.sort=n}e.loadGrid()})}},e.search={},e.loadGrid=function(){var a=(s.pageNumber-1)*s.pageSize,n=s.pageSize,i=["selectLogConfig"];l.getConnKeyList(i,{platformid:t.user.platformid,tablerule:new Date},{firstRow:a,pageSize:n},e.search,s.sort,{connectionKey:"LogConnectionString"},function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data},function(e){})},e.loadGrid(),e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()}}]),angular.module("myApp").controller("logconfigEditController",["$scope","$rootScope","getDataSource","$stateParams","notify","FilesService","$state",function(e,t,a,n,i,o,r){e.goToList=function(){r.go("index.score")}}]),angular.module("myApp").controller("logconfigtreeController",["$scope","$rootScope","$state","$http","$timeout","$document","notify","getDataSource","DateService","CommonService",function(e,t,a,n,i,o,r,l,s,c){function d(a){l.getConnKeyList(["updateLogConfig"],a,null,null,null,{connectionKey:"LogConnectionString"},function(a){e.saveCurrentButtonDisabled=!1,a.length>0?(r({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.my_data=[],e.loadCategoryTree()):r({message:a.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})},function(t){e.saveCurrentButtonDisabled=!1})}function u(a){var n=["insertLogConfig"];l.getConnKeyList(n,a,null,null,null,{connectionKey:"LogConnectionString"},function(a){e.saveButtonDisabled=!1,a.length>0?(r({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.my_data=[],p=0,e.loadCategoryTree()):r({message:a.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})},function(t){e.saveButtonDisabled=!1})}function m(e,t,a){var n={label:a.name,rowid:a.id,children:[]},i=_.filter(t,{fid:a.id}),o=i.length;if(o>0)for(var r=0;o>r;r++)m(n,t,i[r]);e.children.push(n)}var f,p=0;e.parentDisabled=!1,e.nameDisabled=!1,e.childnameDisabled=!1,e.saveCurrentButtonDisabled=!1,e.saveButtonDisabled=!1,e.deleteDisabled=!1,e.my_tree_handler=function(t){e.output="","0"==t.rowid?(e.parentDisabled=!0,e.nameDisabled=!0,e.saveCurrentButtonDisabled=!0,e.deleteDisabled=!0):(e.parentDisabled=!1,e.nameDisabled=!1,e.saveCurrentButtonDisabled=!1,e.deleteDisabled=!1),e.loadPushMessageCategoryParent(t)},e.loadPushMessageCategoryParent=function(t){p=t.rowid;var a=["select_logconfigParent"];l.getConnKeyList(a,{},null,null,null,{connectionKey:"LogConnectionString"},function(t){e.parentCategory=t,e.parentCategory.push({id:"",fid:"0",name:""}),""!=p&&void 0!=p&&null!=p&&l.getConnKeyList(["getLogConfigById"],{id:p},null,null,null,{connectionKey:"LogConnectionString"},function(t){e.categoryForm=t[0]},function(e){})},function(e){})},e.deletePushMessageCategory=function(){e.deleteDisabled=!0,l.getConnKeyList(["getLogConfigChildrenByFId"],{fid:p},null,null,null,{connectionKey:"LogConnectionString"},function(a){var n=a.length;0>=n?l.getConnKeyList(["deleteLogConfig"],{id:p},null,null,null,{connectionKey:"LogConnectionString"},function(a){a.length>0?(r({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.my_data=[],e.deleteDisabled=!0,e.loadCategoryTree()):(e.deleteDisabled=!1,r({message:a.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl}))},function(e){}):(r({message:"删除失败，请先删除分类下子分类。",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.deleteDisabled=!1)},function(e){})},e.checkCode=function(){var a={id:p,code:e.categoryForm.code};l.getConnKeyList(["selectLogConfigCode"],a,null,null,null,{connectionKey:"LogConnectionString"},function(a){a.length>0?(r({message:"编码已经存在",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.saveCurrentButtonDisabled=!0):e.saveCurrentButtonDisabled=!1},function(e){})},e.saveCurrentPushMessageCategory=function(){e.saveCurrentButtonDisabled=!0;l.getGUID();if(void 0!=p&&"0"!=p&&void 0!=p&&null!=p){var t=_.find(e.parentCategory,{id:e.categoryForm.fid}),a="";a=null!=t?t.id+"."+p:p;var n={id:p,fid:e.categoryForm.fid,code:e.categoryForm.code,name:e.categoryForm.name,sortnum:e.categoryForm.sortnum,fids:a};d(n)}},e.savePushMessageCategory=function(){e.saveButtonDisabled=!0;var t=l.getGUID(),a=_.find(e.parentCategory,{id:e.categoryForm.fid}),n="";n=null!=a?a.id+"."+t:t;var i=p;void 0!=i&&"0"!=i||(i="0");var o={id:t,fid:i,name:e.categoryForm.childname,code:e.categoryForm.code,sortnum:e.categoryForm.sortnum,fids:n};u(o)},e.my_data=new Array,e.my_tree=f={},e.loadCategoryTree=function(){var t=["select_logconfigParent"];l.getConnKeyList(t,{},null,null,null,{connectionKey:"LogConnectionString"},function(t){var a=t.length,n=new Object;n.label="日志分类",n.rowid="0",n.children=new Array;for(var i=0;a>i;i++)"0"==t[i].fid&&m(n,t,t[i]);e.my_data.push(n),e.doing_async=!1},function(e){})},e.try_async_load=function(){e.my_data=new Array,e.doing_async=!0,e.loadCategoryTree()},e.try_async_load()}]),app.controller("loginController",["$scope","$http","$state","$stateParams","getDataSource",function(e,t,a,n,i){e.loginObj=new Object,e.AccessLogin=function(){return 0==e.loginObj.logname.length?(alert("请输入用户名"),!1):0==e.loginObj.hashpwd.length?(alert("请输入密码"),!1):(e.loginObj.remember,void i.getUrlData("../api/login",e.loginObj,function(e){},function(e){}))},e.GetUser=function(){i.getUrlData("../api/getuser",{userid:111},function(e){},function(e){})},e.Logout=function(){i.getUrlData("../api/logout",{userid:111},function(e){},function(e){})}}]),app.controller("mainController",["$scope","$rootScope","$http","getDataSource",function(e,t,a,n){}]),angular.module("myApp").controller("senselearningEditController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){e.senselearningObj=new Object;var s=i.id;e.loadData=function(){l.getDataSource(["getClasscourseLearningsense"],{id:s},function(t){e.senselearningObj=t[0]},function(e){})},e.loadData()}]),app.controller("senseoflearningController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"标题",field:"title",width:"25%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.title}}</a></div>'},{name:"班级",field:"classname",width:"25%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"学员",field:"stuname",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"推荐人",field:"recommenduser",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"推荐时间",field:"recommendtime",width:"13%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"平台",field:"platformname",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"操作",field:"id",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><button  ng-if="row.entity.auditstatus==0" ng-click="grid.appScope.doRecommendFlatform(row,1)">审核</button></div>'}]},e.gridOptionsRecommend={paginationPageSizes:[25,50,75],paginationPageSize:25,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"标题",field:"title",width:"25%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.title}}</a></div>'},{name:"班级",field:"classname",width:"25%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"学员",field:"stuname",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"推荐人",field:"recommenduser",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"推荐时间",field:"recommendtime",width:"13%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"审核人",field:"audituser",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"审核时间",field:"audittime",width:"13%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"平台",field:"platformname",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"操作",field:"id",width:"20%",cellClass:"myleft",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><button  ng-if="row.entity.auditstatus==1" ng-click="grid.appScope.doRecommendFlatform(row,0)">取消审核</button>&nbsp;&nbsp;<button ng-click="grid.appScope.doCancelRecommendFlatform(row)" ng-if="row.entity.recommendstatus>=2 && row.entity.count > 0">取消推荐</button><button ng-click="grid.appScope.doRecommendGeneralFlatform(row)" ng-if="row.entity.category==0 && row.entity.count==0">推荐到总平台</button></div>'}]},e.gridOptionsSubplatform={paginationPageSizes:[25,50,75],paginationPageSize:25,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"标题",field:"title",width:"25%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.title}}</a></div>'},{name:"班级",field:"classname",width:"25%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"学员",field:"studentname",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"推荐人",field:"recommenduser",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"推荐时间",field:"recommendtime",width:"13%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"审核人",field:"audituser",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"审核时间",field:"audittime",width:"13%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"推荐平台",field:"platformname",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"操作",field:"id",width:"20%",cellClass:"myleft",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><button  ng-if="row.entity.auditstatus==1" ng-click="grid.appScope.doAuditSubplatform(row,2)">审核通过</button>&nbsp;&nbsp;<button ng-click="grid.appScope.doAuditSubplatform(row,1)" ng-if="row.entity.auditstatus==2">取消审核</button><button ng-click="grid.appScope.doCancelRecommendSubplatform(row)" ng-if="row.entity.auditstatus==1">忽略推荐</button></div>'}]},e.goDetial=function(e){r.go("index.senselearningedit",{id:e.entity.id})},e.doRecommendFlatform=function(a,n){var i=new Object;i.category="learningsense",i.op=n,i.tableid=a.entity.id,i.platformid=t.user.platformid,1==n&&(i.AuditUser=t.user.name),l.getUrlData("../api/Platform/RecommendPush",i,function(a){if("success"==a.code){var i="审核成功";0==n&&(i="取消审核成功"),e.loadData(),o({message:i,classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})}else{var i="审核失败";0==n&&(i="取消审核失败"),o({message:i,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})}},function(e){o({message:"操作失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})},e.doRecommendGeneralFlatform=function(a){var n=new Object;n.platformid=t.user.platformid,n.eventid=a.entity.id,l.getUrlData("../api/dorecommendgeneralflatform",n,function(a){a.result&&e.loadData(),o({message:a.message,classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(e){o({message:"操作失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})},e.doCancelRecommendFlatform=function(a){var n={};n.platformid=t.user.platformid,n.eventid=a.entity.id,n.canceltype="1",l.getUrlData("../api/docancelrecommendflatform",n,function(a){a.result&&e.loadData(),o({message:a.message,classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(e){o({message:"操作失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})},e.doAuditSubplatform=function(a,n){var i={};i.id=a.entity.id,i.status=n;var r="";2==n?(r="back_AuditPassSubplatformRecommend",i.audituser=t.user.name):r="back_AuditUnPassSubplatformRecommend",l.getDataSource(r,i,function(a){if(a[0]&&a[0].crow>0){e.loadData();var i=2==n?"审批成功":"取消审核成功";o({message:i,classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})}},function(e){o({message:"操作失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})},e.doCancelRecommendSubplatform=function(a){var n={};n.id=a.entity.id,l.getDataSource("doCancelRecommendSubplatform",n,function(a){a[0]&&a[0].crow>0&&(e.loadData(),o({message:"忽略成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}))},function(e){o({message:"操作失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})},e.loadData=function(){var a={};a.platformid1=t.user.platformid,a.platformid2=t.user.platformid,a.platformid3=t.user.platformid,l.getDataSource(["getWaiteRecommendLearningSense","getRecommendLearningSense","getAuditSubplatformLearningSense"],a,function(t){t.length>0&&(e.gridOptions.data=_.find(t,{name:"getWaiteRecommendLearningSense"}).data,e.gridOptionsRecommend.data=_.find(t,{name:"getRecommendLearningSense"}).data,e.gridOptionsSubplatform.data=_.find(t,{name:"getAuditSubplatformLearningSense"}).data)},function(e){})},e.loadData()}]),app.controller("studynoteController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"标题",field:"title",width:"25%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.title}}</a></div>'},{name:"班级",field:"classname",width:"25%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"学员",field:"stuname",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"推荐人",field:"recommenduser",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"推荐时间",field:"recommendtime",width:"13%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"平台",field:"platformname",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"操作",field:"id",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><button  ng-if="row.entity.auditstatus==0" ng-click="grid.appScope.doRecommendFlatform(row,1)">审核</button></div>'}]},e.gridOptionsRecommend={paginationPageSizes:[25,50,75],paginationPageSize:25,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"标题",field:"title",width:"25%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.title}}</a></div>'},{name:"班级",field:"classname",width:"25%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"学员",field:"stuname",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"推荐人",field:"recommenduser",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"推荐时间",field:"recommendtime",width:"13%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"审核人",field:"audituser",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"审核时间",field:"audittime",width:"13%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"平台",field:"platformname",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"操作",field:"id",width:"20%",cellClass:"myleft",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><button ng-if="row.entity.auditstatus==1" ng-click="grid.appScope.doRecommendFlatform(row,0)">取消审核</button>&nbsp;&nbsp;<button ng-click="grid.appScope.doRecommendGeneralFlatform(row)" ng-if="row.entity.category==0 && row.entity.count==0">推荐到总平台</button></div>'}],onRegisterApi:function(t){e.gridApi=t}},e.gridOptionsSubplatform={paginationPageSizes:[25,50,75],paginationPageSize:25,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"标题",field:"title",width:"25%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.title}}</a></div>'},{name:"班级",field:"classname",width:"25%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"学员",field:"studentname",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"推荐人",field:"recommenduser",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"推荐时间",field:"recommendtime",width:"13%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"审核人",field:"audituser",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"审核时间",field:"audittime",width:"13%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"推荐平台",field:"platformname",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"操作",field:"id",width:"20%",cellClass:"myleft",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><button  ng-if="row.entity.auditstatus==1" ng-click="grid.appScope.doAuditSubplatform(row,2)">审核通过</button>&nbsp;&nbsp;<button ng-click="grid.appScope.doAuditSubplatform(row,1)" ng-if="row.entity.auditstatus==2">取消审核</button><button ng-click="grid.appScope.doCancelRecommendSubplatform(row)" ng-if="row.entity.auditstatus==1">忽略推荐</button></div>'}]},e.goDetial=function(e){r.go("index.studynoteedit",{id:e.entity.id})},e.doRecommendFlatform=function(a,n){var i=new Object;i.category="studyingsense",i.op=n,i.tableid=a.entity.id,1==n&&(i.AuditUser=t.user.name),l.getUrlData("../api/Platform/RecommendPush",i,function(a){if("success"==a.code){var i="审核成功";0==n&&(i="取消审核成功"),e.loadData(),o({message:i,classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})}else{var i="审核失败";0==n&&(i="取消审核失败"),o({message:i,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})}},function(e){o({message:"操作失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})},e.doRecommendGeneralFlatform=function(a){var n=new Object;n.platformid=t.user.platformid,n.eventid=a.entity.id,l.getUrlData("../api/dorecommendgeneralflatform",n,function(a){a.result&&e.loadData(),o({message:a.message,classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(e){o({message:"操作失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})},e.doCancelRecommendFlatform=function(a){var n={};n.platformid=t.user.platformid,n.eventid=a.entity.id,n.canceltype="0",l.getUrlData("../api/docancelrecommendflatform",n,function(a){a.result&&e.loadData(),o({message:a.message,classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(e){
o({message:"操作失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})},e.doAuditSubplatform=function(a,n){var i={};i.id=a.entity.id,i.status=n;var r="";2==n?(r="back_AuditPassSubplatformRecommend",i.audituser=t.user.name):r="back_AuditUnPassSubplatformRecommend",l.getDataSource(r,i,function(a){if(a[0]&&a[0].crow>0){e.loadData();var i=2==n?"审批成功":"取消审核成功";o({message:i,classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})}},function(e){o({message:"操作失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})},e.doCancelRecommendSubplatform=function(a){var n={};n.id=a.entity.id,l.getDataSource("doCancelRecommendSubplatform",n,function(a){a[0]&&a[0].crow>0&&(e.loadData(),o({message:"忽略成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}))},function(e){o({message:"操作失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})},e.loadData=function(){var a={};a.platformid1=t.user.platformid,a.platformid2=t.user.platformid,a.platformid3=t.user.platformid,l.getDataSource(["getWaiteRecommendStudyNote","getRecommendStudyNote","getAuditSubplatformStudyNote"],a,function(t){t.length>0&&(e.gridOptions.data=_.find(t,{name:"getWaiteRecommendStudyNote"}).data,e.gridOptionsRecommend.data=_.find(t,{name:"getRecommendStudyNote"}).data,e.gridOptionsSubplatform.data=_.find(t,{name:"getAuditSubplatformStudyNote"}).data)},function(e){})},e.loadData()}]),angular.module("myApp").controller("studynoteEditController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){e.studynoteObj=new Object;var s=i.id;e.loadData=function(){l.getDataSource(["getStudyingsense"],{id:s},function(t){e.studynoteObj=t[0]},function(e){})},e.loadData()}]),angular.module("myApp").controller("managerController",["$rootScope","$scope","getDataSource","$state","$stateParams","notify","$modal","FilesService","DateService","$timeout","Base64",function(e,t,a,n,i,o,r,l,s,c,d){t.search={},t.search_admin={},t.haschild=!1;var u={pageNumber:1,pageSize:25,sort:null};t.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,multiSelect:!1,data:[],columnDefs:[{name:"序号",field:"rownum",width:"7%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"用户",field:"name",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"登录名",field:"logname",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"职级",field:"rank",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"部门",field:"departmentname",width:"30%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"分级管理员",field:"usertype",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.usertype == 1 ? "是" :"否"}}</div>'}],onRegisterApi:function(e){t.gridApi=e,e.pagination.on.paginationChanged(t,function(e,a){u.pageNumber=e,u.pageSize=a,t.loadGrid()}),e.core.on.sortChanged(t,function(e,a){if(0==a.length)u.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),u.sort=n}t.loadGrid()})}},t.goSearch=function(e){e?1==e?(t.gridOptionsAdmin.totalItems=0,t.gridOptionsAdmin.data=[],t.gridOptionsAdmin.paginationCurrentPage=1,t.loadGridAdmin()):2==e&&(t.gridOptions.totalItems=0,t.gridOptions.data=[],t.gridOptions.paginationCurrentPage=1,t.loadGrid()):(t.gridOptionsAdmin.totalItems=0,t.gridOptionsAdmin.data=[],t.gridOptionsAdmin.paginationCurrentPage=1,t.loadGridAdmin(),t.gridOptions.totalItems=0,t.gridOptions.data=[],t.gridOptions.paginationCurrentPage=1,t.loadGrid())},t.departmentnode={},t.loadGrid=function(){if(""!=t.departmentid){var e=(u.pageNumber-1)*u.pageSize,n=u.pageSize;a.getList("getAllUserByDepartmentId",{pids:t.departmentnode.pids,departmentid:t.departmentnode.id},{firstRow:e,pageSize:n},t.search,u.sort,function(e){t.gridOptions.totalItems=e[0].allRowCount,t.gridOptions.data=e[0].data})}},t.addAdmin=function(){t.addAdminInfo={logname:"",password:""},t.modalInstance=r.open({templateUrl:"addAdmin.html",size:"md",scope:t})},t.close=function(){t.modalInstance.dismiss("cancel")},t.saveUser=function(){confirm("确定要将用户保存在该机构下面吗？")&&a.getUrlData("../api/InsertAccount",{logname:t.addAdminInfo.logname,pwd:d.encode(t.addAdminInfo.password),departmentid:t.departmentid,departmentname:t.departmentname},function(a){a.result?(t.loadGrid(),o({message:a.message,classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.close()):o({message:a.message,classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})},function(e){})},t.gridOptionsAdmin={data:[],multiSelect:!1,columnDefs:[{name:"序号",field:"rownum",width:"7%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"用户",field:"name",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"登录名",field:"logname",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"职级",field:"rank",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"部门",field:"departmentname",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"分管部门",field:"mdepartmentname",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(e){t.gridApiAdmin=e}},t.loadGridAdmin=function(){""!=t.departmentid&&a.getList("getAdminUserByDepartmentId",{pids:t.departmentnode.pids,departmentid:t.departmentnode.id},{firstRow:0,pageSize:100},t.search_admin,u.sort,function(e){t.gridOptionsAdmin.totalItems=e[0].allRowCount,t.gridOptionsAdmin.data=e[0].data})},c(function(){t.loadGridAdmin()},1e3),c(function(){t.loadGrid()},2e3),t.setAdminAttr={isOpen:!1,departmentId:"",departmentName:"",isSaving:!1,change:function(e){if(this.isOpen=e,this.departmentId="",this.isSaving=!1,e){var t=$.fn.zTree.getZTreeObj("treeDemo_admin"),a=t.getNodes();a.length>0&&t.expandNode(a[0],!0,!1,!0)}else $.fn.zTree.getZTreeObj("treeDemo_admin").expandAll(!1)}},t.setAdmin=function(){var a=t.gridApi.selection.getSelectedRows();if(null!=a&&void 0!=a&&a.length>0){if("1"==a[0].usertype)return void o({message:"设置失败，该用户已经是管理员了",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl});t.setAdminAttr.change(!0)}},t.saveSetAdmin=function(n){t.setAdminAttr.isSaving=!0;var i=t.gridApi.selection.getSelectedRows();if(null!=i&&void 0!=i&&i.length>0){var r="设置管理员";a.getDataSource(["insert_sy_account_roles","updateUserTypeById"],{accountid:i[0].accountid,userid:i[0].id,createuser:e.user.name,usertype:1,departmentid:t.setAdminAttr.departmentId,departmentname:t.setAdminAttr.departmentName,accountid2:i[0].accountid},function(a){o({message:r+"成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.setAdminAttr.change(!1),t.setAdminAttr.isSaving=!1,t.loadGrid(),t.loadGridAdmin()},function(t){o({message:r+"失败",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})})}},t.cacelAdmin=function(){var n=t.gridApiAdmin.selection.getSelectedRows();if(null!=n&&void 0!=n&&n.length>0){var i="取消管理员";a.getUrlData("../api/cancerMananger",{accountid:n[0].accountid,userid:n[0].id,usertype:0,departmentid:n[0].mdepartmentid},function(a){a.code?(o({message:i+"成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadGrid(),t.loadGridAdmin()):o({message:i+"失败",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})},function(t){o({message:i+"失败",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl})})}},t.treeSetting_admin={view:{dblClickExpand:!1,expandSpeed:"slow"},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pid"}},callback:{beforeClick:function(){},onClick:function(e,a,n){var i=$.fn.zTree.getZTreeObj("treeDemo_admin"),o=i.getSelectedNodes();o.length>0&&c(function(){t.setAdminAttr.departmentId=o[0].id,t.setAdminAttr.departmentName=o[0].name},10)},onDblClick:function(e,a,n){var i=$.fn.zTree.getZTreeObj("treeDemo_admin"),o=i.getSelectedNodes();o.length>0&&c(function(){t.setAdminAttr.departmentId=o[0].id,t.saveSetAdmin()},10)}}},t.getDepartmentArr=function(){c(function(){a.getDepartmentAdmin(function(e){t.treeData=e,$.fn.zTree.init($("#treeDemo_admin"),t.treeSetting_admin,t.treeData)},function(e){})},3e3)}()}]),angular.module("myApp").controller("microVideoController",["$scope","$rootScope","getDataSource","$state","notify",function(e,t,a,n,i){var o={pageNumber:1,pageSize:25,sort:null};e.search={},e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"序号",width:"6%",field:"rownum",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"微视频名称",width:"30%",field:"name",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.name}}</a></div>',headerCellClass:"mycenter"},{name:"主讲人",width:"8%",field:"teacher",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"分类",width:"8%",field:"category",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建人",width:"8%",field:"createuser",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建时间",width:"8%",field:"createtime",cellFilter:"date:'yyyy-MM-dd'",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"是否可用",width:"8%",field:"status",cellFilter:"statusGender",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"是否推荐",width:"8%",field:"ismain",cellFilter:"istopGender",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"点击次数",width:"8%",field:"clickrate",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(a){e.gridApi=a,a.pagination.on.paginationChanged(e,function(t,a){o.pageNumber=t,o.pageSize=a,e.loadGrid()}),a.core.on.sortChanged(e,function(t,a){if(0==a.length)o.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),o.sort=n}e.loadGrid()}),a.selection.on.rowSelectionChanged(e,function(e){"row selected "+e.isSelected;e.entity.isshare&&(e.isSelected=!1,i({message:"该视频为共享资源，不能被操作。",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}))})}},e.goDetial=function(e){n.go("index.microVideoEdit",{id:e.entity.id})},e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()},e["delete"]=function(){var n=e.gridApi.selection.getSelectedRows();a.doArray("delete_sy_microVideoById",n,function(a){i({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadGrid()})},e.loadGrid=function(){var n=(o.pageNumber-1)*o.pageSize,i=o.pageSize,r="selectAllMicroVideo";0==t.user.platformcategory&&(r="selectPlatformAllMicroVideo"),a.getList(r,{},{firstRow:n,pageSize:i},e.search,o.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadGrid()}]),angular.module("myApp").controller("microVideoEditController",["$window","$scope","$rootScope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","FilesService","CommonService",function(e,t,a,n,a,i,o,r,l,s,c,d){t.saveButtonDisabled=!1,t.microVideo={},t.uploadvideoFiles=function(e,a){t.microVideo.videofile=e},t.uploadFiles=function(e){t.files=e},t.saveIsShareButtonDisabled=!1,r.id&&o.getDataSource("select_sy_microVideoById",{id:r.id},function(e){t.microVideo=e[0],t.nowfile=c.showFile("coursewarePhoto",t.microVideo.photo_servername,t.microVideo.photo_servername),1==t.microVideo.isshare&&(t.saveIsShareButtonDisabled=!0,d.initInputControlDisabled())}),t.uploadvideo=function(){if(t.microVideo.videofile.length>0){var e=/(?:\.([^.]+))?$/,n=e.exec(t.microVideo.videofile.name)[1],i=(new Date).getTime(),o=md5(i+a.appConfig.vhallConfig.writeToken),r={endpoint:a.appConfig.vhallConfig.uploadPath,resetBefore:$("#reset_before").prop("checked"),resetAfter:!1,title:"title",desc:"desc",ext:n,ts:i,hash:o,userid:a.appConfig.vhallConfig.userid,writeToken:a.appConfig.vhallConfig.writeToken};$(".progress").addClass("active"),upload=polyv.upload(t.microVideo.videofile[0],r).fail(function(e){alert("Failed because: "+e)}).always(function(){}).progress(function(e,a,n){var i=(a/n*100).toFixed(2);t.process=i,t.$apply()}).done(function(e,a){t.microVideo.videoname=a.name,t.microVideo.videopath=e.substring(e.lastIndexOf("/")+1)})}},t.close=function(){t.modalInstance.dismiss("cancel")},t.openVideoPerview=function(){t.modalInstance=n.open({templateUrl:"videoPerview.html",size:"lg",scope:t,resolve:{items:function(){return t.items}}}),i(function(){player=polyvObject("#divVideo").videoPlayer({width:"850",height:"490",vid:t.microVideo.videopath})},0)},t.goback=function(){s.go("index.microVideo")},t.save=function(){t.files?c.upLoadPicture(t.files[0],{upcategory:"coursewarePhoto",width:310,height:190},function(e){t.microVideo.photo_servername=e.data[0].servername,u()}):u()};var u=function(){t.saveButtonDisabled=!0,r.id?o.getDataSource("update_sy_microVideo",t.microVideo,function(e){t.saveButtonDisabled=!1,l({message:"保存成功",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(e){t.saveButtonDisabled=!1}):(t.microVideo.createtime=new Date,t.microVideo.id=o.getGUID(),t.microVideo.createuser=a.user.name,t.microVideo.platformid=a.user.platformid,t.microVideo.microvideoid=t.microVideo.id,t.microVideo.isshare=0,o.getDataSource(["insert_sy_microVideo"],t.microVideo,function(e){t.saveButtonDisabled=!1,s.go("index.microVideoEdit",{id:t.microVideo.id}),l({message:"保存成功",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(e){t.saveButtonDisabled=!1}))}}]),angular.module("myApp").controller("newsController",["$scope","$rootScope","getDataSource","$state","notify","$timeout","$modal",function(e,t,a,n,i,o,r){var l={pageNumber:1,pageSize:25,sort:null};e.search={},e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,multiSelect:!1,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"新闻类型",field:"category",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"newsCategoryFilter"},{name:"标题",field:"title",width:"25%",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.title}}</a></div>',headerCellClass:"mycenter"},{name:"创建人",field:"createname",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建机构",field:"name",width:"13%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建时间",field:"createtime",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"发布时间",field:"publishtime",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"发布范围",field:"ispublic",width:"8%",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.status == "已发布" ? (row.entity.ispublic == 1 ?"全部机构":"部分机构"):""}}</div>',headerCellClass:"mycenter"},{name:"状态",field:"status",width:"8%",cellClass:function(e,t,a,n,i){return"已发布"===e.getCellValue(t,a)?"blue":void 0},cellClass:"mycenter",headerCellClass:"mycenter"},{name:"是否置顶",field:"istop",width:"7%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"操作",field:"id",width:"9%",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-href="../html/index.html#/main/news/{{row.entity.id}}" target="_blank">预览</a></div>',cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){l.pageNumber=t,l.pageSize=a,e.loadSource()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)l.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),l.sort=n}e.loadSource()})}},e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadSource(1)},e.searchdepartmentid="",e.loadSource=function(n){if(0==n){var i=t.user.mdepartmentId;2==t.user.usertype&&(i=t.user.departmentId),e.searchdepartmentid=i}var o=(l.pageNumber-1)*l.pageSize,r=l.pageSize;a.getList("selectAllNews-listall",{accountid:t.user.accountId,departmentid:e.searchdepartmentid},{firstRow:o,pageSize:r},e.search,l.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadSource(0),e.goDetial=function(e){n.go("index.newsEdit",{id:e.entity.id})},e["delete"]=function(){var n=e.gridApi.selection.getSelectedRows();null!=n&&void 0!=n&&n.length>0&&a.doArray("deleteNewsById",n,function(a){i({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadSource()})},e.alert=function(e){i({message:e,classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},e.publish=function(){var a=e.gridApi.selection.getSelectedRows();if(null!=a&&void 0!=a&&a.length>0){if("已发布"==a[0].status)return void i({message:"不能重复发布",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl});r.open({animation:!1,templateUrl:"publish.html",controller:"publishCtrl",size:"lg",resolve:{alldepartment:function(){return e.alldepartment},gridApi:function(){return e.gridApi},loadSource:function(){return e.loadSource},alert:function(){return e.alert}}})}},e.recommend=function(){var n=e.gridApi.selection.getSelectedRows();null!=n&&void 0!=n&&n.length>0&&a.doArray("updateNewsRecommend",n,function(a){i({message:"置顶成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadSource()})},e.unrecommend=function(){var n=e.gridApi.selection.getSelectedRows();null!=n&&void 0!=n&&n.length>0&&a.doArray("updateNewsCancelRecommend",n,function(a){i({message:"撤销置顶成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadSource()})},e.unpublishnews=function(){var t=e.gridApi.selection.getSelectedRows();null!=t&&void 0!=t&&t.length>0?a.getDataSource("delete_sy_news_relation",{newsid:t[0].id},function(n){a.doArray("updateNewsCancelPublish",t,function(t){alert("撤销发布成功"),e.loadSource()})},function(e){alert("撤销发布失败")}):alert("请选择要撤销发布的数据")},e.alldepartment=[],e.getDepartmentArr=function(){a.getDepartmentAdmin(function(a){2==t.user.usertype&&angular.forEach(a,function(e){"100000"==e.id?e.nocheck=1:e.nocheck=0}),e.alldepartment=a},function(e){})}()}]).filter("topFilters",function(){var e={0:"未置顶",1:"已置顶"};return function(t){return t?e[t]:"未置顶"}}),app.controller("publishCtrl",["$rootScope","$scope","$http","$timeout","$modalInstance","getDataSource","SessionService","DateService","alldepartment","gridApi","loadSource","alert",function(e,t,a,n,i,o,r,l,s,c,d,u){t.ispublic=2==e.user.usertype?1:0,t.saveTitle="发布",t.department=[],t.saveDisabled=!1,t.loadSource=d,t.gridApi=c;var m=function(e,a){var n=e.id;a?_.filter(t.department,function(e){return e.departmentId==n}).length<=0&&t.department.push({departmentId:n,departmentName:e.name}):_.remove(t.department,function(e){return e.departmentId==n}),e.children&&e.children.length>0&&angular.forEach(e.children,function(e){m(e,a)})};t.treeSetting={view:{dblClickExpand:!1,expandSpeed:"slow"},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pid"}},check:{enable:!0,chkStyle:"checkbox",chkboxType:{Y:"s",N:"s"}},callback:{onCheck:function(e,t,a){n(function(){m(a,a.checked)},1e3)}}},t.saveDisabled=!1,t.saveTitle="发布",t.treeData=s,n(function(){$.fn.zTree.init($("#treeDemo_admin"),t.treeSetting,t.treeData);var e=$.fn.zTree.getZTreeObj("treeDemo_admin"),a=e.getNodes();a.length>0&&e.expandNode(a[0],!0,!1,!0)},200),t.cancel=function(){i.dismiss("cancel"),0==t.ispublic&&$.fn.zTree.getZTreeObj("treeDemo_admin").expandAll(!1)},t.publishnews=function(){var e=t.gridApi.selection.getSelectedRows();if(null!=e&&void 0!=e&&e.length>0)if(t.saveDisabled=!0,t.saveTitle="发布中...",0==t.ispublic){if(t.department.length<=0)return void u("请选择要发布的机构");var a=[];angular.forEach(t.department,function(t){a.push({id:o.getGUID(),newsid:e[0].id,sourceid:t.departmentId,type:0})}),o.getUrlData("../api/batchInsertNewsRelation",a,function(a){o.doArray("updateNewsPublish",e,function(e){t.saveTitle="发布",u("发布成功"),t.loadSource(),t.cancel(),t.saveDisabled=!1})},function(e){t.saveTitle="发布",u("发布失败")})}else o.getDataSource("updateNewsPublishAlldepartment",{id:e[0].id},function(e){t.saveTitle="发布",u("发布成功"),t.loadSource(),t.saveDisabled=!1,t.cancel()},function(e){t.saveTitle="发布",u("发布失败")});else u("请选择要发布的数据")}}]),angular.module("myApp").controller("newsEditController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService","FilesService",function(e,t,a,n,i,o,r,l,s,c,d){e.news={file_servername:"",videofile:{},videotype:0,category:1,istop:1},e.ueditorConfig={toolbars:[["fullscreen","source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","blockquote","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","selectall","cleardoc","|","rowspacingtop","rowspacingbottom","lineheight","|","customstyle","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter","|","insertimage","emotion","scrawl","insertvideo","music","attachment","map","gmap","insertframe","insertcode","webapp","pagebreak","template","background","|","horizontal","date","time","spechars","snapscreen","wordimage","|","inserttable","edittable","deletetable","insertparagraphbeforetable","insertrow","deleterow","insertcol","deletecol","mergecells","mergeright","mergedown","splittocells","splittorows","splittocols","charts","|","print","preview","searchreplace","drafts","help"]],autoClearinitialContent:!0,wordCount:!1,elementPathEnabled:!1,enableAutoSave:!1,autoSyncData:!1},e.uploadFiles=function(t){e.files=t};var u=function(){o.id&&i.getDataSource("selectNewsById",{id:o.id},function(t){e.news=t[0],e.nowfile=d.showFile("newsPhoto",e.news.file_servername,e.news.file_servername)})};e.ready=function(e){u()},e.saveDisabled=!1,e.save=function(t){e.saveDisabled=!0,e.files?d.upLoadPicture(e.files[0],{upcategory:"newsPhoto",width:585,height:361},function(a){e.news.file_servername=a.data[0].servername,e.news.file_serverthumbname=a.data[0].servername.replace(".","_small."),m(t)},function(t){e.saveDisabled=!1}):m(t)},e.getFile=function(){""!=e.news.file_servername};var m=function(t){if(o.id){var n="保存成功";"1"==t&&(e.news.status=1,e.news.publishtime=new Date,n="发布成功"),i.getDataSource("updateNewsById",e.news,function(t){r({message:n,classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.saveDisabled=!1},function(t){e.saveDisabled=!1})}else{if(1==e.news.category&&""==e.news.file_servername)return r({message:"请上传封面图片",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),void(e.saveDisabled=!1);var s=i.getGUID();e.news.id=s,e.news.createuser=a.user.accountId,e.news.createtime=new Date,e.news.status=0,e.news.clicknum=0,e.news.platformid=a.user.platformid;var c=a.user.mdepartmentId;2==a.user.usertype&&(c=a.user.departmentId),e.news.departmentid=c,i.getDataSource("insertNews",e.news,function(t){r({message:"保存成功",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.saveDisabled=!1,l.go("index.newsEdit",{id:s})},function(t){e.saveDisabled=!1})}};e.uploadvideoFiles=function(t,a){e.news.videofile=t,e.process_videofile=0},e.close=function(){e.modalInstance.dismiss("cancel")},e.openVideoPerview=function(e,t){f(t)};var f=function(a){e.modalInstance=t.open({templateUrl:"videoPerview.html",size:"lg",scope:e,resolve:{items:function(){return e.items}}}),n(function(){player=polyvObject("#divVideo").videoPlayer({width:"850",height:"490",vid:a})},0)},p=function(){var t=player1.j2s_getCurrentTime();if(e.news.videotype>0){var a=player2.j2s_getCurrentTime();t!=a&&player2.j2s_seekVideo(t)}};s2j_onVideoPlay=function(){player1.j2s_resumeVideo(),e.news.videotype>0&&player2.j2s_resumeVideo(),clearInterval(obj),obj=setInterval(p,5e3)},s2j_onVideoPause=function(){player1.j2s_pauseVideo(),e.news.videotype>0&&player2.j2s_pauseVideo(),clearInterval(obj)},e.uploadvideo=function(t){e.nowfile=e.news.videofile[0];var n=/(?:\.([^.]+))?$/,i=n.exec(e.nowfile.name)[1],o=(new Date).getTime(),r=md5(o+a.appConfig.vhallConfig.writeToken),l={endpoint:a.appConfig.vhallConfig.uploadPath,resetBefore:$("#reset_before").prop("checked"),resetAfter:!1,title:"title",desc:"desc",ext:i,ts:o,hash:r,userid:a.appConfig.vhallConfig.userid,writeToken:a.appConfig.vhallConfig.writeToken};$(".progress").addClass("active"),upload=polyv.upload(e.nowfile,l).fail(function(e){alert("Failed because: "+e)}).always(function(){}).progress(function(a,n,i){var o=(n/i*100).toFixed(2);e["process_"+t]=o,e.$apply()}).done(function(a,n){"videofile"==t?(e.news.videopath=a.substring(a.lastIndexOf("/")+1),e.news.videoname=n.name):(e.news.videopath=a.substring(a.lastIndexOf("/")+1),e.news.videoname=n.name),e[t+"vid"]=a.substring(a.lastIndexOf("/")+1),e.$apply()})}}]).controller("videoPerviewCtrl",["$scope",function(e){}]),app.controller("permissionController",["$scope","$rootScope","$http","getDataSource","$state",function(e,t,a,n,i){var o={pageNumber:1,pageSize:25,sort:null};e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,useExternalPagination:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"权限名称",field:"name",width:"30%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.name}}</a></div>'},{name:"分组名称",field:"groupname",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"级别",field:"syslevel",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"sysLevelFilter"},{name:"说明",field:"comment",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){o.pageNumber=t,o.pageSize=a,e.loadGrid()})}},e.goDetial=function(e){i.go("index.permissionEdit",{id:e.entity.id})},e.search={},e.loadGrid=function(){var a=(o.pageNumber-1)*o.pageSize,i=o.pageSize,r=["getAllPermission"];n.getList(r,{platformid:t.user.platformid},{firstRow:a,pageSize:i},e.search,o.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data},function(e){})},e.loadGrid(),e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()}}]),app.controller("permissionEditController",["$scope","$rootScope","$http","getDataSource","$state","$stateParams","$validation","notify",function(e,t,a,n,i,o,r,l){e.roleForm=new Object,e.roleForm.name="",e.roleForm.groupname="",e.roleForm.comment="",e.roleForm.syslevel=!1,e.roleForm.id="",e.roleForm.category="";var s=o.id;void 0!=s&&""!=s&&(e.roleForm.id=s,n.getDataSource("getSinglePermission",{permissionid:s},function(t){e.roleForm=t[0],e.roleForm.syslevel=1==t[0].syslevel},function(e){})),e.goToList=function(){i.go("index.permission")},e.savePermssion=function(){n.getUrlData("../api/Permission/SavePermission",e.roleForm,function(e){"success"==e.code?(l({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),i.go("index.permissionEdit",{id:e.id})):l({message:e.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})},function(e){l({message:datatemp.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})}}]),app.controller("noticeController",["$scope","$rootScope","$http","getDataSource","$state",function(e,t,a,n,i){var o={pageNumber:1,pageSize:25,sort:null};e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,useExternalPagination:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"标题",field:"title",width:"30%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.title}}</a></div>'},{name:"内容",field:"content",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"类型",field:"category",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.category == 0 ? "系统升级" :"系统提醒"}}</div>'},{name:"发布状态",field:"publishstate",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.publishstate == 0 ? "未发布" :"已发布"}}</div>'},{name:"发布时间",field:"publishdate",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.publishdate | date:"yyyy-MM-dd hh:mm:ss"}}</div>'},{name:"发布人",field:"publishuser",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"类型",field:"category",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.category == 0 ? "系统升级" :"系统提醒"}}</div>'},{name:"创建时间",field:"createdate",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.createdate | date:"yyyy-MM-dd hh:mm:ss"}}</div>'},{name:"创建人",field:"createuser",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){o.pageNumber=t,o.pageSize=a,e.loadGrid()})}},e.goDetial=function(e){i.go("index.noticeEdit",{id:e.entity.id})},e.search={},e.loadGrid=function(){var t=(o.pageNumber-1)*o.pageSize,a=o.pageSize,i=["getAllNotice"];n.getList(i,{},{firstRow:t,pageSize:a},e.search,o.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data},function(e){})},e.loadGrid(),e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()}}]),app.controller("noticeEditController",["$scope","$rootScope","$http","getDataSource","$state","$stateParams","$validation","notify",function(e,t,a,n,i,o,r,l){e.currentConfig={btnSaveShow:!1,btnPublishShow:!1,btnUnPublishShow:!1},e.noticeData={id:"",title:"",content:"",category:0,createuser:t.user.name,createdate:"",publishuser:"",publishdate:"",publishstate:0,isclose:0};var s=o.id;void 0!=s&&""!=s?(e.noticeData.id=s,n.getDataSource("getNoticeById",{id:s},function(t){e.noticeData=t[0],0==e.noticeData.publishstate?(e.currentConfig.btnSaveShow=!0,e.currentConfig.btnPublishShow=!0,e.currentConfig.btnUnPublishShow=!1):(e.currentConfig.btnSaveShow=!1,e.currentConfig.btnPublishShow=!1,e.currentConfig.btnUnPublishShow=!0)},function(e){})):(e.currentConfig.btnSaveShow=!0,e.currentConfig.btnPublishShow=!1,e.currentConfig.btnUnPublishShow=!1),e.goToList=function(){i.go("index.notice")},e.saveDisabled=!1,e.savePermssion=function(){e.saveDisabled=!0,n.getUrlData("../api/saveNotice",e.noticeData,function(a){e.saveDisabled=!1,"success"==a.code?(l({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),i.go("index.noticeEdit",{id:a.id})):l({message:a.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})},function(a){e.saveDisabled=!1,l({message:datatemp.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})},e.publishNotice=function(){n.getDataSource("publishNotice",{publishuser:t.user.name,publishstate:1,id:e.noticeData.id,title:e.noticeData.title,content:e.noticeData.content,category:e.noticeData.category,isclose:e.noticeData.isclose},function(a){l({message:"发布成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.currentConfig.btnSaveShow=!1,e.currentConfig.btnPublishShow=!1,e.currentConfig.btnUnPublishShow=!0},function(e){l({message:"发布失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})},e.unpublishNotice=function(){n.getDataSource("publishUnNotice",{id:e.noticeData.id},function(a){l({message:"撤销发布成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.currentConfig.btnSaveShow=!0,e.currentConfig.btnPublishShow=!0,e.currentConfig.btnUnPublishShow=!1},function(e){l({message:"撤销发布失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})}}]),angular.module("myApp").controller("planEditController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService","$http","FilesService","$filter",function(e,t,a,n,i,o,r,l,s,c,d,u,m){
var f=(new Date).getFullYear(),p=f+5;e.yearArr=[];for(var g=f;p>=g;g++)e.yearArr.push(g);e.plan={id:"",year:f,orgcode:"",orgname:"",rankarr:[],stutytime:""},e.getLevelArr=function(){i.getUrlData("../api/getsycodes",{categorys:"职级"},function(t){e.levelArr=_.find(t,{type:"职级"}).list},function(e){})}(),e.checkRank=function(t){var a=e.plan.rankarr.indexOf(t.id);a>=0?e.plan.rankarr.splice(a,1):e.plan.rankarr.push(t.id)},e.save=function(){e.exists(function(){i.getUrlData("../api/addplan",e.plan,function(t){t.result?(r({message:"添加成功",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.golist()):r({message:"添加失败",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(e){})})},e.exists=function(t){i.getUrlData("../api/existsplan",e.plan,function(n){if(n.result)t&&t();else{var i=_.find(e.levelArr,{id:n.rank});if(i){var o="["+e.plan.orgname+"]"+e.plan.year+"["+i.showvalue+"]年度计划已制定";r({message:o,classes:"warning",templateUrl:a.appConfig.defaultNoticeUrl})}}},function(e){})},e.golist=function(){var e="index.planlist";l.go(e)},e.selectnode=function(t){e.plan.orgcode=t.id,e.plan.orgname=t.name}}]),angular.module("myApp").controller("planListController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService",function(e,t,a,n,i,o,r,l,s,c){var d=(new Date).getFullYear(),u=(new Date).getFullYear()+5;e.yearArr=[];for(var m=2016;u>=m;m++)e.yearArr.push(m);var f={pageNumber:1,pageSize:25,sort:null};e.search={year:d,orgcode:"",orgname:""},e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()},e.goClear=function(){e.search.orgcode="",e.search.orgname="",e.search.year=(new Date).getFullYear(),e.loadGrid()},e["delete"]=function(){for(var t=e.gridApi.selection.getSelectedRows(),n=[],o=0;o<t.length;o++)n.push({year:t[o].year,departmentid:t[o].depid,studytime:t[o].studytime});i.getUrlData("../api/deleteplan",n,function(t){t.result&&r({message:"删除成功",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.loadGrid()},function(e){})},e.gridOptions={columnDefs:[{name:"年份",width:"10%",field:"year",headerCellClass:"mycenter"},{name:"组织机构",width:"30%",field:"depname",headerCellClass:"mycenter"},{name:"职务级别",width:"46%",field:"rank",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"总学时",width:"10%",field:"studytime",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(t){e.gridApi=t,t.core.on.sortChanged(e,function(t,a){if(0==a.length)f.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),f.sort=n}e.loadGrid()})}},e.loadGrid=function(){i.getUrlData("../api/getplans",e.search,function(t){t.result&&(e.gridOptions.totalItems=t.list.length,e.gridOptions.data=t.list)},function(e){})},e.loadGrid()}]),angular.module("myApp").controller("platformCourseListController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){e["class"]={forAddCourse:[]},e.initTable=function(){l.getDataSource("getPkgCourse",{platformid:i.id,platformid2:i.id},function(t){e.gridOptions.data=t})},e.load=function(){l.getDataSource("selectPlatformCourse",{platformid:t.user.platformid,childplatformid:i.id},function(t){e["class"].courseList=t}),e.initTable()}(),e.gridOptions={useExternalPagination:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"课程名称",field:"name",width:"28%"},{name:"授课人",field:"teachersname",width:"8%"},{name:"授课时间",field:"teachtime",width:"10%"},{name:"分配时间",field:"createtime",width:"10%",cellFilter:"date:'yyyy-MM-dd'"},{name:"分配人",field:"createuser",width:"8%"},{name:"选用次数",field:"sybs",width:"6%"},{name:"来源",field:"teachersname",width:"8%"},{name:"状态",field:"mainstatus",cellFilter:"coursewareStatusFilter",width:"8%"},{name:"共享",width:"6%",field:"isshare",cellFilter:"isShareFilter",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(t){e.gridApi=t}},e.delCourseware=function(){var a=e.gridApi.selection.getSelectedRows(),n={platformid:i.id,selectRows:a};l.getUrlData("../api/checkDelPkgCourse",n,function(n){"success"==n.code?l.doArray(["deletePkgCourseware","deletePkgMicroVideoByCourseId"],a,function(a){e.initTable(),o({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(e){o({message:"删除失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})}):o({message:"删除失败,存在课程已被使用。",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(){})},e.addDisabled=!1,e.addCourse=function(){e.addDisabled=!0,angular.forEach(e["class"].forAddCourse,function(e){e.platformid=i.id,e.coursewareid=e.id,e.coursewarename=e.name,e.isshare=1}),l.getUrlData("../api/savePkgCourse",e["class"].forAddCourse,function(a){e.addDisabled=!1,"success"==a.code?(angular.forEach(e["class"].forAddCourse,function(t){_.remove(e["class"].courseList,{id:t.id})}),e["class"].forAddCourse=[],e.initTable()):o({message:"保存失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(t){e.addDisabled=!1})}}]),angular.module("myApp").controller("platformEditController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){e.platform=new Object,e.platform.id="",e.platform.name="",e.platform.category=0,e.platform.adminaccount=new Array,e.platform.cellphone="",e.platform.logname="",e.platform.pwd="",e.platform.starttime="",e.platform.endtime="",e.platform.status=!1,e.platform.isextend=!0,e.showtotal=t.user.platformcategory,e.goback=function(){r.go("index.platformList",{},{reload:!1})},e.goPlatformEdit=function(){i.id?r.go("index.platformEdit",{id:i.id}):r.go("index.platformEdit")},e.goTabList=function(e){var t="";switch(e){case 0:t="index.platformEdit.courselist";break;case 1:case 4:case 5:t="index.platformEdit.teacherlist";break;case 2:t="index.platformEdit.permissionlist";break;case 3:t="index.platformEdit.microvideolist"}r.go(t,{type:e})},i.id&&(e.nowid=i.id,l.getDataSource(["getPlatformInfo"],{platformid:e.nowid,platformid2:e.nowid},function(t){var a=t;e.platform=a[0];var n=1==e.platform.status;e.platform.status=n;var i=1==e.platform.isextend;e.platform.isextend=i,e.platform.pwd="******"},function(e){})),e.saveButtonDisabled=!1,e.savePlatform=function(){e.saveButtonDisabled=!0,l.getUrlData("../api/platform",e.platform,function(a){"success"==a.code?(e.saveButtonDisabled=!1,r.go("index.platformEdit",{id:a.id}),o({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})):(e.saveButtonDisabled=!1,o({message:a.message,classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}))},function(t){e.saveButtonDisabled=!1})}}]),angular.module("myApp").controller("platformMicroVideoController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){e["class"]={forMicroVideo:[]},e.initTable=function(){l.getDataSource("getPkgMicroVideo",{platformid:i.id},function(t){e.gridOptions.data=t},function(e){alert(1)})},e.load=function(){l.getDataSource("selectPlatformMicroVideo",{platformid:t.user.platformid,childplatformid:i.id},function(t){e["class"].microvideoList=t},function(e){}),e.initTable()}(),e.gridOptions={useExternalPagination:!0,data:[],columnDefs:[{name:"视频名称",field:"name",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.name}}</div>'},{name:"授课人",field:"teacher"},{name:"分类",field:"category"},{name:"分配时间",field:"createtime"},{name:"分配人",field:"createuser"},{name:"关联课程",field:"linkcourse",cellFilter:"isShareFilter"}],onRegisterApi:function(a){e.gridApi=a,a.selection.on.rowSelectionChanged(e,function(e){"row selected "+e.isSelected;e.entity.linkcourse&&(e.isSelected=!1,o({message:"该视频已关联课程，不能被操作。",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}))})}},e.delMicroVideo=function(){var a=e.gridApi.selection.getSelectedRows();l.doArray("deletePkgMicroVideo",a,function(a){e.initTable(),o({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(e){o({message:"删除失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})},e.addDisabled=!1,e.addMicroVideo=function(){e.addDisabled=!0,angular.forEach(e["class"].forMicroVideo,function(e){e.platformid=i.id,e.microvideoid=e.id,e.isshare=1}),l.doArray(["insertPkgMicroVideo"],e["class"].forMicroVideo,function(t){e.addDisabled=!1,angular.forEach(e["class"].forMicroVideo,function(t){_.remove(e["class"].microvideoList,{id:t.id})}),e["class"].forMicroVideo=[],e.initTable()},function(t){e.addDisabled=!1})}}]),angular.module("myApp").controller("platformPermissionController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){e.platform=new Object,e.platform.adminaccount=new Array,e.loadform=function(){i.id?(e.nowid=i.id,l.getDataSource(["getPlatformInfo","getPkgAdmin","getPlatformPermission"],{platformid:e.nowid,platformid2:e.nowid},function(t){var a=_.find(t,{name:"getPlatformInfo"}).data;e.platform=a[0];var n=_.find(t,{name:"getPkgAdmin"}).data;e.platform.pwd="******",e.platform.adminaccount=n[0];var i=_.find(t,{name:"getPlatformPermission"}).data;e.platform.permissionGroupList=e.permissionGroupList;for(var o=e.platform.permissionGroupList.length,r=0;o>r;r++)for(var l=e.platform.permissionGroupList[r].permissionArray,s=l.length,c=0;s>c;c++)if(i.length>0){var d=_.find(i,{id:l[c].id});null!=d&&void 0!=d?l[c].selected=!0:l[c].selected=!1}else l[c].selected=!1},function(e){})):e.platform.permissionGroupList=e.permissionGroupList},e.adminctrl=new Object,e.adminctrl.disabled=!1,e.adminctrl.onSelectCallback=function(t,a){e.platform.cellphone=t.cellphone,e.platform.logname=t.logname,e.platform.pwd="******"},e.loadpage=function(){l.getDataSource(["selectPlatformAdmin","selectPlatformPermission","getAllPermissionGroup"],{platformid:t.user.platformid,childplatformid:i.id},function(t){e.admins=_.find(t,{name:"selectPlatformAdmin"}).data;var a=_.find(t,{name:"getAllPermissionGroup"}).data,n=_.find(t,{name:"selectPlatformPermission"}).data,i=a.length,o="",r="";e.permissionGroupList=new Array;for(var l=0;i>l;l++){o=a[l].groupname,r=a[l].category;var s=_.filter(n,{groupname:o}),c=s.length;if(0!=c){for(var d=0;c>d;d++)s[d].selected=!1;e.permissionGroupList.push({groupname:o,category:r,permissionArray:s})}}e.loadform()},function(e){})}(),e.saveButtonDisabled=!1,e.savePlatformAdmin=function(){e.saveButtonDisabled=!0,l.getUrlData("../api/savePlatformAdmin",e.platform,function(a){"success"==a.code?(e.saveButtonDisabled=!1,o({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})):(e.saveButtonDisabled=!1,o({message:"保存失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}))},function(t){e.saveButtonDisabled=!1})}}]),angular.module("myApp").controller("platformTeacherListController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){e["class"]={forAddTeacher:[]},e.placeholder="班主任";var s=0;switch(i.type){case 1:s=0,e.placeholder="班主任";break;case 4:s=1,e.placeholder="班主任助理";break;case 5:s=2,e.placeholder="班部指导老师"}e.initTable=function(){l.getDataSource("getPkgUsers",{platformid:i.id,category:s},function(t){e.gridOptions.data=t})},e.load=function(){l.getDataSource("selectPlatformUser",{platformid:t.user.platformid,childplatformid:i.id,category:s},function(t){e["class"].teacherList=t}),e.initTable()}(),e.gridOptions={useExternalPagination:!0,data:[],columnDefs:[{name:"教师姓名",field:"uname",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.uname}}</div>'},{name:"工作单位",field:"company"}],onRegisterApi:function(t){e.gridApi=t}},e.delTeacher=function(){var a=e.gridApi.selection.getSelectedRows(),n={category:s,platformid:i.id,selectRows:a};l.getUrlData("../api/checkDelPkgUser",n,function(a){"success"==a.code?(e.initTable(),o({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})):o({message:a.message,classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(e){o({message:"删除失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})},e.addDisabled=!1,e.addTeacher=function(){e.addDisabled=!0,angular.forEach(e["class"].forAddTeacher,function(e){e.platformid=i.id,e.userid=e.id,e.uname=e.uname,e.category=s}),l.getUrlData("../api/insertPkgUser",e["class"].forAddTeacher,function(t){e.addDisabled=!1,angular.forEach(e["class"].forAddTeacher,function(t){_.remove(e["class"].teacherList,{id:t.id})}),e["class"].forAddTeacher=[],e.initTable()},function(t){e.addDisabled=!1})}}]),angular.module("myApp").controller("platformListController",["$scope","$rootScope","getDataSource","$state","$modal","notify",function(e,t,a,n,i,o){var r={pageNumber:1,pageSize:25,sort:null};e.gridOptions={enableFiltering:!1,paginationPageSizes:[25,50,75],paginationPageSize:25,useExternalPagination:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"平台名称",field:"name",width:"50%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.name}}</a></div>'},{name:"状态",field:"status",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"mapGender"},{name:"平台分类",field:"category",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"platformCategory"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){r.pageNumber=t,r.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)r.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),r.sort=n}e.loadGrid()})}},e.search={},e.loadGrid=function(){var t=(r.pageNumber-1)*r.pageSize,n=r.pageSize,i=["selectAllPlatform"];a.getList(i,{},{firstRow:t,pageSize:n},e.search,r.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data},function(e){})},e.loadGrid(),e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()},e.deletePlatform=function(){e.modalInstance=i.open({templateUrl:"confirm.html",size:"sm",scope:e})},e.ok=function(){e.isAccept=!0;var n=e.gridApi.selection.getSelectedRows();a.doArray("deletePlatform",n,function(){o({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadGrid()},function(e){o({message:"删除失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})}),e.close()},e.close=function(){e.modalInstance.dismiss("cancel")},e.goDetial=function(e){n.go("index.platformEdit",{id:e.entity.id})}}]),angular.module("myApp").controller("pushmessageController",["$scope","$rootScope","$state","$http","$timeout","$document","notify","getDataSource","DateService","CommonService",function(e,t,a,n,i,o,r,l,s,c){function d(e,t,a){var n={label:a.name,rowid:a.id,children:[]},i=_.filter(t,{fid:a.id}),o=i.length;if(o>0)for(var r=0;o>r;r++)d(n,t,i[r]);e.children.push(n)}var u,m=0;e.parentDisabled=!1,e.nameDisabled=!1,e.childnameDisabled=!1,e.saveCurrentButtonDisabled=!1,e.saveButtonDisabled=!1,e.deleteDisabled=!1,e.my_tree_handler=function(t){e.output="","0"==t.rowid?(e.parentDisabled=!0,e.nameDisabled=!0,e.saveCurrentButtonDisabled=!0,e.deleteDisabled=!0):(e.parentDisabled=!1,e.nameDisabled=!1,e.saveCurrentButtonDisabled=!1,e.deleteDisabled=!1),e.loadPushMessageCategoryParent(t)},e.loadPushMessageCategoryParent=function(t){m=t.rowid,l.getDataSource("select_pushMessageParent",{},function(t){e.parentCategory=t,e.parentCategory.push({id:"",fid:"0",name:"====根目录===="}),""!=m&&void 0!=m&&null!=m&&l.getDataSource("getPushMessageCategoryById",{id:m},function(t){e.categoryForm=t[0]},function(e){})},function(e){})},e.deletePushMessageCategory=function(){e.deleteDisabled=!0,l.getDataSource("select_pushMessageChildren",{fid:m},function(a){var n=a.length;0>=n?l.getDataSource("deletePushMessageCategoryById",{id:m},function(a){a.length>0?(r({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.my_data=[],e.deleteDisabled=!0,e.loadCategoryTree()):(e.deleteDisabled=!1,r({message:a.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl}))},function(e){}):(r({message:"删除失败，请先删除分类下子分类。",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.deleteDisabled=!1)},function(e){})},e.saveCurrentPushMessageCategory=function(){e.saveCurrentButtonDisabled=!0;l.getGUID();if(void 0!=m&&"0"!=m&&void 0!=m&&null!=m){var a=_.find(e.parentCategory,{id:e.categoryForm.fid}),n="";n=null!=a?a.id+"."+m:m,l.getDataSource("updatePushMessageCategoryById",{id:m,fid:e.categoryForm.fid,name:e.categoryForm.name,sortnum:e.categoryForm.sortnum,fids:n},function(a){e.saveCurrentButtonDisabled=!1,a.length>0?(r({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.my_data=[],e.loadCategoryTree()):r({message:a.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})},function(t){e.saveCurrentButtonDisabled=!1})}},e.savePushMessageCategory=function(){e.saveButtonDisabled=!0;var a=l.getGUID(),n=_.find(e.parentCategory,{id:e.categoryForm.fid}),i="";i=null!=n?n.id+"."+a:a;var o=m;void 0!=o&&"0"!=o||(o="0");var s={id:a,fid:o,name:e.categoryForm.childname,sortnum:e.categoryForm.sortnum,platformid:t.user.platformid,fids:i};l.getDataSource("insert_pushMessageCategory",s,function(a){e.saveButtonDisabled=!1,a.length>0?(r({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.my_data=[],m=0,e.loadCategoryTree()):r({message:a.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})},function(t){e.saveButtonDisabled=!1})},e.my_data=new Array,e.my_tree=u={},e.loadCategoryTree=function(){l.getDataSource("select_pushMessageParent",{},function(t){var a=t.length,n=new Object;n.label="消息推送分类",n.rowid="0",n.children=new Array;for(var i=0;a>i;i++)"0"==t[i].fid&&d(n,t,t[i]);e.my_data.push(n),e.doing_async=!1,u.expand_all()},function(e){})},e.try_async_load=function(){e.my_data=new Array,e.doing_async=!0,e.loadCategoryTree()},e.try_async_load()}]),angular.module("myApp").controller("pushmessageEditController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource","FilesService",function(e,t,a,n,i,o,r,l,s){function c(e,t,a){for(var n={name:a.name,id:a.id,children:[]},i=_.filter(t,{fid:a.id}),o=i.length,r=0;o>r;r++)c(n,t,i[r]);e.children.push(n)}function d(t,a){var n=_.filter(a,{id:t.id});if(n.length>0){for(var i=0;i<n.length;i++)t.selected=!0,t.isActive=!0;e.news.selectedItem.push(t)}else for(var o=t.children.length,i=0;o>i;i++)d(t.children[i],a)}function u(){l.getDataSource(["updatePushMessage","deletePushMessageRelationByMessageId"],e.news,function(a){l.doArray("insertPushMessageRelation",e.news.categorylist,function(a){e.saveDisabled=!1,o({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(a){e.saveDisabled=!1,o({message:"保存失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})},function(a){e.saveDisabled=!1,o({message:"保存失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})}e.allcategory=[],e.levelonelist=[],e.leveltwolist=[],e.levelthreelist=[],e.news=new Object,e.showPublishBtn=!1;var m=i.id;e.selectOnly1Or2=function(e,t){return!(void 0!==t&&t.length>=20)},e.goback=function(){r.go("index.pushmessagelist")},e.switchViewCallback=function(e){},e.LoadData=function(){l.getDataSource(["selectAllPushMessageCategory"],{},function(t){e.allcategory=[];var a=t.length,n=new Object;n.label="信息分类",n.rowid="0",n.children=new Array;for(var i=0;a>i;i++)"0"==t[i].fid&&c(n,t,t[i]);null!=m&&""!=m?(e.showPublishBtn=!0,l.getDataSource(["getPushMessageById","getPushMessageCategoryByMessageId"],{id:m},function(t){e.news=_.find(t,{name:"getPushMessageById"}).data[0],e.news.selectedItem=new Array;for(var a=_.find(t,{name:"getPushMessageCategoryByMessageId"}).data,i=n.children.length,o=0;i>o;o++)d(n.children[o],a);e.allcategory=n.children},function(e){})):e.allcategory=n.children},function(e){})},e.uploadFiles=function(t){e.files=t,e.news.pdfname=e.files[0].name},e.saveNew=function(){var a=l.getGUID();e.news.id=a;for(var n=e.news.selectedItem,i=n.length,r=new Array,c=0;i>c;c++){var d=new Object;d.categoryid=n[c].id,d.messageid=a,r.push(d)}e.news.pdfname="",e.news.pdfservername="",e.news.platformid=t.user.platformid,e.news.categorylist=r,e.news.createuser=t.user.name,e.news.createtime=new Date,void 0!=e.files&&e.files.length>0?s.upLoadPicture(e.files[0],{upcategory:"pushMessagePdf"},function(a){e.news.pdfname=e.files[0].name,e.news.pdfservername=a.data[0].servername,l.getDataSource(["insertPushMessage"],e.news,function(a){l.doArray("insertPushMessageRelation",e.news.categorylist,function(a){e.saveDisabled=!1,o({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(a){e.saveDisabled=!1,o({message:"保存失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})},function(a){e.saveDisabled=!1,o({message:"保存失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})}):(e.saveDisabled=!1,o({message:"请选择附件上传",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}))},e.saveForm=function(){for(var a=e.news.selectedItem,n=a.length,i=new Array,o=0;n>o;o++){var r=new Object;r.categoryid=a[o].id,r.messageid=m,i.push(r)}e.news.id=m,e.news.categorylist=i,e.news.publishuser=t.user.name,e.news.publishtime=new Date,void 0!=e.files&&e.files.length>0?s.upLoadPicture(e.files[0],{upcategory:"pushMessagePdf"},function(t){e.news.pdfname=e.files[0].name,e.news.pdfservername=t.data[0].servername,u()}):u()},e.saveDisabled=!1,e.save=function(t){e.saveDisabled=!0,null==m||""==m?e.saveNew():e.saveForm()},e.LoadData(),e.publish=function(){var a=new Object;a.id=m,a.publishuser=t.user.name,a.publishtime=new Date,a.status=1,l.getDataSource("publishPushMessage",a,function(a){e.saveDisabled=!1,o({message:"发布成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(a){e.saveDisabled=!1,o({message:"发布失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})}}]),angular.module("myApp").controller("pushmessagelistController",["$scope","$rootScope","$state","$http","$timeout","$document","notify","getDataSource","DateService","CommonService",function(e,t,a,n,i,o,r,l,s,c){var d={pageNumber:1,pageSize:25,sort:null};e.gridOptions={enableFiltering:!1,paginationPageSizes:[25,50,75],paginationPageSize:25,useExternalPagination:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"标题",field:"title",width:"34%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.title}}</a></div>'},{name:"点击数",field:"clicknum",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"发布状态",field:"status",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"publishStatusFilter"},{name:"创建人",field:"createuser",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建时间",field:"createtime",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"date:'yyyy-MM-dd HH:mm:ss'"},{name:"发布人",field:"publishuser",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"发布时间",field:"publishtime",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"date:'yyyy-MM-dd'"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){d.pageNumber=t,d.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)d.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),d.sort=n}e.loadGrid()})}},e.search={},e.loadGrid=function(){var t=(d.pageNumber-1)*d.pageSize,a=d.pageSize,n=["selectAllPushMessage"];l.getList(n,{},{firstRow:t,pageSize:a},e.search,d.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data},function(e){})},e.loadGrid(),e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()},e.goDetial=function(e){a.go("index.pushmessageEdit",{id:e.entity.id})},e.doPublish=function(a){for(var n=e.gridApi.selection.getSelectedRows(),i=n.length,o=new Array,s=0;i>s;s++){var c=new Object;c.id=n[s].id,c.publishuser=t.user.name,c.publishtime=new Date,c.status=a,o.push(c)}l.doArray("publishPushMessage",o,function(a){r({message:"发布成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadGrid()},function(e){r({message:"发布失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})}}]),app.controller("querylogController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){var s={pageNumber:1,pageSize:25,sort:null};e.months=[1,2,3,4,5,6,7,8,9,10,11,12],e.years=[],e.currenty=(new Date).getFullYear(),e.currentm=(new Date).getMonth()+1;for(var c=2016;c<e.currenty+1;c++)e.years.push(c);e.tblobj={},e.tblobj.year=e.currenty,e.tblobj.month=e.currentm,e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,useExternalPagination:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"登录名",field:"username",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"班级名称",field:"classname",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"操作",field:"handle",cellClass:"mycenter",width:"20%",headerCellClass:"mycenter"},{name:"操作时间",field:"handletime",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"date:'yyyy-MM-dd HH:mm:ss'"},{name:"操作分类",field:"handlecategory",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){s.pageNumber=t,s.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)s.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),s.sort=n}e.loadGrid()})}},e.search={},e.loadGrid=function(){var a=(s.pageNumber-1)*s.pageSize,n=s.pageSize,i=["getMonthLog"],o=null;o=""==e.tblobj.year||""==e.tblobj.month?new Date:new Date(Date.parse((e.tblobj.year+"-"+e.tblobj.month+"-01").replace(/-/g,"/"))),l.getConnKeyList(i,{platformid:t.user.platformid,tablerule:o},{firstRow:a,pageSize:n},e.search,s.sort,{connectionKey:"LogConnectionString"},function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data},function(e){})},e.loadGrid(),e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()}}]),angular.module("myApp").controller("answeredController",["$scope","$rootScope","getDataSource","$state","$modal","notify","CommonService",function(e,t,a,n,i,o){var r={pageNumber:1,pageSize:25,sort:[{sort:{priority:0,direction:"desc"},name:"createtime"}]};e.goAnswer=function(t){e.questionInfo=t,e.questionInfo.entity.answercontent="",e.modalInstance=i.open({templateUrl:"answer.html",size:"lg",scope:e})},e.goShield=function(t){e.questionShieldInfo=t,e.questionShieldInfo.entity.reason="",e.modalInstance=i.open({templateUrl:"shield.html",size:"lg",scope:e})},e.close=function(){e.modalInstance.dismiss("cancel")},e.goDetial=function(e){n.go("index.questionDetail",{id:e.entity.id})},e.search={},e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"问题",field:"content",width:"30%",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goAnswer(row)">{{row.entity.content}}</a>'},{name:"提问人",field:"studentname",width:"8%"},{name:"提问人单位",field:"departmentname",width:"12%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"提问时间",field:"createtime",width:"13%"},{name:"来自课程",field:"coursewarename",width:"20%"},{name:"主讲人",field:"teachersname",width:"10%"},{name:"答案",field:"answertcount",width:"8%",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.answertcount}}</a>'},{name:"操作",width:"10%",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goAnswer(row)">回答</a><a style="padding-left:20px;" ng-click="grid.appScope.goShield(row)">屏蔽</a></div>'}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){r.pageNumber=t,r.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)r.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),r.sort=n}e.loadGrid()})}},e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()},e.loadGrid=function(){var t=(r.pageNumber-1)*r.pageSize,n=r.pageSize;a.getList("getAnsweredQuestion",{},{firstRow:t,pageSize:n},e.search,r.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadGrid(),e.saveDisabled=!1,e.saveAnswer=function(){if(e.saveDisabled=!0,void 0==e.questionInfo.entity.answerContent||""==e.questionInfo.entity.answerContent||e.questionInfo.entity.answerContent.length<=0)return o({message:"请输入回复内容。",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.saveDisabled=!1);var n={id:a.getGUID(),accountid:t.user.accountId,fid:e.questionInfo.entity.id,content:e.questionInfo.entity.answerContent,coursewareid:e.questionInfo.entity.coursewareid,usertype:2,classid:t.user.classId,faqid:e.questionInfo.entity.id};a.getDataSource("classmanager-faq-teacheranswer",n,function(a){a[0].crow&&a[0].crow>=1?(e.saveDisabled=!1,o({message:"回复问题成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.close(),e.loadGrid()):(e.saveDisabled=!1,o({message:"回复问题失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl}))},function(a){e.saveDisabled=!1,o({message:"回复问题失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})},e.saveShield=function(){var n={id:e.questionShieldInfo.entity.id,shielding:1,reason:e.questionShieldInfo.entity.reason,accountid:t.user.accountId};a.getDataSource("classmanager-faq-shielding-update",n,function(a){a[0].crow&&a[0].crow>=1?(e.close(),e.loadGrid(),o({message:"屏蔽问题成功",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})):o({message:"屏蔽问题失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})},function(e){o({message:"屏蔽问题失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})}}]),angular.module("myApp").controller("noansweredController",["$scope","$rootScope","getDataSource","$state","$modal","notify","CommonService",function(e,t,a,n,i,o){var r={pageNumber:1,pageSize:25,sort:[{sort:{priority:0,direction:"desc"},name:"createtime"}]};e.goAnswer=function(t){e.questionInfo=t,e.questionInfo.entity.answercontent="",e.modalInstance=i.open({templateUrl:"answer.html",size:"lg",scope:e})},e.goShield=function(t){e.questionShieldInfo=t,e.questionShieldInfo.entity.reason="",e.modalInstance=i.open({templateUrl:"shield.html",size:"lg",scope:e})},e.close=function(){e.modalInstance.dismiss("cancel")},e.goDetial=function(e){n.go("index.questionDetail",{id:e.entity.id})},e.search={},e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"问题",field:"content",width:"24%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goAnswer(row)">{{row.entity.content}}</a>'},{name:"提问人",field:"studentname",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"提问人单位",field:"departmentname",width:"12%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"提问时间",field:"createtime",width:"13%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"来自课程",field:"coursewarename",width:"20%",headerCellClass:"mycenter"},{name:"主讲人",field:"teachersname",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"
},{name:"答案",field:"answertcount",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.answertcount}}</a>'},{name:"操作",width:"10%",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goAnswer(row)">回答</a><a style="padding-left:20px;" ng-click="grid.appScope.goShield(row)">屏蔽</a></div>'}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){r.pageNumber=t,r.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)r.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),r.sort=n}e.loadGrid()})}},e.goSearch=function(){e.loadGrid()},e.loadGrid=function(){var t=(r.pageNumber-1)*r.pageSize,n=r.pageSize;a.getList("getNoAnsweredQuestion",{},{firstRow:t,pageSize:n},e.search,r.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadGrid(),e.saveDisabled=!1,e.saveAnswer=function(){if(e.saveDisabled=!0,void 0==e.questionInfo.entity.answerContent||""==e.questionInfo.entity.answerContent||e.questionInfo.entity.answerContent.length<=0)return o({message:"请输入回复内容。",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.saveDisabled=!1);var n={id:a.getGUID(),accountid:t.user.accountId,fid:e.questionInfo.entity.id,content:e.questionInfo.entity.answerContent,coursewareid:e.questionInfo.entity.coursewareid,usertype:2,classid:t.user.classId,faqid:e.questionInfo.entity.id};a.getDataSource("backsys_classmanager-faq-teacheranswer",n,function(a){a[0].crow&&a[0].crow>=1?(e.saveDisabled=!1,o({message:"回复问题成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.close(),e.loadGrid()):(e.saveDisabled=!1,o({message:"回复问题失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl}))},function(a){e.saveDisabled=!1,o({message:"回复问题失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})},e.saveShield=function(){var n={id:e.questionShieldInfo.entity.id,shielding:1,reason:e.questionShieldInfo.entity.reason,accountid:t.user.accountId};a.getDataSource("classmanager-faq-shielding-update",n,function(a){a[0].crow&&a[0].crow>=1?(e.close(),e.loadGrid(),o({message:"屏蔽问题成功",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})):o({message:"屏蔽问题失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})},function(e){o({message:"屏蔽问题失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})}}]),angular.module("myApp").controller("questionController",["$rootScope","$scope","getDataSource","$state","$stateParams","notify","$filter",function(e,t,a,n,i,o,r){t.goQuestionList=function(e){var t="";switch(e){case 0:t="index.question.noanswered";break;case 1:t="index.question.answered";break;case 2:t="index.question.shield"}n.go(t)}}]),angular.module("myApp").controller("questionDetailController",["$scope","$rootScope","getDataSource","$state","$modal","$stateParams","notify","CommonService",function(e,t,a,n,i,o,r){var l={pageNumber:1,pageSize:25,sort:[{sort:{priority:0,direction:"desc"},name:"createtime"}]};e.acceptAnswer=function(n){var i={id:n};a.getDataSource("classmanager-faq-acceptanswer",i,function(a){a[0].crow&&a[0].crow>=1?(e.loadGrid(),r({message:"采纳答案成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})):r({message:"采纳答案失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(e){r({message:"采纳答案失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})},e.goAnswer=function(t){e.answerInfo=t,e.modalInstance=i.open({templateUrl:"answerDetail.html",size:"lg",scope:e})},e.close=function(){e.modalInstance.dismiss("cancel")},e.search={},e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"回答",field:"content",width:"50%",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goAnswer(row)">{{row.entity.content}}</a>'},{name:"回答人",field:"username",width:"10%"},{name:"回答时间",field:"createtime",width:"15%"},{name:"回答来自",field:"usertype",width:"8%",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.usertype == "1" ? "学员":"老师"}}</div>'},{name:"是否采纳",field:"status",width:"8%",cellTemplate:'<div class="ui-grid-cell-contents">{{!row.entity.status ? "未采纳":"已采纳"}}</div>'},{name:"操作",width:"10%",cellTemplate:'<div class="ui-grid-cell-contents" ng-if="!row.entity.status"><a ng-click="grid.appScope.acceptAnswer(row.entity.id)">采纳</a>'}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){l.pageNumber=t,l.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)l.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),l.sort=n}e.loadGrid()})}},e.goSearch=function(){e.loadGrid()},e.loadGrid=function(){var t=(l.pageNumber-1)*l.pageSize,n=l.pageSize;a.getList("getQuestionAnswers",{fid:o.id},{firstRow:t,pageSize:n},e.search,l.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadGrid()}]),angular.module("myApp").controller("shieldController",["$scope","$rootScope","getDataSource","$state","$modal","notify","CommonService",function(e,t,a,n,i,o){var r={pageNumber:1,pageSize:25,sort:[{sort:{priority:0,direction:"desc"},name:"createtime"}]};e.goAnswer=function(t){e.questionInfo=t,e.questionInfo.entity.answercontent="",e.modalInstance=i.open({templateUrl:"answer.html",size:"lg",scope:e})},e.close=function(){e.modalInstance.dismiss("cancel")},e.goDetial=function(e){n.go("index.questionDetail",{id:e.entity.id})},e.search={},e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"问题",field:"content",width:"30%",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goAnswer(row)">{{row.entity.content}}</a>'},{name:"提问人",width:"7%",field:"studentname"},{name:"提问人单位",field:"departmentname",width:"12%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"提问时间",width:"13%",field:"createtime"},{name:"来自课程",width:"20%",field:"coursewarename"},{name:"主讲人",width:"8%",field:"teachersname"},{name:"答案",field:"answertcount",width:"8%",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.answertcount}}</a>'},{name:"操作",width:"10%",cellTemplate:'<div class="ui-grid-cell-contents"><a style="padding-left:20px;" ng-click="grid.appScope.cancelShield(row)">取消屏蔽</a></div>'}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){r.pageNumber=t,r.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)r.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),r.sort=n}e.loadGrid()})}},e.goSearch=function(){e.loadGrid()},e.loadGrid=function(){var t=(r.pageNumber-1)*r.pageSize,n=r.pageSize;a.getList("getShieldQuestion",{},{firstRow:t,pageSize:n},e.search,r.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadGrid(),e.saveDisabled=!1,e.saveAnswer=function(){if(e.saveDisabled=!0,void 0==e.questionInfo.entity.answerContent||""==e.questionInfo.entity.answerContent||e.questionInfo.entity.answerContent.length<=0)return o({message:"请输入回复内容。",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.saveDisabled=!1);var n={id:a.getGUID(),accountid:t.user.accountId,fid:e.questionInfo.entity.id,content:e.questionInfo.entity.answerContent,coursewareid:e.questionInfo.entity.coursewareid,usertype:2,classid:t.user.classId,faqid:e.questionInfo.entity.id};a.getDataSource("classmanager-faq-teacheranswer",n,function(a){a[0].crow&&a[0].crow>=1?(e.saveDisabled=!1,o({message:"回复问题成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.close(),e.loadGrid()):(e.saveDisabled=!1,o({message:"回复问题失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl}))},function(a){e.saveDisabled=!1,o({message:"回复问题失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})},e.cancelShield=function(n){var i={id:n.entity.id,shielding:0,reason:"",accountid:t.user.accountId};a.getDataSource("classmanager-faq-shielding-update",i,function(a){a[0].crow&&a[0].crow>=1?(e.loadGrid(),o({message:"取消屏蔽问题成功",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})):o({message:"取消屏蔽问题失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})},function(e){o({message:"取消屏蔽问题失败",classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})})}}]),angular.module("myApp").controller("questionnaireController",["$rootScope","$scope","getDataSource","$state","$stateParams","notify","$filter",function(e,t,a,n,i,o,r){t.goQuestionnaiseList=function(e){var t="";switch(e){case 0:t="index.questionnaire.questionnaire_list"}n.go(t)}}]),angular.module("myApp").controller("questionnaire_editController",["$scope","$rootScope","getDataSource","$state","notify","$modal","$stateParams",function(e,t,a,n,i,o,r){e.quest={},""==r.coursewareid?e.quest.category=1:e.quest.category=0,e.quests=[],e.answers=[],e.load=function(){r.id&&a.getDataSource(["selectquestionnaireById","selectquestionnaire_detailById","select_sy_questionnaire_detail_subjectById"],{id:r.id},function(t){e.quest=_.find(t,function(e){return"selectquestionnaireById"==e.name}).data[0],e.quests=_.find(t,function(e){return"selectquestionnaire_detailById"==e.name}).data;var a=_.find(t,function(e){return"select_sy_questionnaire_detail_subjectById"==e.name}).data;angular.forEach(e.quests,function(e){e.answers=[],angular.forEach(a,function(t){t.fid==e.id&&e.answers.push(t)})})})},e.load(),e.saveButtonDisabled=!1,e.save=function(){e.saveButtonDisabled=!0;var o=[];r.id?a.getDataSource(["update_sy_questionnaire","delete_sy_questionnaire_detail","delete_sy_questionnaire_subject"],e.quest,function(n){angular.forEach(e.quests,function(t,n){t.questionnaireid=e.quest.id,t.id=a.getGUID(),t.sort=n+1,angular.forEach(t.answers,function(n,i){n.id=a.getGUID(),n.sort=i,n.fid=t.id,n.questionnaireid=e.quest.id,o.push(n)})}),e.saveButtonDisabled=!1,a.doArray("insert_sy_questionnaire_detail",e.quests,function(e){a.doArray("insert_sy_questionnaire_subject",o,function(e){i({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})})},function(t){e.saveButtonDisabled=!1}):(e.quest.id=a.getGUID(),e.quest.createuser=t.user.name,e.quest.createtime=new Date,angular.forEach(e.quests,function(t,n){t.questionnaireid=e.quest.id,t.id=a.getGUID(),t.sort=n+1,angular.forEach(t.answers,function(n,i){n.id=a.getGUID(),n.sort=i,n.fid=t.id,n.questionnaireid=e.quest.id,o.push(n)})}),r.coursewareid&&a.getDataSource("insert_sy_course_relation",{id:a.getGUID(),coursewareid:r.coursewareid,sourceid:e.quest.id,type:3},function(e){}),a.getDataSource("insert_sy_questionnaire",e.quest,function(l){e.saveButtonDisabled=!1,a.doArray("insert_sy_questionnaire_detail",e.quests,function(l){a.doArray("insert_sy_questionnaire_subject",o,function(a){n.go("index.questionnaire_edit",{id:e.quest.id,coursewareid:r.coursewareid}),i({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})})})},function(t){e.saveButtonDisabled=!1}))},e.deleteQuest=function(t){e.quests.pop(t)},e.deleteAnswer=function(t){e.nowanswers.answers.pop(t)},e.addquest=function(){e.quests.push({sort:e.quests.length+1,title:""})},e.addanswer=function(){e.nowanswers.answers.push({order:e.answers.length+1,title:""})},e.close=function(){e.modalInstance.dismiss("cancel")},e.saveAnswer=function(){e.close()},e.editDetail=function(t){e.nowanswers=t,e.nowanswers.answers||(e.nowanswers.answers=[]),e.modalInstance=o.open({templateUrl:"quest_detail.html",size:"lg",scope:e})}}]),angular.module("myApp").controller("questionnaire_edit_shareController",["$scope","$rootScope","getDataSource","$state","notify","$modal","$stateParams",function(e,t,a,n,i,o,r){e.quest={},""==r.coursewareid?e.quest.category=1:e.quest.category=0,e.quests=[],e.answers=[],e.load=function(){r.id&&a.getDataSource(["selectquestionnaireById","selectquestionnaire_detailById","select_sy_questionnaire_detail_subjectById"],{id:r.id},function(t){e.quest=_.find(t,function(e){return"selectquestionnaireById"==e.name}).data[0],e.quests=_.find(t,function(e){return"selectquestionnaire_detailById"==e.name}).data;var a=_.find(t,function(e){return"select_sy_questionnaire_detail_subjectById"==e.name}).data;angular.forEach(e.quests,function(e){e.answers=[],angular.forEach(a,function(t){t.fid==e.id&&e.answers.push(t)})})})},e.load(),e.close=function(){e.modalInstance.dismiss("cancel")}}]),angular.module("myApp").controller("questionnaire_listController",["$scope","$rootScope","getDataSource","$state","notify","$modal",function(e,t,a,n,i,o){var r={pageNumber:1,pageSize:25,sort:null};e.search={},e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"序号",width:"6%",field:"rownum",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"问卷名称",width:"54%",field:"title",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.title}}</a></div>',headerCellClass:"mycenter"},{name:"问卷类型",width:"10%",field:"category",cellFilter:"questCategoryFilter",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建人",width:"10%",field:"createuser",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建时间",width:"10%",field:"createtime",cellFilter:"date:'yyyy-MM-dd'",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"题目数",width:"10%",field:"questnum",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){r.pageNumber=t,r.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)r.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),r.sort=n}e.loadGrid()})}},e["delete"]=function(){var n=e.gridApi.selection.getSelectedRows();a.doArray("delete_sy_questById",n,function(a){i({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadGrid()})},e.goDetial=function(e){n.go("index.questionnaire_edit",{id:e.entity.id})},e.goSearch=function(){e.loadGrid()},e.loadGrid=function(){var t=(r.pageNumber-1)*r.pageSize,n=r.pageSize;a.getList("select_sy_questionnaire",{},{firstRow:t,pageSize:n},e.search,r.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadGrid()}]),angular.module("myApp").controller("questionnaire_list_shareController",["$scope","$rootScope","getDataSource","$state","notify","$modal",function(e,t,a,n,i,o){var r={pageNumber:1,pageSize:25,sort:null};e.search={},e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"序号",width:"6%",field:"rownum",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"问卷名称",width:"54%",field:"title",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.title}}</a></div>',headerCellClass:"mycenter"},{name:"问卷类型",width:"10%",field:"category",cellFilter:"questCategoryFilter",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建人",width:"10%",field:"createuser",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建时间",width:"10%",field:"createtime",cellFilter:"date:'yyyy-MM-dd'",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"题目数",width:"10%",field:"questnum",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){r.pageNumber=t,r.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)r.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),r.sort=n}e.loadGrid()})}},e["delete"]=function(){var n=e.gridApi.selection.getSelectedRows();a.doArray("delete_sy_questById",n,function(a){i({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadGrid()})},e.goDetial=function(e){n.go("index.questionnaire_edit_share",{id:e.entity.id})},e.goSearch=function(){e.loadGrid()},e.loadGrid=function(){var n=(r.pageNumber-1)*r.pageSize,i=r.pageSize;a.getList("select_sy_questionnaireByShare",{platformid:t.user.platformid},{firstRow:n,pageSize:i},e.search,r.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadGrid()}]),angular.module("myApp").controller("recommendcourseController",["$rootScope","$http","$scope","getDataSource","$state","$stateParams","$modal","notify","smsService",function(e,t,a,n,i,o,r,l,s){a["class"]={forAddCourse:[]};var c={pageNumber:1,pageSize:25,sort:null};a.search={},a.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"序号",width:"6%",field:"rownum",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"课程名称",width:"45%",field:"coursewarename",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.coursewarename}}</div>',headerCellClass:"mycenter"},{name:"授课人",width:"20%",field:"teachersname",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"创建时间",width:"25%",field:"createtime",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"date:'yyyy-MM-dd'"}],onRegisterApi:function(e){a.gridApi=e,e.pagination.on.paginationChanged(a,function(e,t){c.pageNumber=e,c.pageSize=t,a.loadGrid()}),e.core.on.sortChanged(a,function(e,t){if(0==t.length)c.sort=null;else{var n=[];angular.forEach(t,function(e){n.push({sort:e.sort,name:e.field})}),c.sort=n}a.loadGrid()})}},a.goSearch=function(){a.gridOptions.paginationCurrentPage=1,a.loadGrid()},a.goDetial=function(e){i.go("index.recommendcourseEdit",{id:e.entity.coursewareid,opencourseid:e.entity.id})},a.loadGrid=function(){var e=(c.pageNumber-1)*c.pageSize,t=c.pageSize;n.getList("selectOpenCourseware",{},{firstRow:e,pageSize:t},a.search,c.sort,function(e){a.gridOptions.totalItems=e[0].allRowCount,a.gridOptions.data=e[0].data})},a.load=function(){n.getDataSource("selectNoOpenCourseware",{platformid:e.user.platformid,platformid1:e.user.platformid,classid:o.id,classid1:o.id},function(e){a["class"].courseList=e}),a.goSearch()}(),a.delCourseware=function(){if(confirm("确定要删除选中的课程吗")){var t=a.gridApi.selection.getSelectedRows();n.doArray("delete_sy_courseware_public",t,function(t){l({message:"删除成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),a.loadGrid()})}},a.addCourseDisabled=!0,a.addCourse=function(){a["class"].forAddCourse&&a["class"].forAddCourse.length>0&&(a.addCourseDisabled=!0,angular.forEach(a["class"].forAddCourse,function(e){e.coursewareid=e.id}),n.doArray("insert_sy_courseware_public",a["class"].forAddCourse,function(t){l({message:"添加成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),angular.forEach(a["class"].forAddCourse,function(e){_.remove(a["class"].courseList,{id:e.id})}),a["class"].forAddCourse=[],a.loadGrid()}))},a.$watch("class.forAddCourse",function(e){e.length>0?a.addCourseDisabled=!1:a.addCourseDisabled=!0}),a.publish=function(t){var i=0==t?"撤销发布":"发布";if(confirm("确定要"+i+"选中的课程吗")){for(var o=a.gridApi.selection.getSelectedRows(),r=[],s=0;s<o.length;s++)r.push({id:o[s].id,status:t});n.doArray("publish_sy_courseware_public",r,function(t){l({message:i+"成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),a.loadGrid()})}},a.ismain=function(t){var i=1==t?"设置首页显示":"取消首页显示";if(confirm("确定要将选中的课程"+i)){for(var o=a.gridApi.selection.getSelectedRows(),r=[],s=0;s<o.length;s++)r.push({id:o[s].id,ismain:t});n.doArray("ismain_sy_courseware_public",r,function(t){l({message:i+"成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),a.loadGrid()})}}}]),angular.module("myApp").controller("recommendcourseEditController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","$http","drawTable","CommonService","FilesService",function(e,t,a,n,i,o,r,l,s,c,d,u){e.course={teachers:[],videotype:0},e.isNew=!0,e.st={},e.checkedAnswer={},e.nowid=o.id,e.type=o.type,e.typeShow=!0,"1"==e.type&&(e.typeShow=!1),e.saveButtonDisabled=!1,e.uploadvideoFiles=function(t,a){e.course.videofile=t,e.process_videofile=0},e.viewMicroVideo=function(e){f(e.entity.videopath)},o.id&&(e.isNew=!1,i.getDataSource(["selectCoursewareById","selectCourseware_teacherRelation","getKeywordByCourseId"],{id:o.id,coursewareid:o.id},function(t){var a=_.find(t,function(e){return"selectCourseware_teacherRelation"==e.name});e.course=_.find(t,function(e){return"selectCoursewareById"==e.name}).data[0],e.course.teachers=a.data,e.nowfile=u.showFile("coursewarePhoto",e.course.imagephoto,e.course.imagephoto);var n=_.find(t,function(e){return"getKeywordByCourseId"==e.name}).data;e.course.courseKeywordOne=_.filter(n,function(e){return"关键词（一级）"==e.category}),e.course.courseKeywordTwo=_.filter(n,function(e){return"关键词（二级）"==e.category}),e.saveIsShareButtonDisabled=!1,1==e.course.isshare&&(e.saveIsShareButtonDisabled=!0,d.initInputControlDisabled())})),e.goback=function(){"1"==e.type?l.go("index.alumnusCourseware"):l.go("index.courseware")},e.uploadFiles=function(t){e.files=t},e.save=function(){e.files?u.upLoadPicture(e.files[0],{upcategory:"coursewarePhoto",width:200,height:120},function(t){e.course.imagephoto=t.data[0].servername,m()}):m()};var m=function(){if(e.saveButtonDisabled=!0,e.course.teachersid=d.getJoinString(e.course.teachers,"id"),e.course.teachersname=d.getJoinString(e.course.teachers,"name"),o.id)insertCourseRelation(o.id),insertCourseKeyWordRelation(o.id),i.getDataSource("updateCoursewareById",e.course,function(t){e.saveButtonDisabled=!1,r({message:"保存成功",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})},function(t){r({message:"保存失败",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.saveButtonDisabled=!1});else{var t=i.getGUID();e.course.id=t,insertCourseRelation(t),insertCourseKeyWordRelation(o.id),e.course.createplatformid=a.user.platformid,e.course.createuser=a.user.name,e.course.createtime=new Date,i.getDataSource("insertCourseware",e.course,function(n){e.saveButtonDisabled=!1;var o=new Object;o.platformid=a.user.platformid,o.coursewareid=t,o.coursewarename=e.course.name,o.isshare=0,i.getDataSource("insertPkgCourseware",o,function(e){l.go("index.coursewareEdit",{id:t})},function(e){})})}};e.openVideoPerview=function(t,a){0==e.course.videotype?f(a):p(e.course)};var f=function(a){e.modalInstance=t.open({templateUrl:"videoPerview.html",size:"lg",scope:e,resolve:{items:function(){return e.items}}}),n(function(){player=polyvObject("#divVideo").videoPlayer({width:"850",height:"490",vid:a})},0)};e.close=function(){e.modalInstance.dismiss("cancel")};var p=function(a){e.modalInstance=t.open({templateUrl:"doubluevideoPerview.html",size:"lg",scope:e,resolve:{items:function(){return e.items}}}),n(function(){player1=null,player2=null,player1=polyvObject("#doubleTeacher").videoPlayer({width:"100%",height:"560",vid:a.teachervideo,flashvars:{autoplay:"true",teaser_time:"0",start:"0",setScreen:"fill",ban_ui:"off",ban_control:"off",is_auto_replay:"on",ban_seek_by_limit_time:"off",ban_skin_progress_dottween:"on"}}),player2=polyvObject("#doublePPT").videoPlayer({width:"100%",height:"560",vid:a.pptvideo,flashvars:{autoplay:"true",teaser_time:"0",start:"0",setScreen:"fill",setVolumeM:"0",ban_ui:"off",ban_control:"off",is_auto_replay:"on",ban_seek_by_limit_time:"off",ban_skin_progress_dottween:"on"}})},0)},g=function(){var t=player1.j2s_getCurrentTime();if(e.course.videotype>0){var a=player2.j2s_getCurrentTime();t!=a&&player2.j2s_seekVideo(t)}};s2j_onVideoPlay=function(){player1.j2s_resumeVideo(),e.course.videotype>0&&player2.j2s_resumeVideo(),clearInterval(obj),obj=setInterval(g,5e3)},s2j_onVideoPause=function(){player1.j2s_pauseVideo(),e.course.videotype>0&&player2.j2s_pauseVideo(),clearInterval(obj)},e.uploadvideo=function(t){"videofile"==t?e.nowfile=e.course.videofile[0]:e.nowfile=e.course.pptfile[0];var n=/(?:\.([^.]+))?$/,i=n.exec(e.nowfile.name)[1],o=(new Date).getTime(),r=md5(o+a.appConfig.vhallConfig.writeToken),l={endpoint:a.appConfig.vhallConfig.uploadPath,resetBefore:$("#reset_before").prop("checked"),resetAfter:!1,title:"title",desc:"desc",ts:o,hash:r,userid:a.appConfig.vhallConfig.userid,ext:i,writeToken:a.appConfig.vhallConfig.writeToken};$(".progress").addClass("active"),upload=polyv.upload(e.nowfile,l).fail(function(e){alert("Failed because: "+e)}).always(function(){}).progress(function(a,n,i){var o=(n/i*100).toFixed(2);e["process_"+t]=o,e.$apply()}).done(function(a,n){"videofile"==t?(e.course.teachervideo=a.substring(a.lastIndexOf("/")+1),e.course.teachervideoname=n.name):(e.course.pptvideo=a.substring(a.lastIndexOf("/")+1),e.course.pptvideoname=n.name),e[t+"vid"]=a.substring(a.lastIndexOf("/")+1),e.$apply()})}}]).controller("videoPerviewCtrl",["$scope",function(e){}]),app.controller("syroleController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){var s={pageNumber:1,pageSize:25,sort:null};e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,useExternalPagination:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"角色名称",field:"name",width:"55%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.name}}</a></div>'},{name:"级别",field:"syslevel",width:"35%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"sysLevelFilter"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){s.pageNumber=t,s.pageSize=a,e.loadGrid()})}},e.goDetial=function(e){r.go("index.roleedit",{id:e.entity.id})},e.search={},e.loadGrid=function(){var a=(s.pageNumber-1)*s.pageSize,n=s.pageSize,i=["getRoleList"];l.getList(i,{platformid:t.user.platformid},{firstRow:a,pageSize:n},e.search,s.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data},function(e){})},e.loadGrid(),e.goSearch=function(){e.loadGrid()}}]),angular.module("myApp").controller("coursestatisticsController",["$scope","$rootScope","getDataSource","$state","notify",function(e,t,a,n,i){a.getDataSource("getAllCourseCategory",{platformid:t.user.platformid},function(t){e.categorylist=t,e.maincategorylist=_.filter(t,function(e){return 0==e.fid})},function(e){}),e.selectCategory=function(){e.search.subcategory="",e.subcategorylist=_.filter(e.categorylist,function(t){return t.fid==_.find(e.maincategorylist,{name:e.search.category}).id})};var o={pageNumber:1,pageSize:25,sort:null};e.search={},e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"课程名称",field:"coursewarename",width:"30%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"授课人",field:"teachersname",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"授课时间",field:"teachtime",width:"8%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.teachtime | date:"yyyy-MM-dd"}}</div>'},{name:"一级分类",field:"category",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"二级分类",field:"subcategory",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"排课次数",field:"classscheduling",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"点击次数",field:"clickcount",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"学习次数",field:"studycount",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"最后调用时间",field:"lastusetime",width:"10%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.lastusetime | date:"yyyy-MM-dd"}}</div>'}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){o.pageNumber=t,o.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)o.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),o.sort=n}e.loadGrid()})}},e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()},e.loadGrid=function(){var n=(o.pageNumber-1)*o.pageSize,i=o.pageSize;a.getList("getCoursewareReport",{platformid1:t.user.platformid,platformid2:t.user.platformid},{firstRow:n,pageSize:i},e.search,o.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadGrid()}]),angular.module("myApp").controller("coursewareclickController",["$scope","$rootScope","getDataSource","$state","notify",function(e,t,a,n,i){var o={pageNumber:1,pageSize:25,sort:null},r=new Date;e.yearlist=[{year:r.getFullYear()-1},{year:r.getFullYear()},{year:r.getFullYear()+1}],e.search={platformid:t.user.platformid,year:r.getFullYear(),month:r.getMonth()+1},e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"课程名称",field:"coursewarename",width:"30%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"授课人",field:"teachersname",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"授课时间",field:"teachtime",width:"8%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.teachtime | date:"yyyy-MM-dd"}}</div>'},{name:"一级分类",field:"category",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"二级分类",field:"subcategory",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"点击次数",field:"clickcount",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"最后调用时间",field:"lastusetime",width:"10%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.lastusetime | date:"yyyy-MM-dd"}}</div>'}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){o.pageNumber=t,o.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)o.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),o.sort=n}e.loadGrid()})}},e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()},e.loadGrid=function(){1==o.pageNumber&&a.getDataSource("getCoursewareCategoryClickReport",{platformid:t.user.platformid,platformid1:t.user.platformid,starttime:e.search.year.toString()+"-01",endtime:e.search.year.toString()+"-"+(e.search.month<10?"0"+e.search.month.toString():e.search.month)},function(e){var t=new Array,a=new Array,n=0;angular.forEach(e,function(e){n+=e.clickcount});for(var i=0;i<e.length;i++)t.push(e[i].category),a.push(parseFloat((e[i].clickcount/parseFloat(n)*100).toFixed(2)));l(t,a)},function(e){});var n=(o.pageNumber-1)*o.pageSize,i=o.pageSize;a.getList("getCoursewareClickReport",{platformid:t.user.platformid,platformid1:t.user.platformid,starttime:e.search.year.toString()+"-01",endtime:e.search.year.toString()+"-"+(e.search.month<10?"0"+e.search.month.toString():e.search.month)},{firstRow:n,pageSize:i},null,o.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadGrid();var l=function(e,t){$("#container").highcharts({chart:{type:"column"},title:{text:"课程点击情况分析图"},xAxis:{categories:e,title:{text:null}},yAxis:{min:0,title:{text:null}},tooltip:{headerFormat:'<span style="font-size:11px">{point.x}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> of total<br/>'},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y:.2f}%"}}},legend:{enabled:!1},credits:{enabled:!1},series:[{name:"一级分类",data:t
}]})}}]),angular.module("myApp").controller("coursewareschedulingController",["$scope","$rootScope","getDataSource","$state","notify",function(e,t,a,n,i){var o={pageNumber:1,pageSize:25,sort:null},r=new Date;e.yearlist=[{year:r.getFullYear()-1},{year:r.getFullYear()},{year:r.getFullYear()+1}],e.search={platformid:t.user.platformid,year:r.getFullYear(),month:r.getMonth()+1},e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"课程名称",field:"coursewarename",width:"30%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"授课人",field:"teachersname",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"授课时间",field:"teachtime",width:"8%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.teachtime | date:"yyyy-MM-dd"}}</div>'},{name:"一级分类",field:"category",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"二级分类",field:"subcategory",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"排课次数",field:"classscheduling",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"最后调用时间",field:"lastusetime",width:"10%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.lastusetime | date:"yyyy-MM-dd"}}</div>'}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){o.pageNumber=t,o.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)o.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),o.sort=n}e.loadGrid()})}},e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()},e.loadGrid=function(){1==o.pageNumber&&a.getDataSource("getCoursewareCategoryschedulingReport",{platformid:t.user.platformid,starttime:e.search.year.toString()+"-01",endtime:e.search.year.toString()+"-"+(e.search.month<10?"0"+e.search.month.toString():e.search.month)},function(e){var t=new Array,a=new Array,n=0;angular.forEach(e,function(e){n+=e.classscheduling});for(var i=0;i<e.length;i++)t.push(e[i].category),a.push(parseFloat((e[i].classscheduling/parseFloat(n)*100).toFixed(2)));l(t,a)},function(e){});var n=(o.pageNumber-1)*o.pageSize,i=o.pageSize;a.getList("getCoursewareschedulingReport",{platformid:t.user.platformid,starttime:e.search.year.toString()+"-01",endtime:e.search.year.toString()+"-"+(e.search.month<10?"0"+e.search.month.toString():e.search.month)},{firstRow:n,pageSize:i},null,o.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadGrid();var l=function(e,t){$("#container").highcharts({chart:{type:"column"},title:{text:"课程排课情况分析图"},xAxis:{categories:e,title:{text:null}},yAxis:{min:0,title:{text:null}},tooltip:{headerFormat:'<span style="font-size:11px">{point.x}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> of total<br/>'},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y:.2f}%"}}},legend:{enabled:!1},credits:{enabled:!1},series:[{name:"一级分类",data:t}]})}}]),angular.module("myApp").controller("studentstatisticsController",["$scope","$rootScope","getDataSource","$state","notify",function(e,t,a,n,i){a.getDataSource("getAllCourseCategory",{platformid:t.user.platformid},function(t){e.categorylist=t,e.maincategorylist=_.filter(t,function(e){return 0==e.fid})},function(e){}),e.selectCategory=function(){e.search.subcategory="",e.subcategorylist=_.filter(e.categorylist,function(t){return t.fid==_.find(e.maincategorylist,{name:e.search.category}).id})};var o=new Date;e.yearlist=[{year:o.getFullYear()-1},{year:o.getFullYear()},{year:o.getFullYear()+1}],e.search={platformid:t.user.platformid,year:o.getFullYear(),month:o.getMonth()+1,category:0,datacategory:0},e.gridOptions={useExternalPagination:!1,useExternalSorting:!0,enablePaginationControls:!1,enableSorting:!1,data:[],columnDefs:[{name:"职级/班级",field:"item",width:"25%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"总计",field:"itemcount",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"报到",field:"signcount",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"0%-20%",field:"level1",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"20%-40%",field:"level2",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"40%-60%",field:"level3",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"60%-80%",field:"level4",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"80%-100%",field:"level5",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"100%以上",field:"level6",width:"8%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"未报到",field:"unsigncount",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"已结业",field:"graduatecount",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"}]},e.goSearch=function(){e.search.datacategory=0,e.loadGrid()},e.loadGrid=function(){a.getUrlData("../api/getStudentStatistics",e.search,function(t){e.studentstatisticsData=t,e.gridOptions.data=e.studentstatisticsData},function(e){})},e.loadGrid();var r=function(e,t){return(0==t||0==e?0:(parseFloat(e)/parseFloat(t)*100).toFixed(1))+"%"};e.changeDataCategory=function(t){if(0==t)e.gridOptions.data=e.studentstatisticsData;else{for(var a=angular.copy(e.studentstatisticsData),n=0;n<a.length;n++)a[n].level1=r(a[n].level1,a[n].signcount),a[n].level2=r(a[n].level2,a[n].signcount),a[n].level3=r(a[n].level3,a[n].signcount),a[n].level4=r(a[n].level4,a[n].signcount),a[n].level5=r(a[n].level5,a[n].signcount),a[n].level6=r(a[n].level6,a[n].signcount),a[n].unsigncount=r(a[n].unsigncount,a[n].itemcount),a[n].graduatecount=r(a[n].graduatecount,a[n].signcount),a[n].signcount=r(a[n].signcount,a[n].itemcount);e.gridOptions.data=a}}}]),angular.module("myApp").controller("roleEditController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource",function(e,t,a,n,i,o,r,l){e.roleForm=new Object,e.roleForm.name="",e.roleForm.enable=!1,e.roleForm.syslevel=!1,e.roleForm.platform=new Object,e.saveButtonDisabled=!1,"0"==t.user.platformcategory&&(e.choosePlatform=!0,e.chooseSysLevel=!0);var s=i.id;if(void 0!=s&&""!=s)l.getDataSource("getSigleRole",{roleid:s},function(t){e.roleForm=t[0],e.roleForm.enable=1==t[0].enable,e.roleForm.syslevel=1==t[0].syslevel;for(var a=(new Array,t.length),n=new Object,i=0;a>i;i++)n=new Object,n.id=t[i].platformid,n.name=t[i].platformname;e.roleForm.platform=n},function(e){});else{var c=new Object;c.id=t.user.platformid,c.name=t.user.platformname,e.roleForm.platform=c}l.getDataSource("selectAllPlatform",{},function(t){for(var a=new Array,n=t.length,i=0;n>i;i++)a.push({id:t[i].id,name:t[i].name});e.platforms=a},function(e){}),e.goToList=function(){r.go("index.role")},e.saveRole=function(){return e.saveButtonDisabled=!0,""==e.roleForm.name||e.roleForm.name.length<=0?(e.saveButtonDisabled=!1,void o({message:"角色名称不能为空",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})):void l.getUrlData("../api/Permission/SaveRole",e.roleForm,function(a){e.saveButtonDisabled=!1,o("success"==a.code?{message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}:{message:a.message,classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(t){e.saveButtonDisabled=!1})},l.getDataSource(["getAllPermission","getAllPermissionGroup","getRolePermission"],{roleid:s},function(t){var a=_.find(t,{name:"getAllPermissionGroup"}).data,n=_.find(t,{name:"getAllPermission"}).data,i=_.find(t,{name:"getRolePermission"}).data,o=a.length,r="";e.roleForm.permissionGroupList=new Array;for(var l=0;o>l;l++){r=a[l].groupname,category=a[l].category;for(var s=_.filter(n,{groupname:r}),c=s.length,d=0;c>d;d++){var u=_.find(i,{permissionid:s[d].id});null!=u&&(s[d].selected=!0)}e.roleForm.permissionGroupList.push({groupname:r,category:category,permissionArray:s})}},function(e){})}]),angular.module("myApp").controller("scoreController",["$scope","$rootScope","getDataSource","$state","notify",function(e,t,a,n,i){var o={pageNumber:1,pageSize:25,sort:null};e.search={},e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,data:[],columnDefs:[{name:"序号",field:"rownum",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"维度",field:"dimension",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"加分项",field:"eventname",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.eventname}}</a></div>'},{name:"分值",field:"score",width:"20%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"最高得分",field:"maxscore",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"限制类型",field:"limittype",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"limittypeFilters"}],onRegisterApi:function(t){e.gridApi=t}},e.loadSource=function(){var t=(o.pageNumber-1)*o.pageSize,n=o.pageSize;a.getList("getDimensionConfigAll",{},{firstRow:t,pageSize:n},e.search,o.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadSource(),e.goSearch=function(){e.loadSource()},e.goDetial=function(e){n.go("index.scoreEdit",{id:e.entity.id})},e["delete"]=function(){var n=e.gridApi.selection.getSelectedRows();a.doArray("deleteDimensionConfigById",n,function(a){i({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadSource()})}}]),angular.module("myApp").controller("scoreEditController",["$scope","$rootScope","getDataSource","$stateParams","notify","FilesService","$state",function(e,t,a,n,i,o,r){e.score={};(function(){n.id&&a.getDataSource("selectDimensionConfigById",{id:n.id},function(t){e.score=t[0]})})();e.addDisabled=!1,e.save=function(){if(e.addDisabled=!0,""==e.score.dimension||void 0==e.score.dimension||null==e.score.dimension)return i({message:"请选择维度名称！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.addDisabled=!1);if(""==e.score.eventname||void 0==e.score.eventname||null==e.score.eventname)return i({message:"加分项不能为空！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.addDisabled=!1);if(""==e.score.score||void 0==e.score.score||null==e.score.score)return i({message:"分值不能为空！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.addDisabled=!1);if(""==e.score.limittype||void 0==e.score.limittype||null==e.score.limittype)return i({message:"请选择限制类型！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.addDisabled=!1);if(""==e.score.maxscore||void 0==e.score.maxscore||null==e.score.maxscore)return i({message:"最高得分不能为空！",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),void(e.addDisabled=!1);if(n.id){var o="保存成功";a.getDataSource("updateDimensionConfigById",e.score,function(a){e.addDisabled=!1,i({message:o,classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(t){e.addDisabled=!1})}else{var l=a.getGUID();e.score.id=l,a.getDataSource("insertDimensionConfig",e.score,function(a){e.addDisabled=!1,i({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),r.go("index.score",{})},function(t){e.addDisabled=!1})}},e.goToList=function(){r.go("index.score")},e.inputKeyDown=function(e){var t=window.event||e;t.keyCode>47&&t.keyCode<58||8==t.keyCode||t.preventDefault()}}]),angular.module("myApp").controller("statisticsIndexController",["$scope","$rootScope","getDataSource","$state","notify",function(e,t,a,n,i){e.statisticsdata={},e.loadData=function(){a.getDataSource("statistics-index",{platformid1:t.user.platformid,platformid2:t.user.platformid,platformid3:t.user.platformid,platformid4:t.user.platformid},function(t){null!=t&&void 0!=t&&t.length>0&&(e.statisticsdata=t[0])})},e.loadData(),setInterval(function(){e.loadData()},5e3)}]),angular.module("myApp").controller("statisticsIndexroleController",["$scope","$rootScope","getDataSource","$state","notify",function(e,t,a,n,i){e.gridOptions={data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"平台",field:"name",width:"34%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"用户人数",field:"studentcount",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"在线人数",field:"onlineusercount",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"当前班次",field:"onlineclasscount",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"历史班次",field:"historyclasscount",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(t){e.gridApi=t}},e.loadIndexData=function(){a.getDataSource("statistics-platformindexall",{},function(t){e.gridOptions.data=t}),e.statisticsdata={},a.getDataSource("statistics-indexall",{},function(t){null!=t&&void 0!=t&&t.length>0&&(e.statisticsdata=t[0])})},e.loadIndexData(),setInterval(function(){e.loadIndexData()},1e4)}]),angular.module("myApp").controller("teacherEditController",["$scope","$rootScope","getDataSource","$stateParams","notify","FilesService","$state",function(e,t,a,n,i,o,r){e.teacher={photofilename:"",accountid:"",photoserverfilename:"",sex:-1},e.uploadFiles=function(t){e.files=t};(function(){n.id&&a.getDataSource("selectTeacherById",{id:n.id},function(t){e.teacher=t[0],e.nowfile=o.showFile("teacherPhoto",e.teacher.photo_servername,e.teacher.photo_servername)})})();e.saveDisabled=!1,e.save=function(){e.saveDisabled=!0,e.files?o.upLoadPicture(e.files[0],{upcategory:"teacherPhoto",width:500,height:300},function(t){e.teacher.photo_servername=t.data[0].servername,l()},function(t){e.saveDisabled=!1}):l()},e.getFile=function(){""!=e.teacher.photofilename};var l=function(){if(n.id)a.getDataSource("updateTeacherById",e.teacher,function(a){e.saveDisabled=!1,i({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})},function(t){e.saveDisabled=!1});else{var o=a.getGUID();e.teacher.id=o,e.teacher.platformid=t.user.platformid,a.getDataSource("insertTeacher",e.teacher,function(a){i({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.saveDisabled=!1,r.go("index.teacherEdit",{id:o})},function(t){e.saveDisabled=!1})}},s={pageNumber:1,pageSize:25,sort:null};e.search={},e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"7%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"课程名称",field:"name",width:"45%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"授课人",field:"teachersname",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"授课时间",field:"teachtime",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"date:'yyyy-MM-dd'"},{name:"状态",field:"mainstatus",width:"13%",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"mainStatusFilters"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){s.pageNumber=t,s.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)s.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),s.sort=n}e.loadGrid()})}},e.loadGrid=function(){var i=(s.pageNumber-1)*s.pageSize,o=s.pageSize,r="selectTeacherCourseware";a.getList(r,{platformid:t.user.platformid,teacherid:n.id},{firstRow:i,pageSize:o},e.search,s.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadGrid()}]),angular.module("myApp").controller("teacherListController",["$rootScope","$scope","getDataSource","$state","notify",function(e,t,a,n,i){var o={pageNumber:1,pageSize:25,sort:null};t.search={},t.goSearch=function(){t.loadGrid()},t.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"序号",width:"6%",field:"rownum",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"教师姓名",width:"15%",field:"name",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.name}}</a></div>',cellClass:"mycenter",headerCellClass:"mycenter"},{name:"性别",width:"10%",field:"sexshowvalue",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"专业方向",width:"15%",field:"subject",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"最高学历",width:"11%",field:"education",cellFilter:"educationFilter",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"职称",width:"15%",field:"position",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"单位",width:"20%",field:"company",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"关联课程数",width:"6%",field:"scount",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(e){t.gridApi=e,e.pagination.on.paginationChanged(t,function(e,a){o.pageNumber=e,o.pageSize=a,t.loadGrid()}),e.core.on.sortChanged(t,function(e,a){if(0==a.length)o.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),o.sort=n}t.loadGrid()})}},t["delete"]=function(){var n=t.gridApi.selection.getSelectedRows();a.doArray("delete_sy_TeacherById",n,function(a){i({message:"删除成功",classes:"alert-info",templateUrl:e.appConfig.defaultNoticeUrl}),t.loadGrid()})},t.loadGrid=function(){var n=(o.pageNumber-1)*o.pageSize,i=o.pageSize;a.getList("selectAllTeacher",{platformid:e.user.platformid},{firstRow:n,pageSize:i},t.search,o.sort,function(e){t.gridOptions.totalItems=e[0].allRowCount,t.gridOptions.data=e[0].data})},t.loadGrid(),t.goDetial=function(e){n.go("index.teacherEdit",{id:e.entity.id})}}]),app.controller("IeTest1Ctrl",["$rootScope","$http","$scope","$timeout","$state","$stateParams",function(e,t,a,n,i,o){a.datalist=new Array,a.showtable=!1,a.open1w=function(e){a.datalist=new Array;for(var t=0;1e4>t;t++);},a.open1k=function(e){a.datalist=new Array,t.get("../testJSON/json1.json").success(function(e){a.datalist=e})},a.goSQL=function(){i.go("getSQL")},a.Change=function(){a.showtable=!a.showtable},a.open1k("Btn1_"),a.HrefTo=function(e){i.go(e)}}]),app.controller("IeTest2Ctrl",["$rootScope","$http","$scope","$timeout","$state","$stateParams",function(e,t,a,n,i,o){a.datalist=new Array,a.open1w=function(e){a.datalist=new Array;for(var t=0;1e4>t;t++)a.datalist.push({id:t,name:"test_"+e+"_1w_"+t,sex:"男",age:"20"})},a.open1k=function(e){a.datalist=new Array;for(var t=0;500>t;t++)a.datalist.push({id:t,name:"test_"+e+"_1k_"+t,sex:"男",age:"20"})},a.open1k("Btn2_"),a.HrefTo=function(e){i.go(e)}}]),app.controller("IeTest3Ctrl",["$rootScope","$http","$scope","$timeout",function(e,t,a,n){a.datalist=new Array,a.open1w=function(e){a.datalist=new Array;for(var t=0;1e4>t;t++)a.datalist.push({name:"test_"+e+"_1w_"+t,sex:"男",age:"20"})},a.open1k=function(e){a.datalist=new Array;for(var t=0;1e3>t;t++)a.datalist.push({name:"test_"+e+"_1k_"+t,sex:"男",age:"20"})}}]),app.controller("IeTest4Ctrl",["$rootScope","$http","$scope","$timeout",function(e,t,a,n){a.datalist=new Array,a.open1w=function(e){a.datalist=new Array;for(var t=0;1e4>t;t++)a.datalist.push({name:"test_"+e+"_1w_"+t,sex:"男",age:"20"})},a.open1k=function(e){a.datalist=new Array;for(var t=0;1e3>t;t++)a.datalist.push({name:"test_"+e+"_1k_"+t,sex:"男",age:"20"})}}]),app.controller("IeTest5Ctrl",["$rootScope","$http","$scope","$timeout",function(e,t,a,n){a.datalist=new Array,a.open1w=function(e){a.datalist=new Array;for(var t=0;1e4>t;t++)a.datalist.push({name:"test_"+e+"_1w_"+t,sex:"男",age:"20"})},a.open1k=function(e){a.datalist=new Array;for(var t=0;1e3>t;t++)a.datalist.push({name:"test_"+e+"_1k_"+t,sex:"男",age:"20"})}}]),app.controller("IeTest6Ctrl",["$rootScope","$http","$scope","$timeout",function(e,t,a,n){a.datalist=new Array,a.open1w=function(e){a.datalist=new Array;for(var t=0;1e4>t;t++)a.datalist.push({name:"test_"+e+"_1w_"+t,sex:"男",age:"20"})},a.open1k=function(e){a.datalist=new Array;for(var t=0;1e3>t;t++)a.datalist.push({name:"test_"+e+"_1k_"+t,sex:"男",age:"20"})}}]),app.controller("testfileuploadController",["$scope","$rootScope","Upload","FilesService","Base64",function(e,t,a,n,i){e.files=[],e.doclick=function(){$("#myfile").click()},e.uploadFiles=function(t,a){e.files=t,e.img1=t[0];var n=new FileReader;n.onload=function(t){e.$apply(function(e){e.myImage=t.target.result})},n.readAsDataURL(file)},e.doUpload=function(){n.upLoadFiles(e.myfiles,"userPhoto")},e.down=function(){n.downFiles("userPhoto","cccc.png","cccc.png")}}]),angular.module("myApp").controller("totalvistorController",["$scope","$rootScope","$state","$http","$timeout","$document","notify","getDataSource","DateService","CommonService",function(e,t,a,n,i,o,r,l,s,c){var d=[],u=[],m=["getlogchartdata"];e.search={},l.getConnKeyList(m,{platformid:t.user.platformid},null,null,null,{connectionKey:"LogConnectionString"},function(t){var a=t.length,n=new Object;n.name="访问",n.data=[];for(var i=0;a>i;i++)d.push(t[i].itemname),n.data.push(t[i].totalnum);u.push(n),e.chartOnlineUserConfig={options:{chart:{type:"bar"}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-40,y:80,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF",shadow:!0},xAxis:{categories:d,title:{text:null}},yAxis:{min:0,title:{text:"访问人次",align:"high"},labels:{overflow:"justify"}},series:u,title:{text:"访问统计"},tooltip:{valueSuffix:" 人次"},credits:{enabled:!1},loading:!1,plotOptions:{bar:{dataLabels:{enabled:!0}}}}},function(e){})}]),angular.module("myApp").controller("trainlistController",["$scope","$modal","$rootScope","$timeout","getDataSource","$stateParams","notify","$state","drawTable","CommonService","DateService",function(e,t,a,n,i,o,r,l,s,c,d){var u=(new Date).getFullYear()-5,m=(new Date).getFullYear();e.yearArr=[];for(var f=u;m>=f;f++)e.yearArr.push(f);var p={pageNumber:1,pageSize:25,sort:null};e.search={};var g=(new Date).getFullYear();n(function(){e.search.year=g;var t=a.user.mdepartmentId;2==a.user.usertype&&(t=a.user.departmentId),e.search.departmentid=t,e.loadGrid()},500),e.goSearch=function(){e.gridOptions.paginationCurrentPage=1,e.loadGrid()},e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,useExternalPagination:!0,columnDefs:[{name:"培训名称",width:"30%",field:"title",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goAudit(row)">{{row.entity.title}}</a>'},{name:"姓名",width:"10%",field:"name",headerCellClass:"mycenter"},{name:"组织机构",width:"20%",field:"departmentname",headerCellClass:"mycenter"},{name:"一级分类",width:"10%",field:"categoryone",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"二级分类",width:"10%",field:"categorytwo",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"三级分类",width:"10%",field:"categorythree",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"四级分类",width:"10%",field:"categoryfour",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"申报年份",width:"10%",field:"year",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"拟报学时",width:"10%",field:"studytime",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"状态",width:"10%",field:"status",cellClass:"mycenter",headerCellClass:"mycenter",cellFilter:"trainStatuFilters"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){p.pageNumber=t,p.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)p.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),p.sort=n}e.loadGrid()})}},e.goAudit=function(a){e.train=a.entity,e.modalInstance=t.open({templateUrl:"audit.html",size:"lg",scope:e})},e.close=function(){e.modalInstance.dismiss("cancel")},e.saveDisabled=!1,e.goSubmitAudia=function(t,n){var o={status:n,id:t.id,remark:t.remark};return null==o.remark||""==o.remark?void r({message:"请输入审核意见",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}):(e.saveDisabled=!0,void i.getDataSource("submitrain",o,function(i){i[0]&&i[0].crow>0&&(r({message:"操作成功",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl}),e.train.status=n,e.train.remark=t.remark,e.close(),e.loadGrid()),e.saveDisabled=!1},function(e){}))},e.loadGrid=function(){var t=(p.pageNumber-1)*p.pageSize,a=p.pageSize,n=["back_gettrain"];i.getList(n,e.search,{firstRow:t,pageSize:a},{},p.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data},function(e){})},e["delete"]=function(){var t=e.gridApi.selection.getSelectedRows();null!=t&&void 0!=t&&t.length>0&&i.doArray(["delete_sy_train"],t,function(t){e.loadGrid(),r({message:"删除成功",classes:"alert-info",templateUrl:a.appConfig.defaultNoticeUrl})})}}]),app.controller("departusertreeController",["$scope","$rootScope","$state","$http","$timeout","$document","$modal","notify","getDataSource","DateService","CommonService",function(e,t,a,n,i,o,r,l,s,c,d){function u(e,t,a){var n={label:a.name,rowid:a.id,children:[],isedit:a.category},i=_.filter(t,{fid:a.id}),o=i.length;if(o>0)for(var r=0;o>r;r++)u(n,t,i[r]);e.children.push(n)}e.my_data=new Array,e.my_tree=tree={},e.loadDepartTree=function(){s.getDataSource(["selectDepartRoot","selectDepartAll"],{platformid:t.user.platformid},function(t){var a=_.find(t,{name:"selectDepartAll"}),n=_.find(t,{name:"selectDepartRoot"}).data[0],i=new Object;i.label=n.name,i.rowid=n.id,i.children=new Array,u(i,a,n),e.my_data.push(i),e.doing_async=!1,tree.expand_all()},function(e){})},e.try_async_load=function(){e.my_data=new Array,e.doing_async=!0,e.loadDepartTree()},e.try_async_load()}]),angular.module("myApp").controller("userEditController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$state","getDataSource","$validation",function(e,t,a,n,i,o,r,l,s){e.accForm={submit:function(){}},e.initForm=function(t,a){e.accForm.rolelist=new Array,e.accForm.name="",e.accForm.sex=0,e.accForm.logname="",e.accForm.lognameDisabled=!1,e.accForm.pwdDisabled=!1,e.accForm.idcardDisabled=!1,e.accForm.nameDisabled=!1,a&&(e.accForm.pwd="",e.pwd=""),e.accForm.cellphone="",t&&(e.accForm.idcard=""),e.accForm.syuserid="",e.accForm.status=0,e.accForm.checkstatus=!1,e.accForm.accisnew=!0,e.accForm.syuserisnew=!0},e.initForm(!0,!0);var c="******";e.goToList=function(){r.go("index.userlist")};var d=i.id;l.getDataSource("getRoleList",{platformid:t.user.platformid},function(a){for(var n=new Object,i=new Array,o=a.length,r=0;o>r;r++)n=new Object,n.id=a[r].id,n.name=a[r].name,n.platformid=a[r].platformid,i.push(n);e.roles=i,d?(e.accForm.syuserisnew=!1,e.accForm.syuserid=d,l.getDataSource(["getSyUserByAccId","getAccountRoleByUserId"],{syuserid:d,platformid:t.user.platformid},function(t){e.accForm=_.find(t,{name:"getSyUserByAccId"}).data[0],e.pwd=c,e.accForm.pwd=c,e.accForm.checkstatus=1==e.accForm.status,e.accForm.accisnew=!1,e.accForm.syuserisnew=!1;var a=_.find(t,{name:"getAccountRoleByUserId"}).data,n=_.filter(a,{syuserid:d});e.accForm.lognameDisabled=!0,e.accForm.nameDisabled=!0,e.accForm.idcardDisabled=!0;for(var i=new Object,o=new Array,r=n.length,l=0;r>l;l++)i=new Object,i.id=n[l].id,i.name=n[l].name,i.platformid=n[l].platformid,o.push(i);e.accForm.rolelist=o},function(e){})):(e.accForm.syuserisnew=!0,e.accForm.lognameDisabled=!1,e.accForm.pwdDisabled=!1)},function(e){}),e.idcardInvalidClearMsg=function(){e.inValidIdCardMessage=""},e.remoteCheckIdCard=function(t){e.inValidIdCardMessage="",e.accForm.idcard.length<=0||t||l.getDataSource(["getAccountInfoByIdCard","getAccountRoleByIdcard"],{idcard:e.accForm.idcard},function(t){var a=_.find(t,{name:"getAccountInfoByIdCard"}).data,n=_.find(t,{name:"getAccountRoleByIdcard"}).data;if(a.length>0){var i=a[0];e.accForm.name=i.name,e.accForm.sex=i.sex,e.accForm.logname=i.logname,e.accForm.pwd=c,e.pwd=c,e.accForm.cellphone=i.cellphone,e.accForm.defaultusertype=i.defaultusertype,e.accForm.status=0,e.accForm.checkstatus=!1,e.accForm.accountid=i.id,e.accForm.accisnew=!1,e.accForm.lognameDisabled=!0,e.accForm.nameDisabled=!0;for(var o=new Array,r=n.length,l=0;r>l;l++)roletemp=new Object,roletemp.id=n[l].id,roletemp.platformid=n[l].platformid,roletemp.name=n[l].name,o.push(roletemp);e.accForm.rolelist=o}else e.initForm(!1,!0)},function(e){})},e.remoteCheckLogname=function(t){e.lognameInvalidMsg="",void 0==e.accForm.logname||e.accForm.logname.length<6||e.accForm.logname.length>18||t||l.getDataSource(["getAccountByLogname"],{formlogname:e.accForm.logname},function(t){t.length>0?e.lognameInvalidMsg="该账号已经被使用。":e.lognameInvalidMsg=""},function(e){})},e.lognameInvalidMsgClear=function(){e.lognameInvalidMsg=""},e.saveButtonDisabled=!1,e.saveSyUser=function(){e.saveButtonDisabled=!0;var a=e.accForm;e.pwd!=c&&(a.pwd=md5(e.pwd)),l.getUrlData("../api/account/SaveSyUser",a,function(a){e.saveButtonDisabled=!1,"success"==a.code?(o({message:"保存成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),r.go("index.useredit",{id:a.id})):o({message:a.message,classes:"alert-danger",templateUrl:t.appConfig.defaultNoticeUrl})},function(t){e.saveButtonDisabled=!1})}}]),app.controller("userListController",["$scope","$rootScope","$modal","$timeout","$stateParams","notify","$modal","$state","getDataSource",function(e,t,a,n,i,o,a,r,l){var s={pageNumber:1,pageSize:25,sort:null};e.gridOptions={paginationPageSizes:[25,50,75],paginationPageSize:25,useExternalPagination:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"登录名",field:"logname",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.logname}}</a></div>'},{name:"姓名",field:"name",width:"15%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"联系方式",field:"cellphone",width:"30%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"工作单位",field:"company",width:"30%",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){s.pageNumber=t,s.pageSize=a,e.loadData()})}},e.ok=function(){e.isAccept=!0;var a=e.gridApi.selection.getSelectedRows();l.doArray("delSyuserLogic",a,function(){o({message:"删除成功",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl}),e.loadData()},function(e){o({message:"删除失败",classes:"alert-info",templateUrl:t.appConfig.defaultNoticeUrl})}),e.close()},e.close=function(){e.modalInstance.dismiss("cancel")},e.delSyUser=function(){e.modalInstance=a.open({templateUrl:"confirm.html",size:"sm",scope:e})},e.search={},e.goDetial=function(e){r.go("index.useredit",{id:e.entity.id})},e.loadData=function(){var a=(s.pageNumber-1)*s.pageSize,n=s.pageSize,i=["getPlatformUserAccountList"];l.getList(i,{platformid:t.user.platformid},{firstRow:a,pageSize:n},e.search,s.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data},function(e){})},e.loadData(),e.goSearch=function(){e.loadData()}}]),angular.module("myApp").controller("userfeedbackController",["$scope","$rootScope","getDataSource","$state","$modal","notify","CommonService",function(e,t,a,n,i,o){var r={pageNumber:1,pageSize:25,sort:[{sort:{priority:0,direction:"desc"},name:"createtime"}]};e.goDetial=function(t){e.feedback=t,e.modalInstance=i.open({templateUrl:"feedbackDetail.html",size:"lg",scope:e})},e.close=function(){e.modalInstance.dismiss("cancel")},e.search={},e.gridOptions={paginationPageSizes:[25,50,100],paginationPageSize:25,useExternalPagination:!0,useExternalSorting:!0,data:[],columnDefs:[{name:"序号",field:"rownum",width:"6%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"标题",field:"title",width:"24%",headerCellClass:"mycenter",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.goDetial(row)">{{row.entity.title}}</a>'},{name:"内容",field:"content",width:"50%",headerCellClass:"mycenter"},{
name:"反馈人",field:"username",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"},{name:"反馈时间",field:"createtime",width:"10%",cellClass:"mycenter",headerCellClass:"mycenter"}],onRegisterApi:function(t){e.gridApi=t,t.pagination.on.paginationChanged(e,function(t,a){r.pageNumber=t,r.pageSize=a,e.loadGrid()}),t.core.on.sortChanged(e,function(t,a){if(0==a.length)r.sort=null;else{var n=[];angular.forEach(a,function(e){n.push({sort:e.sort,name:e.field})}),r.sort=n}e.loadGrid()})}},e.goSearch=function(){e.loadGrid()},e.loadGrid=function(){var t=(r.pageNumber-1)*r.pageSize,n=r.pageSize;a.getList("get_sy_user_feedback",{},{firstRow:t,pageSize:n},e.search,r.sort,function(t){e.gridOptions.totalItems=t[0].allRowCount,e.gridOptions.data=t[0].data})},e.loadGrid()}]),angular.module("myApp").controller("departmentController",["$rootScope","$scope","getDataSource","$state","$stateParams","notify","$modal","FilesService","DateService","$timeout",function(e,t,a,n,i,o,r,l,s,c){}]);