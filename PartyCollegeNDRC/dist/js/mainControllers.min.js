app.controller("bookInfoController",["$rootScope","$scope","$http","$location","getDataSource","DateService","GetFileService","CommonService","$stateParams","$sce",function(e,o,n,t,i,r,a,c,s,l){o.chooseMenu();var u=s.id;i.getDataSource("getBookInfo",{id:u},function(e){o.bookinfo=e[0],o.bookinfo.comment=l.trustAsHtml(o.bookinfo.comment),o.bookinfo.cover_servername=a.showFile("bookPhoto",o.bookinfo.cover_servername,o.bookinfo.cover_servername)},function(e){}),o.tobooklist=function(){location.href="../html/index.html#/main/booklist"}}]),app.controller("bookListController",["$rootScope","$scope","$http","$location","getDataSource","DateService","GetFileService","CommonService","$stateParams","$sce",function(e,o,n,t,i,r,a,c,s,l){o.chooseMenu(),o.currentPageIndex=1,o.currentPageSize=12,o.bookData=[],o.moreShow=!1,o.loadMore=function(){u("more")},o.getImg=function(e,o,n){return a.showFile(n,e,o)};var u=function(n){i.getDataSource("getBookList",{pageindex:parseInt((o.currentPageIndex-1)*o.currentPageSize),pagesize:parseInt(o.currentPageSize),platformid:e.user.platformid,keywords:""},function(e){e&&e.length>0?(o.bookData=_.union(o.bookData,e),o.currentPageIndex++,e.length>=o.currentPageSize?o.moreShow=!0:o.moreShow=!1):n&&"more"==n&&(o.moreShow=!1,c.alert("没有更多数据了"))},function(e){})};u(),o.openBookinfo=function(o){e.user&&e.user.isLogin?location.href="../html/index.html#/main/bookInfo/"+o:c.alert("请登录")}}]),app.controller("helpController",["$rootScope","$scope","$http","$location","getDataSource","DateService","GetFileService","CommonService","$stateParams","$sce",function(e,o,n,t,i,r,a,c,s,l){o.chooseMenu();var u=e.appConfig.operationManualImgCount;o.maxSize=u,o.totalItems=u,o.pageSize=1,o.currentPage=1,o.pageChanged=function(){o.helpimg=a.showFile("operationManual",o.currentPage+".jpg",o.currentPage+".jpg")},o.pageChanged(),o.downloadpdf=function(){var e=a.showFile("operationManual","help.pdf","help.pdf");window.open(e)}}]),app.controller("downloadController",["$rootScope","$scope","$http","$location","getDataSource","DateService","GetFileService","CommonService","$stateParams","$sce","FilesService",function(e,o,n,t,i,r,a,c,s,l,u){o.chooseMenu(),i.getDataSource("getIndexMaterial",{},function(e){o.materialdata=_.filter(e,function(e){return 1==e.category});for(var n=_.filter(e,function(e){return 2==e.category}),t=0;t<n.length;t++)n[t].attach_logo=a.showFile("download",n[t].attach_logo,n[t].attach_logo);o.softdata=n},function(e){}),o.downFiles=function(e){return e.linkurl.length>0?window.open(e.linkurl):e.attach_servername.length>0?u.downApiFiles("download",e.attach_servername,e.attach_clientname):void 0}}]),app.controller("indexController",["$scope","$timeout","$interval","$validation","$rootScope","$state","$http","$modal","getDataSource","SessionService","GetFileService","CommonService","AccountService","dateFilter","smsService",function(e,o,n,t,i,r,a,c,s,l,u,f,g,m,p){e.HrefAllcourse=function(){location.href="indexfront.html#/main/allcourse/0"},e.yearplanstudytime="无",i.user.yearplan&&""!=i.user.yearplan.studytime&&(e.yearplanstudytime=i.user.yearplan.studytime),e.myInterval=5e3,e.newtype=3,s.getDataSource(["getIndexNews","getPlatformData","getIndexCoursewarelist"],{departmentid:i.user.departmentId,departmentid1:i.user.departmentId,departmentid2:i.user.departmentId,departmentid3:i.user.departmentId,departmentid4:i.user.departmentId},function(o){for(var n=_.find(o,{name:"getIndexNews"}).data,t=0;t<n.length;t++)n[t].file_servername=u.showFile("newsPhoto",n[t].file_servername,n[t].file_servername),n[t].file_serverthumbname=u.showFile("newsPhoto",n[t].file_serverthumbname,n[t].file_serverthumbname);e.newlist=[_.filter(n,function(e){return"1"==e.category}),_.filter(n,function(e){return"2"==e.category}),_.filter(n,function(e){return"3"==e.category}),_.filter(n,function(e){return"4"==e.category})],e.platformData=_.find(o,{name:"getPlatformData"}).data[0];for(var i=_.find(o,{name:"getIndexCoursewarelist"}).data,t=0;t<i.length;t++)i[t].imagephoto=void 0!=i[t].imagephoto&&""!=i[t].imagephoto?u.showFile("coursewarePhoto",i[t].imagephoto,i[t].imagephoto):"../img/course_img.jpg";e.coursewarelist=[_.filter(i,function(e){return"1"==e.category}),[_.filter(i,function(e){return"2"==e.category}).slice(0,5),_.filter(i,function(e){return"2"==e.category}).slice(5,10)],_.filter(i,function(e){return"3"==e.category}),_.filter(i,function(e){return"4"==e.category})]},function(e){}),e.newsdetail=function(e){return"../html/index.html#/main/news/"+e},e.selectnews=function(o){e.newtype=o},e.openNewsdetail=function(e,o){window.open("../html/index.html#/main/news/"+e)},e.openCoursedetail=function(e){window.open("../html/indexfront.html#/main/courseinfo/"+e)},e.openBookinfo=function(e){i.user&&i.user.isLogin?location.href="../html/index.html#/main/bookInfo/"+e:f.alert("请登录")}}]),app.controller("mainController",["$rootScope","$state","$scope","$http","$location","getDataSource","SessionService","DateService","GetFileService","CommonService",function(e,o,n,t,i,r,a,c,s,l){n.changetab=function(o){for(var n=0;n<e.mainConfig.length;n++)e.mainConfig[n].select=!1;e.mainConfig[o].select=!0},n.userpermission=[!0,!1],e.user.permissionDic.length>0&&(n.userpermission[1]=!0),n.exit=function(){r.getUrlData("../api/Logout",{},function(e){"success"==e.code&&(location.href="../html/login.html")},function(e){})},n.chooseMenu=function(){for(var o=i.$$path,n=0;n<e.mainConfig.length;n++){var t=e.mainConfig[n];t.select=!1;for(var r=0;r<t.childMenus.length;r++)if(o.indexOf(t.childMenus[r])>=0){t.select=!0;break}}},n.toToSetting=function(){var o=i.absUrl(),n=_.find(e.mainConfig,{elementName:"usercenter"});"object"==typeof n&&(n.select=!0),console.log(o),o.indexOf("index.html")>-1&&(location.href="indexfront.html#/main/usercenter",console.log(o))},n.aClick=function(n,t){var i=_.find(e.mainConfig,{select:!0});"object"==typeof i&&(i.select=!1);var r=_.find(e.mainConfig,{elementName:t});"object"==typeof r&&(r.select=!0),"allcourse"==t?location.href="indexfront.html#/main/allcourse/0":null!=n.routeparam?o.go(n.rounteName,n.routeparam):o.go(n.rounteName)},n.searchKeyup=function(e){var o=window.event?e.keyCode:e.which;13==o&&n.searchNews()},n.searchKeys="",n.searchNews=function(){if(e.user&&e.user.isLogin){if(""==n.searchKeys)return void l.alert("请输入关键字后再搜索");location.href="../html/index.html#/main/search/"+n.searchKeys}else n.mateshowlogintip=!1,l.alert("请登录")},n.backurl="../html/indexback.html";var u=_.find(e.user.permissionDic,{GroupName:"资源库管理",Name:"课程分类"});u?n.backurl="../html/indexback.html#/index/coursewarecategory":(u=_.find(e.user.permissionDic,{GroupName:"教学管理",Name:"班级管理"}),u&&(n.backurl="../html/indexback.html#/index/classlist"))}]),app.controller("inforInfoController",["$rootScope","$scope","$http","$location","getDataSource","DateService","GetFileService","CommonService","$stateParams","$sce",function(e,o,n,t,i,r,a,c,s,l){var u=s.id;i.getDataSource("getNewsDetailById",{newsid:u},function(e){o.newsInfo=e[0],o.newsInfo.content=l.trustAsHtml(o.newsInfo.content)},function(e){})}]),app.controller("inforListController",["$rootScope","$scope","$http","$location","getDataSource","DateService","GetFileService","CommonService","$stateParams",function(e,o,n,t,i,r,a,c,s){o.newstype=s.type,o.config=[{pagesize:5,pageindex:1,newstype:!1,moreShow:!1,newslist:[]},{pagesize:5,pageindex:1,newstype:!1,moreShow:!1,newslist:[]},{pagesize:5,pageindex:1,newstype:!1,moreShow:!1,newslist:[]}],o.config[o.newstype-2].newstype=!0;var l=function(n){var t=o.newstype-2;i.getDataSource("getNewsByCategory",{category:o.newstype,pageindex:(o.config[t].pageindex-1)*o.config[t].pagesize,pagesize:o.config[t].pagesize,departmentid1:e.user.departmentId},function(e){e&&e.length>0?(o.config[t].newslist=_.union(o.config[t].newslist,e),o.config[t].pageindex++,e.length>=o.config[t].pagesize?o.config[t].moreShow=!0:o.config[t].moreShow=!1):n&&"more"==n&&(o.config[t].moreShow=!1,c.alert("没有更多数据了"))},function(e){})};o.selectNewsType=function(e){o.newstype=e;var n=o.newstype-2;angular.forEach(o.config,function(e){e.newstype=!1}),o.config[n].newstype=!0,1==o.config[n].pageindex&&l()},o.selectNewsType(o.newstype),o.loadMore=function(){l("more")},o.openNewsDetail=function(e){window.open("../html/index.html#/main/news/"+e)}}]),app.controller("searchController",["$rootScope","$scope","$http","$location","getDataSource","DateService","GetFileService","CommonService","$stateParams",function(e,o,n,t,i,r,a,c,s){function l(e){for(var o=0;o<e.length;o++)u(e[o]);return e}function u(e){return e.photo=a.showFile("coursewarePhoto",e.imagephoto,e.imagephoto),1==e.isplaycompletion?(e.buttontext="已学",e.style=!1):1==e.iselectivechoose&&e.isrequiredchoose?(e.buttontext="已选",e.style=!1):1==e.iselectivechoose?(e.buttontext="选修已选",e.style=!1):1==e.isrequiredchoose?(e.buttontext="必修已选",e.style=!1):(e.buttontext="选课",e.style=!0),e}o.newstype=s.type,e.mainSearchConfig=[{elementName:"news",select:!0},{elementName:"courseware",select:!1},{elementName:"book",select:!1}],o.aClick=function(o){_.find(e.mainSearchConfig,{select:!0}).select=!1,_.find(e.mainSearchConfig,{elementName:o}).select=!0},o.config={pagesize:5,pageindex:1,newstype:!1,moreShow:!1,newslist:[]},o.bookconfig={pagesize:5,pageindex:1,newstype:!1,moreShow:!1,newslist:[]},o.courseconfig={pagesize:8,pageindex:1,newstype:!1,moreShow:!1,newslist:[]},o.getImg=function(e,o,n){return a.showFile(n,e,o)},o.openBookinfo=function(o){e.user&&e.user.isLogin?window.open("../html/index.html#/main/bookInfo/"+o):c.alert("请登录")},o.selectCourse=function(e){var o="indexfront.html#/main/courseinfo/"+e.coursewareid;window.open(o)};var f=function(e){i.getDataSource("getBookList",{keywords:s.keywords,pageindex:(o.bookconfig.pageindex-1)*o.bookconfig.pagesize,pagesize:o.bookconfig.pagesize},function(n){n&&n.length>0?(o.bookconfig.newslist=_.union(o.bookconfig.newslist,n),o.bookconfig.pageindex++,n.allcount>=o.bookconfig.pagesize?n.list.length<o.courseconfig.pagesize?o.bookconfig.moreShow=!1:o.bookconfig.moreShow=!0:o.bookconfig.moreShow=!1):e&&"more"==e&&(o.bookconfig.moreShow=!1,c.alert("没有更多数据了"))},function(e){})},g=function(e){var n={condation:s.keywords,onecate:"",twocate:"",year:"",courseType:"",searchType:"",pageIndex:o.courseconfig.pageindex,pageSize:8,isMore:!1};i.getUrlData("../api/getcoursewarelist",n,function(n){console.log(n),n&&n.list.length>0?(o.courseconfig.newslist=_.union(o.courseconfig.newslist,l(n.list)),o.courseconfig.pageindex++,n.allcount>=o.courseconfig.pagesize?n.list.length<o.courseconfig.pagesize?o.courseconfig.moreShow=!1:o.courseconfig.moreShow=!0:o.courseconfig.moreShow=!1):e&&"more"==e&&(o.courseconfig.moreShow=!1,c.alert("没有更多数据了"))},function(e){})},m=function(n){i.getDataSource("getNewsByKeywords",{keywords:s.keywords,pageindex:(o.config.pageindex-1)*o.config.pagesize,pagesize:o.config.pagesize,departmentid1:e.user.departmentId},function(e){e&&e.length>0?(o.config.newslist=_.union(o.config.newslist,e),o.config.pageindex++,e.allcount>=o.config.pagesize?e.list.length<o.courseconfig.pagesize?o.config.moreShow=!1:o.config.moreShow=!0:o.config.moreShow=!1):n&&"more"==n&&(o.config.moreShow=!1,c.alert("没有更多数据了"))},function(e){})};m(),g(),f(),o.loadBookMore=function(){f("more")},o.loadMore=function(){m("more")},o.loadCoursewareMore=function(){g("more")},o.openNewsDetail=function(e){window.open("../html/index.html#/main/news/"+e)},o.toNewsBycategory=function(e){location.href="../html/index.html#/main/newslist/"+e}}]);