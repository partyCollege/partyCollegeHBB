app.controller("beforevideoController",["$scope","$rootScope","$state","$location","$document","$stateParams","$modal","getDataSource","FilesService","CommonService","DateService","$timeout","SessionService",function(e,t,o,n,i,a,r,s,u,c,d,l,f){var m="html",g=a.coursewareid;f.RenovatSession(m,function(e){o.go("videoCourse",{coursewareid:g})},function(e){})}]),app.controller("courseAppraiseController",["$scope","$rootScope","$stateParams","$modal","getDataSource","CommonService","FilesService","$http",function(e,t,o,n,i,a,r,s){function u(e){for(var t=0;t<e.length;t++)e[t].userphoto=r.showFile("userPhoto",e[0].photo_serverthumbname,e[0].photo_serverthumbname);return e}e.searchparameter={coursewareid:o.coursewareid,pageIndex:0,pageSize:5,isMore:!1},e.search=function(){e.searchparameter.isMore=!1,i.getUrlData("../api/getallcoursecomments",e.searchparameter,function(t){t.result&&(e.datalist=_.union(e.datalist,u(t.list)),e.allcount=t.allcount,e.datalist.length<e.allcount&&t.list.length>0&&(e.searchparameter.isMore=!0))},function(e){})},e.more=function(){e.searchparameter.pageIndex++,e.search()},e.allcount=0,e.more()}]),app.controller("coursewareCommentController",["$scope","$rootScope","$stateParams","getDataSource","CommonService",function(e,t,o,n,i){}]),app.controller("coursewarenoteController",["$scope","$rootScope","$stateParams","$modal","getDataSource","CommonService","FilesService","$http",function(e,t,o,n,i,a,r,s){i.writeLog("页面访问-笔记","20034"),e.currentPageIndex=1,e.currentPageSize=5,e.coursewareNotes=[],e.moreShow=!1,e.getImg=function(e,t,o){return r.showFile(o,e,t)},e.stutynotePlay=function(e){window.stutynotePlay(e)},e.loadMore=function(){u("more")};var u=function(n){i.getDataSource("getCoursewarenotes",{coursewareid:o.coursewareid,studentid:t.user.studentId,pageindex:(e.currentPageIndex-1)*e.currentPageSize,pagesize:e.currentPageSize},function(t){t&&t.length>0?(e.coursewareNotes=_.union(e.coursewareNotes,t),e.currentPageIndex++,t.length>=e.currentPageSize?e.moreShow=!0:e.moreShow=!1):n&&"more"==n&&(e.moreShow=!1,a.alert("没有更多数据了"))},function(e){})};u(),e.output=function(){window.open("../api/exportNote/"+o.coursewareid+"/"+t.user.studentId+"/"+o.classcourseid)},e.$watch("videoConfig.coursewarenoteCount",function(t,o){t>o&&(e.coursewareNotes=[],e.currentPageIndex=1,u())}),e.deletenote=function(t){confirm("确定要删除吗")&&i.getDataSource("delete_sy_classcourse_note",{id:t},function(t){e.coursewareNotes=[],e.currentPageIndex=1,u(),a.alert("删除成功")},function(e){a.alert("删除失败")})}}]),angular.module("myApp").controller("course_questionnaireController",["$scope","$rootScope","$anchorScroll","$location","$document","$stateParams","$modal","getDataSource","FilesService","CommonService","DateService",function(e,t,o,n,i,a,r,s,u,c,d){e.quests=[],s.writeLog("页面访问-问卷调查","20031"),s.getDataSource("select_sy_questionnaire_byCoursewareid",{accountid:t.user.accountId,coursewareid:a.coursewareid},function(t){e.quests=t}),e.save=function(e){var o=[];angular.forEach(e.questionnaires,function(n){var i={id:s.getGUID(),questionnaireid:e.id,accountid:t.user.accountId,studentid:t.user.studentId,questionnaire_detailid:n.id,answer:""},a="";0==n.category||2==n.category?i.answer=n.checked:1==n.category&&(angular.forEach(n.answers,function(e){1==e.checked&&(a+=e.id+",")}),a.length>0&&(a=a.substring(0,a.length-1)),i.answer=a),o.push(i)}),s.getDataSource("insert_sy_questionnaire_reply",{id:s.getGUID(),questionnaireid:e.id,studentid:t.user.studentId,accountid:t.user.accountId},function(){s.doArray("insert_sy_questionnaire_answer",o,function(t){c.alert("保存成功"),e.isanswer=1})}),s.getDataSource("sibmitQuestionnaireByVideoCourse",{dimension:"参与度",eventname:"调查问卷提交1份"},function(e){},function(e){})},e.initOneQuest=function(e,t){if(t.isanswer>0&&(e.open=!1),e&&e.open){if(t.questionnaires)return;s.getDataSource(["selectquestionnaireById","selectquestionnaire_detailById","select_sy_questionnaire_detail_subjectById"],{id:t.id},function(e){t.questionnaires=_.find(e,function(e){return"selectquestionnaire_detailById"==e.name}).data;var o=_.find(e,function(e){return"select_sy_questionnaire_detail_subjectById"==e.name}).data;angular.forEach(t.questionnaires,function(e){e.answers=[],angular.forEach(o,function(t){t.fid==e.id&&e.answers.push(t)})})})}}}]),app.controller("examinationController",["$scope","$rootScope","$stateParams","getDataSource","DateService","CommonService","StudyService",function(e,t,o,n,i,a,r){e.examShow=!0,e.passStatus=0,e.passStyle={display:"none"},e.nopassStyle={display:"none"},e.submitShow=!0,e.itemNoList=["A","B","C","D","E","F"],n.writeLog("页面访问-考试","20035"),n.getDataSource("getExamnum",{classcourseid:o.classcourseid},function(i){e.sumexamcount=i[0]&&i[0].examnum?i[0].examnum:0,n.getDataSource("getExamStatusByStudent",{classid:t.user.classId,coursewareid:o.coursewareid,studentid:t.user.studentId},function(t){if(t&&t.length>0){var o=_.find(t,{status:1});if(o&&o.status>0)e.examShow=!1,e.passStyle={display:"block"},e.nopassStyle={display:"none"};else{var o=_.find(t,{status:0});e.examcount=o?o.examcount:0,0==e.sumexamcount||e.examcount<e.sumexamcount?(e.examShow=!0,s()):(e.examShow=!1,e.passStyle={display:"none"},e.nopassStyle={display:"block"})}}else e.examShow=!0,e.examcount=0,s()},function(e){})},function(e){}),e.retakeExam=function(){n.getDataSource("getStudentLastExamTime",{coursewareid:o.coursewareid,classid:t.user.classId,studentid:t.user.studentId},function(e){e.length>0&&parseInt(e[0].timediff)<1?a.alert("您考试过于频繁，请休息一分钟后再考试"):s()},function(e){})};var s=function(){n.getDataSource(["getExaminations","getExaminationAnswers"],{coursewareid:o.coursewareid,coursewareid1:o.coursewareid},function(t){if(t&&t.length>0){for(var o=_.find(t,{name:"getExaminations"}).data,n=_.find(t,{name:"getExaminationAnswers"}).data,i=0;i<o.length;i++)_.merge(o[i],{answerList:n.filter(function(e){return e.examid==o[i].id})});e.examList=o,e.submitShow=!0}},function(e){})};e.submitExam=function(){n.getDataSource("getStudentLastExamTime",{coursewareid:o.coursewareid,classid:t.user.classId,studentid:t.user.studentId},function(e){e.length>0&&parseInt(e[0].timediff)<1?a.alert("您考试过于频繁，请休息一分钟后再考试"):u()},function(e){})};var u=function(){for(var i=!0,r=0,s=0;s<e.examList.length;s++){var u=e.examList[s];if(1==u.examcategory){var c=_.filter(u.answerList,function(e){return 1==e.isselect});if(c.length<=0)return a.alert("请选择题目"+(parseInt(s)+1).toString()+"的答案"),void(i=!1);var d=_.filter(u.answerList,function(e){return 1==e.isright});if(d.length==c.length)for(var l=0;l<d.length;l++){var f=d[l].answerid;void 0==_.find(c,{answerid:f})&&r++}else r++}else{if(""==_.trim(u.selectid))return a.alert("请选择题目"+(parseInt(s)+1).toString()+"的答案"),void(i=!1);var d=_.find(u.answerList,{isright:1});d?d.answerid!=u.selectid&&r++:r++}}if(i)if(0==r){var m={examModel:{coursewareid:o.coursewareid,classid:t.user.classId,studentid:t.user.studentId,status:1},queryModel:{classcourseid:o.classcourseid,coursewareid:o.coursewareid,studentid:t.user.studentId,classid:t.user.classId,accountid:t.user.accountId,type:"2",category:e.coursewareCommentData.category}};n.getUrlData("../api/InsertStudenExam",m,function(t){"true"==t?(e.passStyle={display:"block"},e.nopassStyle={display:"none"},e.passStatus=2,e.examShow=!1,e.examcount++,a.alert("考试通过")):a.alert("提交失败")},function(e){})}else n.getDataSource("insert_sy_student_exam",{coursewareid:o.coursewareid,classid:t.user.classId,studentid:t.user.studentId,status:0},function(t){a.alert("考试不通过"),0==e.sumexamcount||e.examcount+1<e.sumexamcount?(e.examcount++,e.submitShow=!1):(e.passStyle={display:"none"},e.nopassStyle={display:"block"},e.examShow=!1)},function(e){});else a.alert("请选择所有题目答案后在交卷")}}]),app.controller("feelLearnController",["$scope","$rootScope","$stateParams","$modal","getDataSource","CommonService","StudyService",function(e,t,o,n,i,a,r){function s(e){return e.replace(/<[^>]+>/g,"")}e.spanClick=function(o){"myfeelLearnView"==o?(e.ueditorConfig={toolbars:[["undo","redo","bold","indent","italic","underline","strikethrough","subscript","fontborder","superscript","formatmatch","time","date","fontfamily","fontsize","paragraph","justifyleft","justifyright","justifycenter","justifyjustify","forecolor"]],autoClearinitialContent:!0,wordCount:!1,elementPathEnabled:!1,enableAutoSave:!1,autoSyncData:!1},e.myConfig.orderShow=!1,u()):"feelLearnsView"==o&&(e.myConfig.orderShow=!0,c());var n=_.find(t.videoConfig.feelLearnConfig,{show:!0,select:!0});n.show=!1,n.select=!1;var i=_.find(t.videoConfig.feelLearnConfig,{elementName:o});i.show=!0,i.select=!0},e.myConfig={feellearnTimeSelect:!0,feellearnPopularitySelect:!1,orderShow:!1,feellearnTime:"tubiaoicon-48",feellearnPopularity:"",feellearnSort:"createdtime",feellearnDesc:"desc"};var u=function(){i.getDataSource("videoCourse-myFeelLearn",{studentid:t.user.studentId,coursewareid:o.coursewareid,accountid:t.user.accountId},function(t){t.length>0?e.myFeelLearn=t[0]:e.myFeelLearn={issubmit:0}},function(e){})},c=function(){i.getDataSource("videoCourse-feelLearn",{coursewareid:o.coursewareid,accountid:t.user.accountId},function(t){e.feelLearns=_.sortByOrder(t,e.myConfig.feellearnSort,e.myConfig.feellearnDesc)},function(e){})};e.feellearnDataOrder=function(t){1==t?"tubiaoicon-48"==e.myConfig.feellearnTime?(e.myConfig.feellearnTime="tubiaoicon-16",e.myConfig.feellearnPopularity="",e.myConfig.feellearnSort="createdtime",e.myConfig.feellearnDesc="asc",e.myConfig.feellearnTimeSelect=!0,e.myConfig.feellearnPopularitySelect=!1):(e.myConfig.feellearnTime="tubiaoicon-48",e.myConfig.feellearnPopularity="",e.myConfig.feellearnSort="createdtime",e.myConfig.feellearnDesc="desc",e.myConfig.feellearnTimeSelect=!0,e.myConfig.feellearnPopularitySelect=!1):"tubiaoicon-48"==e.myConfig.feellearnPopularity?(e.myConfig.feellearnPopularity="tubiaoicon-16",e.myConfig.feellearnTime="",e.myConfig.feellearnSort="clickcount",e.myConfig.feellearnDesc="asc",e.myConfig.feellearnTimeSelect=!1,e.myConfig.feellearnPopularitySelect=!0):(e.myConfig.feellearnPopularity="tubiaoicon-48",e.myConfig.feellearnTime="",e.myConfig.feellearnSort="clickcount",e.myConfig.feellearnDesc="desc",e.myConfig.feellearnTimeSelect=!1,e.myConfig.feellearnPopularitySelect=!0),c()},e.submitdisabled=!1,e.save=function(n,r){var s="save"==n?"保存":"提交";if(void 0==t.Videolog||"0"==t.Videolog.isplaycompletion)return void a.alert("请先学完课程");if(void 0==e.myFeelLearn)a.alert("请先编辑学后感后再进行"+s);else{if(void 0==e.myFeelLearn.fltitle||""==_.trim(e.myFeelLearn.fltitle))return void a.alert("请输入标题后再进行"+s);if(void 0==e.myFeelLearn.flcontent||""==_.trim(e.myFeelLearn.flcontent))return void a.alert("请输入内容后再进行"+s);if(void 0==e.myFeelLearn.id){var u=i.getGUID();e.myFeelLearn.id=u,e.myFeelLearn.issubmit=r;var c={learningsenseModel:{id:u,studentid:t.user.studentId,title:e.myFeelLearn.fltitle,content:e.myFeelLearn.flcontent,coursewareid:o.coursewareid,recommendedstatus:0,status:r,classid:t.user.classId,logcontent:s}};i.getUrlData("../api/InsertClasscourseLearningsense",c,function(t){"true"==t&&(1==r&&(e.submitdisabled=!0),a.alert(s+"成功"))},function(t){e.submitdisabled=!1,a.alert(s+"失败")})}else{var c={learningsenseModel:{id:e.myFeelLearn.id,title:e.myFeelLearn.fltitle,content:e.myFeelLearn.flcontent,status:r}};i.getUrlData("../api/submitClasscourseLearningsense",c,function(t){"true"==t&&(e.myFeelLearn.issubmit=r,a.alert(s+"成功"))},function(e){a.alert(s+"失败")})}}},e.submit=function(t,o){e.save(t,o)},e.spanClick("myfeelLearnView"),e.clickALike=function(o,n,a,r){var s=_.find(e.feelLearns,{id:o});s.isclick||i.getUrlData("../api/commonPraise",{eventid:o,accountid:t.user.accountId,passive_classid:r,passive_accountid:n,passive_student:a,usertype:"1",eventtype:"1",group:"20033",tag:"操作-学后感点赞"},function(e){"true"==e&&(s.clickcount++,s.isclick=1)},function(e){})},e.getLen=function(e){return s(e).length},e.openDetail=function(t){for(var o=_.find(e.feelLearns,{id:t}),n=o.isdetail?0:1,i=0;i<e.feelLearns.length;i++)e.feelLearns[i].isdetail=0;o.isdetail=n}}]),app.controller("pptplayController",["$scope","$rootScope","$stateParams","getDataSource","$timeout","$interval","$http","CommonService","SessionService","GetFileService",function(e,t,o,n,i,a,r,s,u,c){e.pageindex=1,e.enableGoUppage=!1,e.enableGoDownpage=!1,e.currentPlayID=n.getGUID();var d=new Array;d.push("selectStudentPlayDetailCount"),d.push("selectStudentPlayTime"),d.push("getStudytimeByCoursewareId"),n.getDataSource(d,{coursewareid:o.coursewareid,studentid:t.user.studentId,currentID:e.currentPlayID,courseid:o.coursewareid},function(i){var a=_.find(i,{name:"selectStudentPlayTime"}).data,r=_.find(i,{name:"selectStudentPlayDetailCount"}).data,s=_.find(i,{name:"getStudytimeByCoursewareId"}).data;e.stuPlayDetailCount=r[0].dtlcount,e.studytime=0,a[0]&&(e.lastPlayTime=a[0].timespan,e.studytime=a[0].studytime,e.pageindex=e.studytime,0==e.pageindex&&(e.pageindex=1),e.isplaycompletion=a[0].isplaycompletion),s[0]&&(e.courwarestudytime=s[0].studytime),n.getDataSource("selectCoursewareById",{id:o.coursewareid},function(i){e.course=i[0],e.nowVideoDuration=e.course.realduration,e.loadPPTCoursewareImg(e.pageindex,e.course.pptcoursefile_servername),e.enableGoUppage=!1,e.enableGoDownpage=!1,e.goDownpageText="下一页",n.getUrlData("../api/getVideoLogPKey",{studentid:t.user.studentId,coursewareid:o.coursewareid},function(t){if(t.code){var o=t.pkey;o.length>0&&(e.isGetPKey=!0,e.pkey=o,e.$$phase||e.$apply())}},function(e){alert(errorMessage)})})},function(e){alert(errorMessage)}),e.gouppage=function(){e.pageindex--,e.pageindex<1&&(e.pageindex=1,e.enableGoUppage=!0,e.enableGoDownpage=!1),e.loadPPTCoursewareImg(e.pageindex,e.course.pptcoursefile_servername)};var l=5,f=function(){e.$apply(function(){e.goDownpageText="等待"+l--+"s"}),0>l?(clearInterval(m),l=5,e.$apply(function(){e.enableGoDownpage=!1,e.goDownpageText="下一页"})):e.enableGoUppage=!0},m={};e.godownpage=function(){e.enableGoDownpage||(e.pageindex++,e.pageindex>=parseInt(e.course.realduration)?(e.pageindex=parseInt(e.course.realduration),e.enableGoDownpage=!0):e.enableGoDownpage=!1,1!=e.isplaycompletion&&(e.enableGoDownpage||(e.enableGoDownpage=!0,clearInterval(m),m=setInterval(f,1e3))),e.loadPPTCoursewareImg(e.pageindex,e.course.pptcoursefile_servername),g())},e.pptimgfileobj={},e.loadPPTCoursewareImg=function(t,o){n.getUrlData("../api/getPPTVideoCourse",{pageindex:t,pptcoursefile_servername:o},function(t){e.pptimgfileobj=t},function(e){})};var g=function(){var n={pkey:e.pkey,studentid:t.user.studentId,time:e.pageindex,currentID:e.currentPlayID,timestamp:e.pageindex,videoDuration:e.nowVideoDuration,coursewareid:o.coursewareid,videotype:e.course.videotype,accountid:t.user.accountId,studytime:e.studytime,studetailcount:e.stuPlayDetailCount,courwarestudytime:e.courwarestudytime,coursewarename:e.course.name};e.pkey&&e.pkey.length>0&&r.post("../api/videoPlay",n).success(function(t){t&&!t.code,e.studytime=e.pageindex,e.stuPlayDetailCount=1}).error(function(e,t){})}}]),app.controller("questionController",["$scope","$rootScope","getDataSource","$stateParams","CommonService","DateService",function(e,t,o,n,i,a){e.myConfig=[{questionTimeSelect:!0,questionPopularitySelect:!1,questionTime:"tubiaoicon-48",questionPopularity:"",questionSort:1,questionDesc:1},{questionTimeSelect:!0,questionPopularitySelect:!1,questionTime:"tubiaoicon-48",questionPopularity:"",questionSort:1,questionDesc:1}],e.currentPageIndex=1,e.currentPageIndex_all=1,e.currentPageSize=5,e.myQuestion=[],e.questions=[],e.loadMoreMyquestion=function(){r("more",0)},e.loadMoreQuestions=function(){s("more",1)};var r=function(a,r){o.getUrlData("../api/searchQuestions",{accountid:t.user.accountId,coursewareid:n.coursewareid,pageindex:e.currentPageIndex,pagesize:e.currentPageSize,sortType:e.myConfig[r].questionSort,orderType:e.myConfig[r].questionDesc,searchType:1},function(t){for(var o=t.questionList,n=t.questionReplyList,r=0;r<o.length;r++)_.merge(o[r],{noreply:n.filter(function(e){return e.fid==o[r].id&&1==e.status}).length<=0,replylist:n.filter(function(e){return e.fid==o[r].id})});o&&o.length>0?(e.myQuestion=_.union(e.myQuestion,o),e.currentPageIndex++,o.length>=e.currentPageSize?e.moreshow=!0:e.moreshow=!1):a&&"more"==a&&(e.moreshow=!1,i.alert("没有更多数据了"))},function(e){})},s=function(a,r){o.getUrlData("../api/searchQuestions",{accountid:t.user.accountId,coursewareid:n.coursewareid,pageindex:e.currentPageIndex_all,pagesize:e.currentPageSize,sortType:e.myConfig[r].questionSort,orderType:e.myConfig[r].questionDesc,searchType:2},function(t){for(var o=t.questionList,n=t.questionReplyList,r=0;r<o.length;r++)_.merge(o[r],{noreply:n.filter(function(e){return e.fid==o[r].id&&1==e.status}).length<=0,replylist:n.filter(function(e){return e.fid==o[r].id})});o&&o.length>0?(e.questions=_.union(e.questions,o),e.currentPageIndex_all++,o.length>=e.currentPageSize?e.moreshow_all=!0:e.moreshow_all=!1):a&&"more"==a&&(e.moreshow_all=!1,i.alert("没有更多数据了"))},function(e){})};e.questionDataOrder=function(t,o){1==t?"tubiaoicon-48"==e.myConfig[o].questionTime?(e.myConfig[o].questionTimeSelect=!0,e.myConfig[o].questionPopularitySelect=!1,e.myConfig[o].questionTime="tubiaoicon-16",e.myConfig[o].questionPopularity="",e.myConfig[o].questionSort=1,e.myConfig[o].questionDesc=2):(e.myConfig[o].questionTimeSelect=!0,e.myConfig[o].questionPopularitySelect=!1,e.myConfig[o].questionTime="tubiaoicon-48",e.myConfig[o].questionPopularity="",e.myConfig[o].questionSort=1,e.myConfig[o].questionDesc=1):"tubiaoicon-48"==e.myConfig[o].questionPopularity?(e.myConfig[o].questionTimeSelect=!1,e.myConfig[o].questionPopularitySelect=!0,e.myConfig[o].questionPopularity="tubiaoicon-16",e.myConfig[o].questionTime="",e.myConfig[o].questionSort=2,e.myConfig[o].questionDesc=2):(e.myConfig[o].questionTimeSelect=!1,e.myConfig[o].questionPopularitySelect=!0,e.myConfig[o].questionPopularity="tubiaoicon-48",e.myConfig[o].questionTime="",e.myConfig[o].questionSort=2,e.myConfig[o].questionDesc=1),0==o?(e.myQuestion=[],e.currentPageIndex=1,r("",o)):1==o&&(e.questions=[],e.currentPageIndex_all=1,s("",o))},e.spanClick=function(u){"myQuestionView"==u?(e.myQuestion=[],e.currentPageIndex=1,r("",0)):"questionsView"==u&&(e.questions=[],e.currentPageIndex_all=1,s("",1),e.answerShow=function(t){_.find(e.questions,{id:t}).answershow=!_.find(e.questions,{id:t}).answershow},e.answer=function(r){var s=_.find(e.questions,{id:r});if(""==s.replycontent)return void i.alert("请先输入需要回答的内容");var u=o.getGUID();o.getDataSource("insert_sy_class_faq",{id:u,accountid:t.user.accountId,fid:r,content:s.replycontent,coursewareid:n.coursewareid,usertype:"1",studentid:t.user.studentId,videostamp:0,dimension:"参与度",eventname:"回答1个问题",logcontent:"回答问题"},function(e){s.answershow=!s.answershow,s.replylist.push({id:u,accountid:t.user.accountId,status:0,fid:r,pcontent:s.replycontent,createdtime:a.format(new Date,"yyyy-MM-dd"),fromtype:1,fromuser:t.user.name,clickcount:"0",isclick:0}),i.alert("发布成功"),s.replycontent=""},function(){i.alert("发布失败")})},e.attention=function(n){var i=_.find(e.questions,{id:n});i.isattention||o.getUrlData("../api/commonAttention",{eventid:n,accountid:t.user.accountId,passive_classid:i.classid,passive_accountid:i.accountid,passive_student:i.studentid},function(e){"true"==e&&(i.attentioncount++,i.isattention=1)},function(e){})},e.clickALike=function(n){var i=_.find(e.questions,{id:n});i.isclick||o.getUrlData("../api/commonPraise",{eventid:n,accountid:t.user.accountId,passive_classid:i.classid,passive_accountid:i.accountid,passive_student:i.studentid,usertype:"1",eventtype:i.fromtype,group:"20032",tag:"操作-问题点赞"},function(e){"true"==e&&(i.clickcount++,i.isclick=1)},function(e){})},e.clickALike_reply=function(n,i){var a=_.find(e.questions,{id:n}),r=_.find(a.replylist,{id:i});r.isclick||o.getUrlData("../api/commonPraise",{eventid:i,accountid:t.user.accountId,passive_classid:r.classid,passive_accountid:r.accountid,passive_student:r.studentid,usertype:"1",eventtype:r.fromtype,group:"20032",tag:"操作-回答点赞"},function(e){"true"==e&&(r.clickcount++,r.isclick=1)},function(e){})});var c=_.find(t.videoConfig.questionConfig,{show:!0,select:!0});c.show=!1,c.select=!1;var d=_.find(t.videoConfig.questionConfig,{elementName:u});d.show=!0,d.select=!0},e.deleQuestion=function(t,n){o.getDataSource("getAnswercountByQuestionId",{id:t},function(a){return a&&a[0].answercount>0?void i.alert("该问题已有回复，不能删除"):void o.getDataSource("delete_sy_class_faq",{id:t,fid:t},function(t){0==n?(e.myQuestion=[],e.currentPageIndex=1,r("",0)):1==n&&(e.questions=[],e.currentPageIndex_all=1,s("",1)),i.alert("问题删除成功")},function(e){i.alert("问题删除失败")})},function(e){})},e.deleAnswer=function(t,n){o.getDataSource("getAnswerstatusByAnswerId",{id:t},function(a){return a&&a[0].status>0?void i.alert("该答案已被采纳，不能删除"):void o.getDataSource("delete_sy_class_faq_answer",{id:t},function(t){0==n?(e.myQuestion=[],e.currentPageIndex=1,r("",0)):1==n&&(e.questions=[],e.currentPageIndex_all=1,s("",1)),i.alert("答案删除成功")},function(e){i.alert("答案删除失败")})},function(e){})},e.spanClick("myQuestionView"),e.$watch("videoConfig.questionCount",function(t,o){t>o&&(e.myQuestion=[],e.currentPageIndex=1,r("",0))})}]),app.controller("testvideoController",["$scope","$rootScope","$stateParams","getDataSource","$timeout","$interval","$http","CommonService","SessionService",function(e,t,o,n,i,a,r,s,u){var c={},d={},l=function(t){e.nowVideoDuration=t.data[0].duration};window.getVideoInfo=l;var f={},m={};f={width:"100%",height:"100%",vid:"873c41fa7561027fb25cf2c6797f5252_8",flashvars:{autoplay:"false",teaser_time:"0",setScreen:"16_9",history_video_duration:"10",setVolumeM:"1",ban_ui:"off",ban_control:"off",is_auto_replay:"off",ban_skin_progress_dottween:"on"}},m={width:"100%",height:"100%",vid:"873c41fa7561027fb25cf2c6797f5252_8",flashvars:{autoplay:"false",teaser_time:"0",setScreen:"16_9",history_video_duration:"10",setVolumeM:"1",ban_ui:"off",ban_control:"off",is_auto_replay:"off",ban_skin_progress_dottween:"on"}},c=polyvObject("#mainVideo").videoPlayer(f),d=polyvObject("#mainVideo").videoPlayer(m),s2j_onVideoPlay=function(){c.j2s_resumeVideo(),obj=setInterval(g,6e3)};var g=function(){var n=c.j2s_getCurrentTime();if(r.post("../api/videoPlay",{studentid:t.user.studentId,time:n,classcourseid:o.classcourseid,currentID:e.currentPlayID,timestamp:c.j2s_realPlayVideoTime(),videoDuration:e.nowVideoDuration,coursewareid:o.coursewareid,accountid:t.user.accountId,usertype:t.user.userType},function(){}),e.course.videotype>0){var i=d.j2s_getCurrentTime();n!=i&&d.j2s_seekVideo(n)}}}]),app.controller("videoController",["$scope","$rootScope","$stateParams","getDataSource","$timeout","$interval","$http","CommonService","SessionService",function(e,t,o,n,i,a,r,s,u){var c={};e.course={},e.lastPlayTime=0,e.courwarestudytime=0;var d={},l={},f="系统检测到当前网络异常，请刷新页面重试。",m=function(e,t,o,n,i,arguments){try{var a={filename:n,methodname:o,errorline:i,message:e,msginfo:t,arguments:arguments};r.post("../api/WriteException",a).success(function(e){})}catch(s){}};e.currentPlayID=n.getGUID(),e.load=function(){i(function(){e.open=s2j_onChapterBtnClick,e.open=function(){},e.open=s2j_onChapterBtnClick},0)}(),i(function(){$(function(){$("#emotion").SinaEmotion($("#message"));var n={};$.getScript(t.appConfig.signalRHub).done(function(i,a){$.connection.hub.url=t.appConfig.signalRHub,n=$.connection.chatHub,n.client.broadcastMessage=function(e){var t=$("<div />").text(e.name).html();$("#chartDiv").append("<li><strong>"+t+":</strong><div>"+AnalyticEmotion(e.message)+"</div><span class='time'>"+e.dateTime+"</span></li>")},n.client.repeatLogin=function(){d.j2s_pauseVideo(),e.course.videotype>0&&void 0!=l&&void 0!=l.j2s_pauseVideo&&l.j2s_pauseVideo();var t=window.confirm("您已重复登录");!t&&t||window.close()},$.connection.hub.start(function(){n.server.addConnection(t.user.accountId),n.server.joinRoom(o.coursewareid),$("#sendmessage").click(function(){n.server.send(t.user.name,$("#message").val(),o.coursewareid),$("#message").val("").focus()})},function(e){alert(f)})})})},0);var g={},p={};e.isGetPKey=!1,e.pkey="",e.loadVideo=function(){try{var i=new Array;i.push("selectStudentPlayDetailCount"),i.push("selectStudentPlayTime"),i.push("getStudytimeByCoursewareId"),n.getDataSource(i,{coursewareid:o.coursewareid,studentid:t.user.studentId,currentID:e.currentPlayID,courseid:o.coursewareid},function(i){var a=_.find(i,{name:"selectStudentPlayTime"}).data,r=_.find(i,{name:"selectStudentPlayDetailCount"}).data,s=_.find(i,{name:"getStudytimeByCoursewareId"}).data;e.stuPlayDetailCount=r[0].dtlcount,e.studytime=0,a[0]&&(e.lastPlayTime=a[0].timespan,e.studytime=a[0].studytime,e.isplaycompletion=a[0].isplaycompletion),s[0]&&(e.courwarestudytime=s[0].studytime),n.getDataSource("selectCoursewareById",{id:o.coursewareid},function(i){e.course=i[0],e.nowVideoDuration=e.course.realduration,n.getUrlData("../api/getVideoLogPKey",{studentid:t.user.studentId,coursewareid:o.coursewareid,courwarestudytime:e.courwarestudytime},function(t){if(t.code){var o=t.pkey;o.length>0&&(e.isGetPKey=!0,e.pkey=o,e.$$phase||e.$apply())}},function(e){alert(f)}),g={width:"100%",height:"100%",vid:e.course.teachervideo,flashvars:{autoplay:"false",teaser_time:"0",setScreen:"16_9",ban_history_time:"on",history_video_duration:"10",setVolumeM:"1",ban_ui:"off",ban_control:"off",is_auto_replay:"off",ban_skin_progress_dottween:"on"}},1!=e.isplaycompletion&&(g.flashvars.watchStartTime=e.studytime,g.flashvars.ban_seek_by_limit_time="on"),d=polyvObject("#mainVideo").videoPlayer(g),0==e.course.videotype&&($(".video-box.video-f").attr("class","video-box video-f video_only"),$(".video-box.video-s").css("display","none"),$(".exchange").css("display","none")),e.course.videotype>0&&(p={width:"100%",height:"100%",vid:e.course.pptvideo,flashvars:{autoplay:"false",teaser_time:"0",ban_history_time:"on",history_video_duration:"10",setVolumeM:"0",ban_ui:"off",ban_control:"off",is_auto_replay:"off",ban_skin_progress_dottween:"on"}},1!=e.isplaycompletion&&(p.flashvars.watchStartTime=e.studytime,p.flashvars.ban_seek_by_limit_time="on"),l=polyvObject("#smallVideo").videoPlayer(p))},function(e){alert(f)})},function(e){alert(f)})}catch(a){alert(f),m(a.message+"【错误码：001】",a.stack,"loadVideo","",0)}}(),s2j_onChapterBtnClick=function(){},s2j_onPlayerInitOver=function(n){var i={studentid:t.user.studentId,coursewareid:o.coursewareid,accountid:t.user.accountId};if(void 0!=d&&void 0!=d.j2s_rightpanelBtnSet){d.j2s_rightpanelBtnSet(),e.course.videotype>0&&void 0!=l&&void 0!=l.j2s_rightpanelBtnSet&&void 0!=l.j2s_banUI&&void 0!=l.j2s_hideRightPanel&&(l.j2s_rightpanelBtnSet(),l.j2s_banUI(),l.j2s_hideRightPanel());var a="";void 0==d&&(a+=" player1 is undefined, "),a+=void 0==d.j2s_getCurrentTime?" player1.j2s_getCurrentTime is undefined, ":" player1.j2s_getCurrentTime:"+d.j2s_getCurrentTime(),a+=void 0==d.j2s_realPlayVideoTime?" player1 j2s_realPlayVideoTime is undefined, ":" player1.j2s_realPlayVideoTime:"+d.j2s_realPlayVideoTime(),m("播放器事件监控 【vid:"+n+"】","Method execution is completed. "+a,"s2j_onPlayerInitOver","",0,i)}else m("播放器事件监控 【vid:"+n+"】","Method execution is completed. player1 is undefined && player1.j2s_rightpanelBtnSet is undefined","s2j_onPlayerInitOver","",0,i)},s2j_onPlayOver=function(n){if(e.course.teachervideo==n){y(),clearInterval(c);var i={studentid:t.user.studentId,coursewareid:o.coursewareid,accountid:t.user.accountId},a="";void 0==d&&(a+=" player1 is undefined, "),a+=void 0==d.j2s_getCurrentTime?" player1.j2s_getCurrentTime is undefined, ":" player1.j2s_getCurrentTime:"+d.j2s_getCurrentTime(),a+=void 0==d.j2s_realPlayVideoTime?" player1 j2s_realPlayVideoTime is undefined, ":" player1.j2s_realPlayVideoTime:"+d.j2s_realPlayVideoTime(),m("播放器事件监控 【vid:"+n+"】","Method execution is completed."+a,"s2j_onPlayOver","",0,i)}},s2j_onPlayerError=function(e,n){clearInterval(c);var i={studentid:t.user.studentId,coursewareid:o.coursewareid,accountid:t.user.accountId,type:e},a="";void 0==d&&(a+=" player1 is undefined, "),a+=void 0==d.j2s_getCurrentTime?" player1.j2s_getCurrentTime is undefined, ":" player1.j2s_getCurrentTime:"+d.j2s_getCurrentTime(),a+=void 0==d.j2s_realPlayVideoTime?" player1 j2s_realPlayVideoTime is undefined, ":" player1.j2s_realPlayVideoTime:"+d.j2s_realPlayVideoTime(),m("播放器事件监控 【vid:"+n+"】","Method execution is completed."+a,"s2j_onPlayerError","",0,i)},s2j_onChapterBtnClick=function(){s.alert("章节功能暂未开放")},s2j_onNoteBtnClick=function(){s2j_onVideoPause(),void 0!=d&&void 0!=d.j2s_screenShot&&d.j2s_screenShot(),e.course.videotype>0&&void 0!=l&&void 0!=l.j2s_screenShot&&l.j2s_screenShot()},window.stutynotePlay=function(t){void 0!=d&&d.j2s_seekVideo(t),e.course.videotype>0&&void 0!=l&&l.j2s_seekVideo(t)},window.s2j_onScreenShotComplete=function(t){var o=JSON.parse(t);if(o.vid==e.course.teachervideo){if(e.studynoteConfig.studynoteImg1=o.url,e.course.videotype<=0&&void 0!=d&&void 0!=d.j2s_getCurrentTime){var n=d.j2s_getCurrentTime();e.showStudynoteView("lg",s2j_onVideoPlay,n)}}else if(o.vid==e.course.pptvideo&&(e.studynoteConfig.studynoteImg2=o.url,e.course.videotype>0&&void 0!=d&&void 0!=d.j2s_getCurrentTime)){var n=d.j2s_getCurrentTime();e.showStudynoteView("lg",s2j_onVideoPlay,n)}},s2j_onQuestionBtnClick=function(){if(s2j_onVideoPause(),void 0!=d&&void 0!=d.j2s_getCurrentTime){var t=d.j2s_getCurrentTime();e.showQuestionView("lg",s2j_onVideoPlay,t)}},s2j_onCommunicationBtnClick=function(){$(".courseFile .chat_box").hasClass("show")?$(".courseFile .chat_box").removeClass("show"):$(".courseFile .chat_box").addClass("show")},s2j_onVideoPlay=function(t){void 0!=d&&void 0!=d.j2s_resumeVideo&&(d.j2s_resumeVideo(),e.course.videotype>0&&void 0!=l&&void 0!=l.j2s_resumeVideo&&l.j2s_resumeVideo(),e.course.teachervideo==t&&(clearInterval(c),y(),c=setInterval(y,6e4)))};var y=function(){var n={pkey:e.pkey,studentid:t.user.studentId,time:0,currentID:e.currentPlayID,timestamp:0,videoDuration:e.nowVideoDuration,coursewareid:o.coursewareid,accountid:t.user.accountId,studytime:e.studytime,studetailcount:e.stuPlayDetailCount,courwarestudytime:e.courwarestudytime,coursewarename:e.course.name};if(void 0!=d&&void 0!=d.j2s_getCurrentTime&&void 0!=d.j2s_realPlayVideoTime){var i=d.j2s_getCurrentTime();e.studytime<=0&&(e.studytime=e.studytime+60),n.time=i,n.timestamp=d.j2s_realPlayVideoTime();try{if(e.pkey&&e.pkey.length>0&&r.post("../api/videoPlay",n).success(function(t){t&&!t.code&&(m("播放参数错误【错误码：002】",t.message,"O_func","",0,n),v(f)),i&&(e.studytime=i),e.stuPlayDetailCount=1}).error(function(e,t){m(e+"【错误码：003】",e,"O_func","",0,n),t&&401==t&&v("会话超时，请重新登陆。")}),e.course.videotype>0){var a=l.j2s_getCurrentTime();i!=a&&l.j2s_seekVideo(i)}}catch(s){m(s.message+"【错误码：004】",s.stack,"O_func","",0,n),v(f)}}else{var u="";void 0==d&&(u+=" player1 is undefined, "),u+=void 0==d.j2s_getCurrentTime?" player1.j2s_getCurrentTime is undefined, ":" player1.j2s_getCurrentTime:"+d.j2s_getCurrentTime(),u+=void 0==d.j2s_realPlayVideoTime?" player1 j2s_realPlayVideoTime is undefined, ":" player1.j2s_realPlayVideoTime:"+d.j2s_realPlayVideoTime(),m(u+"【错误码：005】","","O_func","",0,n),v(f)}};s2j_onVideoPause=function(){void 0!=d&&void 0!=d.j2s_pauseVideo&&(d.j2s_pauseVideo(),e.course.videotype>0&&void 0!=l&&void 0!=l.j2s_pauseVideo&&l.j2s_pauseVideo(),clearInterval(c))},t.stopVideo=function(){s2j_onVideoPause()},e.change=function(){$(".video-f").hasClass("change")?(d.j2s_showUI(),d.j2s_showRightPanel(),l.j2s_banUI(),l.j2s_hideRightPanel(),$(".video-f").removeClass("change")):(d.j2s_banUI(),l.j2s_showUI(),d.j2s_hideRightPanel(),l.j2s_showRightPanel(),$(".video-f").addClass("change")),$(".video-s").hasClass("change")?$(".video-s").removeClass("change"):$(".video-s").addClass("change")};var v=function(e){clearInterval(c),s2j_onVideoPause(),alert(e),location.reload(!0)}}]),app.controller("videoCouresController",["$scope","$rootScope","$anchorScroll","$location","$document","$stateParams","$modal","getDataSource","FilesService","CommonService","DateService",function(e,t,o,n,i,a,r,s,u,c,d){e.appraiseShow=!1,e.decRound=function(e){return parseFloat(e).toFixed(1)},e.scoreConfig=[{itemid:1,itemname:"观点正确",
rate:3,max:5,isReadonly:!1},{itemid:2,itemname:"联系实际",rate:3,max:5,isReadonly:!1},{itemid:3,itemname:"内容丰富",rate:3,max:5,isReadonly:!1},{itemid:4,itemname:"讲授认真",rate:3,max:5,isReadonly:!1},{itemid:5,itemname:"互动充分",rate:3,max:5,isReadonly:!1}],e.showAppraise=function(){s.getDataSource("getVideolog",{studentid:t.user.studentId,coursewareid:a.coursewareid},function(o){if(t.Videolog=o[0],!o||!o[0]||"1"!=o[0].isplaycompletion)return void c.alert("请先学完课程");if(e.appraiseShow){if(e.scoreConfig)for(var n in e.scoreConfig)e.scoreConfig[n].rate=null,e.scoreConfig[n].percent=null;e.ratingStates=[{stateOn:"glyphicon-ok-sign",stateOff:"glyphicon-ok-circle"},{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"},{stateOn:"glyphicon-heart",stateOff:"glyphicon-ban-circle"},{stateOn:"glyphicon-heart"},{stateOff:"glyphicon-off"}],e.appraiseShow=!e.appraiseShow}else s.getDataSource("geAppraisetFlag",{coursewareid31:a.coursewareid,accountid:t.user.accountId},function(o){return o[0].isappraise<=0?(e.hoveringOver=function(t,o){e.scoreConfig[t].overStar=o,e.scoreConfig[t].percent=o/e.scoreConfig[t].max*10},e.leaveingOver=function(t){e.scoreConfig[t].overStar=null,e.scoreConfig[t].percent=2*e.scoreConfig[t].rate},e.clearAppraise=function(){if(e.scoreConfig)for(var t=0;t<e.scoreConfig.length;t++)e.scoreConfig[t].rate=0,e.scoreConfig[t].percent=0},e.sumbitDisabled=!1,e.submitAppraise=function(){var o=!0;if(e.sumbitDisabled=!0,e.scoreConfig)for(var n=0;n<e.scoreConfig.length;n++)if(void 0==e.scoreConfig[n].rate||null==e.scoreConfig[n].rate||0==e.scoreConfig[n].rate){o=!1;break}if(o){var i=$("#courseAppraiseContent").val(),r={accountid:t.user.accountId,classcourseid:"",studentid:t.user.studentId,coursewareid:a.coursewareid,classid:t.user.classId,scoreList:e.scoreConfig,courseAppraiseContent:i};s.getUrlData("../api/submitAppraise",r,function(t){"true"==t&&(e.coursewareCommentData.gradecount++,e.clearAppraise(),l(),e.appraiseShow=!e.appraiseShow,c.alert("提交成功"),e.sumbitDisabled=!1)},function(t){c.alert("提交失败"),e.sumbitDisabled=!1})}else e.sumbitDisabled=!1,c.alert("请评价所有项后再提交")},e.ratingStates=[{stateOn:"glyphicon-ok-sign",stateOff:"glyphicon-ok-circle"},{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"},{stateOn:"glyphicon-heart",stateOff:"glyphicon-ban-circle"},{stateOn:"glyphicon-heart"},{stateOff:"glyphicon-off"}],e.appraiseShow=!e.appraiseShow,void 0):(e.isappraise[0].isappraise=1,c.alert("已评价，不能重复评价"),void(e.sumbitDisabled=!1))},function(t){e.sumbitDisabled=!1})},function(e){})},t.feelLearnEditdisable=!1,e.aClick=function(e){if("examinationView"==e)s.getDataSource("getVideolog",{studentid:t.user.studentId,coursewareid:a.coursewareid},function(o){if(t.Videolog=o[0],!o||!o[0]||"1"!=o[0].isplaycompletion)return void c.alert("请先学完课程");var n=_.find(t.videoConfig.mainConfig,{select:!0});n.show=!1,n.select=!1;var i=_.find(t.videoConfig.mainConfig,{elementName:e});i.show=!0,i.select=!0},function(e){});else if("feelLearnsView"==e)s.getDataSource("getVideolog",{studentid:t.user.studentId,coursewareid:a.coursewareid},function(o){if(t.Videolog=o[0],o&&o[0]&&"1"==o[0].isplaycompletion){var n=_.find(t.videoConfig.mainConfig,{select:!0});n.show=!1,n.select=!1;var i=_.find(t.videoConfig.mainConfig,{elementName:e});i.show=!0,i.select=!0,t.feelLearnEditdisable=!0}else{var n=_.find(t.videoConfig.mainConfig,{select:!0});n.show=!1,n.select=!1;var i=_.find(t.videoConfig.mainConfig,{elementName:e});i.show=!0,i.select=!0,t.feelLearnEditdisable=!1}},function(e){});else{var o=_.find(t.videoConfig.mainConfig,{select:!0});o.show=!1,o.select=!1;var n=_.find(t.videoConfig.mainConfig,{elementName:e});n.show=!0,n.select=!0}},s.getDataSource(["videoCourse-coursewareComment","videoCourse-teachersComment","get_sy_courseware_information","geAppraisetFlag","getAppraiseAvgScorelist","getGradeByCoursewareid","updateCoursewareClickrate"],{coursewareid20:a.coursewareid,coursewareid11:a.coursewareid,coursewareid12:a.coursewareid,coursewareid31:a.coursewareid,accountid:t.user.accountId,coursewareid32:a.coursewareid,coursewareid1:a.coursewareid,id:a.coursewareid},function(t){if(t&&t.length>0){e.coursewareCommentData=_.find(t,{name:"videoCourse-coursewareComment"}).data[0],i[0].title=e.coursewareCommentData?e.coursewareCommentData.csname:"课程播放",e.teachersComment=_.find(t,{name:"videoCourse-teachersComment"}).data,e.isappraise=_.find(t,{name:"geAppraisetFlag"}).data,e.avgscorelist=_.find(t,{name:"getAppraiseAvgScorelist"}).data,e.avgTotalscore=_.find(t,{name:"getGradeByCoursewareid"}).data[0],e.avgscore=e.decRound(_.find(t,{name:"getGradeByCoursewareid"}).data[0].grade);var o=_.find(t,{name:"get_sy_courseware_information"}).data;if(o.length>0){var n=["doc","docx","xls","xlsx","ppt","pptx","pdf","jpg","png","gif","bmp","txt"];for(var a in o)_.indexOf(n,o[a].type)<0&&(t[a].type="other")}e.informationData=o}},function(e){});var l=function(){s.getDataSource(["geAppraisetFlag","getAppraiseAvgScorelist","getGradeByCoursewareid"],{coursewareid31:a.coursewareid,accountid:t.user.accountId,coursewareid32:a.coursewareid,coursewareid1:a.coursewareid},function(t){e.isappraise=_.find(t,{name:"geAppraisetFlag"}).data,e.avgscorelist=_.find(t,{name:"getAppraiseAvgScorelist"}).data,e.avgTotalscore=_.find(t,{name:"getGradeByCoursewareid"}).data[0],e.avgscore=e.decRound(_.find(t,{name:"getGradeByCoursewareid"}).data[0].grade)},function(e){})};if(a.type){var f=t.videoConfig.mainConfig[a.type-1];if(f){var m=f.elementName;e.aClick(m)}else 0==a.type&&e.showAppraise();n.hash("courseware"),o()}e.downFiles=function(e,t,o,n){return s.getDataSource("dowdloadFile",{id:e,dimension:"学习度",eventname:"下载1次"},function(e){},function(e){}),u.downFiles(n,t,o)},e.showQuestionView=function(e,t,o){r.open({animation:!1,templateUrl:"question.html",controller:"questionCtrl",size:e,resolve:{videoPlay:function(){return t},videoTime:function(){return o}}})},e.studynoteConfig={studynoteContent:"",videoTime:0,studynoteImg1:"",studynoteImg2:""},e.showStudynoteView=function(t,o,n){r.open({animation:!1,templateUrl:"studynote.html",controller:"studynoteCtrl",size:t,resolve:{videoPlay:function(){return o},videoTime:function(){return n},coursewareCommentData:function(){return e.coursewareCommentData},studynoteConfig:function(){return e.studynoteConfig}}})}}]),app.controller("questionCtrl",["$rootScope","$scope","$modalInstance","$stateParams","getDataSource","CommonService","videoPlay","videoTime",function(e,t,o,n,i,a,r,s){t.currentCount=0,t.$watch("questionContent",function(e){e?t.currentCount=e.length:t.currentCount=0}),t.cancel=function(){o.dismiss("cancel"),r&&r()},t.disableSaveQuestion=!1,t.saveQuestion=function(){if(t.disableSaveQuestion=!0,""==_.trim(t.questionContent))return a.alert("请先输入问题内容"),void(t.disableSaveQuestion=!1);var o=i.getGUID();i.getDataSource("insert_sy_class_faq",{id:o,accountid:e.user.accountId,fid:"",content:t.questionContent,coursewareid:n.coursewareid,usertype:"1",studentid:e.user.studentId,videostamp:s,dimension:"参与度",eventname:"提出1个问题",logcontent:"提出1个问题"},function(o){t.cancel(),e.videoConfig.questionCount++,t.questionContent="",a.alert("提问成功"),t.disableSaveQuestion=!1,r&&r()},function(){t.disableSaveQuestion=!1,a.alert("提问失败")})}}]),app.controller("studynoteCtrl",["$rootScope","$scope","$modalInstance","$stateParams","getDataSource","DateService","CommonService","videoPlay","videoTime","coursewareCommentData","studynoteConfig",function(e,t,o,n,i,a,r,s,u,c,d){t.secondsToHHmmss=function(e){return a.secondsToHHmmss(e)},t.coursewareCommentData=c,t.studynoteConfig=d,t.studynoteConfig.videoTime=u,t.studynote_currentCount=0,t.$watch("studynoteConfig.studynoteContent",function(e){e?t.studynote_currentCount=e.length:t.studynote_currentCount=0}),t.cancel=function(){t.studynoteConfig.studynoteContent="",t.studynoteConfig.studynoteImg1="",t.studynoteConfig.studynoteImg2="",o.dismiss("cancel"),s&&s()},t.saveNoteDisabled=!1,t.saveStudynote=function(){if(t.saveNoteDisabled=!0,""==_.trim(t.studynoteConfig.studynoteContent))return r.alert("请先输入笔记内容"),void(t.saveNoteDisabled=!1);var o=i.getGUID();i.getDataSource("insert_sy_classcourse_note",{id:o,coursewareid:n.coursewareid,teacherpic:t.studynoteConfig.studynoteImg1,pptpic:t.studynoteConfig.studynoteImg2,videostamp:t.studynoteConfig.videoTime,studentid:e.user.studentId,notecontent:t.studynoteConfig.studynoteContent,dimension:"学习度",eventname:"做1次笔记"},function(o){t.cancel(),e.videoConfig.coursewarenoteCount++,t.studynoteConfig.studynoteContent="",t.studynoteConfig.studynoteImg1="",t.studynoteConfig.studynoteImg2="",s&&s(),r.alert("笔记保存成功"),t.saveNoteDisabled=!1},function(){r.alert("笔记保存失败"),t.saveNoteDisabled=!1})}}]);